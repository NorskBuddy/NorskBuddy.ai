<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buddy Learn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --green: #58cc02; --blue: #1cb0f6; --pink: #ec4899;
      --linux-bg: #0d1117; --linux-accent: #39ff14; --linux-dim: #1e2a1e;
      --red: #ff4b4b; --yellow: #ffc800;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #1cb0f6, #58cc02); transition: background 0.4s; }
    body.jp  { background: linear-gradient(135deg, #f472b6, #fb7185); }
    body.linux { background: linear-gradient(135deg, #0d1117, #1a2a1a); }
    .app { max-width: 520px; margin: auto; background: #fff; min-height: 100vh; padding: 20px; transition: background 0.3s, color 0.3s; }
    body.linux .app { background: #0d1117; color: #c9d1d9; }
    .lang-toggle { display: flex; justify-content: center; gap: 16px; margin-bottom: 8px; font-size: 26px; cursor: pointer; }
    .lang-toggle span { opacity: .35; transition: opacity .2s, transform .2s; }
    .lang-toggle span:hover { opacity: .7; transform: scale(1.15); }
    .lang-toggle .active { opacity: 1; transform: scale(1.2); }
    .linux-flag { font-size: 22px; display: flex; align-items: center; gap: 4px; font-family: 'JetBrains Mono', monospace; font-weight: 700; color: #555; transition: color .2s; }
    body.linux .linux-flag { color: var(--linux-accent); }
    .lang-toggle .active.linux-flag { color: var(--linux-accent); }
    h1 { text-align: center; margin: 4px 0 12px; font-size: 26px; font-weight: 800; }
    body.linux h1 { color: var(--linux-accent); font-family: 'JetBrains Mono', monospace; }
    .stats { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; font-weight: 700; }
    body.linux .stats { color: #8b949e; }
    .section { background: #f0f8ff; border-radius: 16px; padding: 14px; margin-top: 14px; }
    body.jp .section { background: #fff1f5; }
    body.linux .section { background: #161b22; border: 1px solid #30363d; }
    .section-header { font-size: 17px; font-weight: 800; cursor: pointer; user-select: none; display: flex; justify-content: space-between; align-items: center; }
    body.linux .section-header { color: #c9d1d9; font-family: 'JetBrains Mono', monospace; font-size: 13px; }
    .section-header::after { content: '‚ñæ'; font-size: 14px; opacity: .5; }
    .section-header.open::after { content: '‚ñ¥'; }
    .hidden { display: none !important; }
    .lesson-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 12px; }
    .lesson { background: #fff; border-radius: 12px; padding: 13px; text-align: center; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,.1); font-weight: 700; font-size: 14px; transition: transform .15s, box-shadow .15s; border: 2px solid transparent; position: relative; }
    .lesson:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,.15); }
    body.linux .lesson { background: #0d1117; color: #c9d1d9; border: 1px solid #30363d; font-family: 'JetBrains Mono', monospace; font-size: 11px; }
    body.linux .lesson:hover { border-color: var(--linux-accent); color: var(--linux-accent); }
    .lesson.done { border-color: var(--green); }
    body.linux .lesson.done { border-color: var(--linux-accent); }
    .lesson.done::after { content: '‚úì'; position: absolute; top: 4px; right: 7px; font-size: 11px; color: var(--green); font-weight: 900; }
    body.linux .lesson.done::after { color: var(--linux-accent); }
    .btn { display: inline-block; background: var(--green); color: #fff; border: none; border-radius: 12px; padding: 10px 20px; font-size: 15px; font-weight: 700; cursor: pointer; margin: 4px 2px; font-family: 'Nunito', sans-serif; transition: filter .15s, transform .1s; }
    .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
    body.jp .btn { background: var(--pink); }
    body.linux .btn { background: var(--linux-accent); color: #000; font-family: 'JetBrains Mono', monospace; font-size: 13px; }
    .btn.secondary { background: #e5e7eb; color: #374151; }
    body.linux .btn.secondary { background: #21262d; color: #8b949e; }
    .answer-line { min-height: 44px; border-bottom: 2px solid #d1d5db; margin-top: 14px; padding: 8px 4px; font-size: 16px; color: #374151; font-weight: 700; }
    body.linux .answer-line { border-color: #30363d; color: var(--linux-accent); font-family: 'JetBrains Mono', monospace; }
    .bubbles { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 14px; }
    .bubble { background: #e5e7eb; padding: 8px 14px; border-radius: 20px; cursor: pointer; font-weight: 700; font-size: 14px; transition: background .15s, color .15s, transform .1s; user-select: none; border: 2px solid #d1d5db; }
    .bubble:hover { transform: scale(1.04); }
    .bubble.selected { background: var(--green); color: #fff; border-color: var(--green); }
    body.jp .bubble.selected { background: var(--pink); border-color: var(--pink); }
    body.linux .bubble { background: #161b22; color: #8b949e; border-color: #30363d; font-family: 'JetBrains Mono', monospace; font-size: 12px; }
    body.linux .bubble.selected { background: var(--linux-accent); color: #000; border-color: var(--linux-accent); }
    .bubble.wrong { background: var(--red); color: #fff; border-color: var(--red); }
    #feedback { text-align: center; font-weight: 800; font-size: 17px; min-height: 26px; margin-top: 10px; }
    .match-col { display: flex; flex-direction: column; gap: 10px; }
    .match-card { background: #f3f4f6; padding: 11px 10px; border-radius: 12px; text-align: center; cursor: pointer; font-weight: 700; font-size: 13px; transition: background .15s, color .15s, opacity .3s; user-select: none; border: 2px solid #e5e7eb; min-height: 52px; display: flex; align-items: center; justify-content: center; }
    .match-card:hover:not(.matched):not(.selected) { border-color: #9ca3af; }
    .match-card.selected { background: var(--green); color: #fff; border-color: var(--green); }
    body.jp .match-card.selected { background: var(--pink); border-color: var(--pink); }
    body.linux .match-card { background: #161b22; color: #8b949e; border-color: #30363d; font-family: 'JetBrains Mono', monospace; font-size: 11px; }
    body.linux .match-card.selected { background: var(--linux-accent); color: #000; border-color: var(--linux-accent); }
    .match-card.wrong { background: var(--red); color: #fff; border-color: var(--red); animation: shake .3s; }
    .match-card.matched { background: #e5e7eb; color: #9ca3af; border-color: #e5e7eb; cursor: default; opacity: 0.55; }
    body.linux .match-card.matched { background: #161b22; color: #374151; border-color: #21262d; }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }
    #matchTimer { text-align: center; font-size: 22px; font-weight: 800; margin: 8px 0; }
    #linuxMatchMadnessTimer { text-align: center; font-size: 22px; font-weight: 800; margin: 8px 0; color: var(--linux-accent); font-family: 'JetBrains Mono', monospace; }
    .linux-lesson-view { padding: 4px 0; }
    .linux-concept { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 16px; margin-bottom: 14px; }
    .linux-concept h3 { margin: 0 0 8px; font-size: 15px; color: var(--linux-accent); font-family: 'JetBrains Mono', monospace; }
    .linux-concept p { margin: 0 0 8px; font-size: 14px; line-height: 1.6; color: #c9d1d9; }
    .linux-concept .analogy { color: #8b949e; font-style: italic; font-size: 13px; margin-bottom: 8px; }
    .cmd-block { background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 10px 14px; font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--linux-accent); margin: 8px 0; position: relative; overflow-x: auto; }
    .cmd-block .prompt { color: #8b949e; }
    .nuance { background: #1c2128; border-left: 3px solid var(--yellow); border-radius: 0 8px 8px 0; padding: 8px 12px; font-size: 13px; color: #e3b341; margin-top: 8px; }
    .nuance::before { content: '‚ö† '; }
    .progress-bar-outer { background: #21262d; border-radius: 20px; height: 8px; margin: 8px 0 16px; }
    .progress-bar-inner { height: 8px; border-radius: 20px; background: var(--linux-accent); transition: width .4s; }
    .lesson-nav { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; gap: 8px; }
    .concept-counter { font-size: 13px; color: #8b949e; font-family: 'JetBrains Mono', monospace; }
    .linux-match-section { margin-top: 20px; border-top: 1px solid #30363d; padding-top: 16px; }
    .linux-match-section h3 { color: var(--linux-accent); font-family: 'JetBrains Mono', monospace; font-size: 15px; margin: 0 0 12px; }
    .linux-match-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .linux-match-grid .match-col { display: flex; flex-direction: column; gap: 8px; }
    .timer-warning { color: var(--red) !important; animation: pulse .5s infinite alternate; }
    @keyframes pulse { from{opacity:1} to{opacity:.4} }
    .score-banner { text-align:center; padding: 20px; }
    .score-banner .big { font-size: 48px; }
    .score-banner .score-num { font-size: 36px; font-weight: 800; color: var(--linux-accent); font-family: 'JetBrains Mono', monospace; }
  </style>
</head>
<body>
<div class="app">
  <div class="lang-toggle">
    <span id="flagNO" class="active">üá≥üá¥</span>
    <span id="flagJP">üáØüáµ</span>
    <span id="flagLinux" class="linux-flag">üêß Linux</span>
  </div>
  <h1 id="title">Norsk Buddy</h1>
  <div class="stats">
    <div>üî• Streak: <span id="streakEl">0</span></div>
    <div>‚≠ê XP: <span id="xpEl">0</span> (Lv <span id="levelEl">1</span>)</div>
  </div>

  <!-- HOME -->
  <div id="home">
    <div id="langSections"></div>
    <div id="matchSections" class="hidden">
      <div class="section"><div class="section-header" onclick="startMatch(false)">üÉè Match Madness ‚Äì Unlimited</div></div>
      <div class="section"><div class="section-header" onclick="startMatch(true)">‚è± Match Madness ‚Äì 1:30 Timed</div></div>
    </div>
    <div id="linuxMatchSections" class="hidden">
      <div class="section"><div class="section-header" onclick="startLinuxMatchMadness(false)">üÉè Linux Match Madness ‚Äì Unlimited</div></div>
      <div class="section"><div class="section-header" onclick="startLinuxMatchMadness(true)">‚è± Linux Match Madness ‚Äì 1:30 Timed</div></div>
    </div>
  </div>

  <!-- LANGUAGE LESSON VIEW -->
  <div id="lessonView" class="hidden">
    <button class="btn secondary" onclick="goHome()">‚Üê Back</button>
    <h2 id="lessonTitle" style="text-align:center;"></h2>
    <p id="example" style="font-size:18px;line-height:1.7;text-align:center;"></p>
    <button class="btn" onclick="playAudio()">üîä Play Audio</button>
    <div class="answer-line" id="answerLine">Tap words below to build your answer‚Ä¶</div>
    <div class="bubbles" id="bubbles"></div>
    <p id="feedback"></p>
  </div>

  <!-- LINUX LESSON VIEW -->
  <div id="linuxLessonView" class="hidden">
    <button class="btn secondary" onclick="goHome()">‚Üê Back</button>
    <h2 id="linuxLessonTitle" style="text-align:center;font-family:'JetBrains Mono',monospace;color:var(--linux-accent);font-size:18px;"></h2>
    <div class="progress-bar-outer"><div class="progress-bar-inner" id="linuxProgress" style="width:0%"></div></div>
    <div id="linuxConceptArea" class="linux-lesson-view"></div>
    <div class="lesson-nav">
      <button class="btn secondary" id="prevConceptBtn" onclick="prevConcept()">‚Üê Prev</button>
      <span class="concept-counter" id="conceptCounter"></span>
      <button class="btn" id="nextConceptBtn" onclick="nextConcept()">Next ‚Üí</button>
    </div>
    <div class="linux-match-section" id="linuxMatchSection" style="display:none;">
      <h3>üéÆ Quiz: Match the Command to Its Purpose</h3>
      <p style="font-size:13px;color:#8b949e;margin:0 0 10px;">Select a command on the left, then its meaning on the right.</p>
      <div class="linux-match-grid">
        <div class="match-col" id="linuxMatchLeft"></div>
        <div class="match-col" id="linuxMatchRight"></div>
      </div>
      <p id="linuxMatchFeedback" style="text-align:center;font-weight:700;font-size:15px;min-height:22px;margin-top:10px;color:var(--linux-accent);"></p>
      <div id="linuxMatchComplete" class="hidden" style="text-align:center;padding:16px;">
        <div style="font-size:36px;">üéâ</div>
        <p style="color:var(--linux-accent);font-family:'JetBrains Mono',monospace;font-weight:700;">Lesson Complete! +20 XP</p>
        <button class="btn" onclick="goHome()">Back to Lessons</button>
      </div>
    </div>
  </div>

  <!-- LANGUAGE MATCH MADNESS VIEW -->
  <div id="matchView" class="hidden">
    <button class="btn secondary" onclick="exitMatch()">‚Üê Back</button>
    <h2 style="text-align:center;">Match Madness</h2>
    <div id="matchTimer"></div>
    <p style="text-align:center;font-size:13px;color:#6b7280;margin:0 0 8px;">Match left ‚Üí right</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <div class="match-col" id="matchLeft"></div>
      <div class="match-col" id="matchRight"></div>
    </div>
    <p id="matchFeedback" style="text-align:center;font-weight:700;font-size:15px;min-height:22px;margin-top:6px;"></p>
  </div>

  <!-- LINUX MATCH MADNESS VIEW -->
  <div id="linuxMatchMadnessView" class="hidden">
    <button class="btn secondary" onclick="exitLinuxMatchMadness()">‚Üê Back</button>
    <h2 style="text-align:center;font-family:'JetBrains Mono',monospace;color:var(--linux-accent);">Linux Match Madness</h2>
    <div id="linuxMatchMadnessTimer"></div>
    <p style="text-align:center;font-size:12px;color:#8b949e;margin:0 0 8px;font-family:'JetBrains Mono',monospace;">cmd ‚Üí purpose</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <div class="match-col" id="lmmLeft"></div>
      <div class="match-col" id="lmmRight"></div>
    </div>
    <p id="lmmFeedback" style="text-align:center;font-weight:700;font-size:14px;min-height:22px;margin-top:8px;font-family:'JetBrains Mono',monospace;"></p>
    <div id="lmmScoreBanner" class="hidden score-banner">
      <div class="big">üèÜ</div>
      <div class="score-num" id="lmmScoreNum"></div>
      <p style="color:#8b949e;font-family:'JetBrains Mono',monospace;font-size:13px;">pairs matched</p>
      <button class="btn" onclick="exitLinuxMatchMadness()">Back to Home</button>
      <button class="btn secondary" id="lmmPlayAgainBtn">Play Again</button>
    </div>
  </div>
</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA ‚Äì NORWEGIAN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const lessonsNO = {
  sec1: [
    { title:"Greetings",      sentence:"Hei, hvordan har du det?",            translation:"Hi how are you" },
    { title:"Introductions",  sentence:"Jeg heter Anna.",                     translation:"My name is Anna" },
    { title:"Thank You",      sentence:"Tusen takk for hjelpen.",             translation:"Thank you for the help" },
    { title:"Yes / No",       sentence:"Ja, det er riktig.",                  translation:"Yes that is correct" },
    { title:"Please",         sentence:"Kan du hjelpe meg?",                  translation:"Can you help me" },
    { title:"Sorry",          sentence:"Beklager, jeg forst√•r ikke.",         translation:"Sorry I do not understand" },
  ],
  sec2: [
    { title:"Family",         sentence:"Jeg har en bror og en s√∏ster.",       translation:"I have a brother and a sister" },
    { title:"Food",           sentence:"Jeg er sulten og vil spise middag.",  translation:"I am hungry and want to eat dinner" },
    { title:"Numbers",        sentence:"Det er tre epler p√• bordet.",         translation:"There are three apples on the table" },
    { title:"Colors",         sentence:"Himmelen er bl√• og gresset er gr√∏nt.",translation:"The sky is blue and the grass is green" },
    { title:"Time",           sentence:"Klokken er ti om morgenen.",          translation:"The time is ten in the morning" },
    { title:"Weather",        sentence:"Det regner mye i dag.",               translation:"It is raining a lot today" },
  ],
  sec3: [
    { title:"Shopping",       sentence:"Hvor mye koster dette?",              translation:"How much does this cost" },
    { title:"Directions",     sentence:"Hvor er n√¶rmeste togstasjon?",        translation:"Where is the nearest train station" },
    { title:"Work",           sentence:"Jeg jobber som ingeni√∏r.",            translation:"I work as an engineer" },
    { title:"Hobbies",        sentence:"Jeg liker √• lese b√∏ker og g√• tur.",  translation:"I like to read books and go hiking" },
    { title:"Travel",         sentence:"Vi reiser til Bergen neste uke.",     translation:"We travel to Bergen next week" },
    { title:"Health",         sentence:"Jeg trenger √• se en lege.",           translation:"I need to see a doctor" },
  ]
};
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA ‚Äì JAPANESE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const lessonsJP = {
  sec1: [
    { title:"Greetings",      sentence:{romaji:"Hajimemashite, yoroshiku onegaishimasu.", kanji:"„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶„ÄÅ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ"}, translation:"Nice to meet you" },
    { title:"Introductions",  sentence:{romaji:"Watashi no namae wa Yuki desu.",          kanji:"ÁßÅ„ÅÆÂêçÂâç„ÅØ„ÇÜ„Åç„Åß„Åô„ÄÇ"},              translation:"My name is Yuki" },
    { title:"Thank You",      sentence:{romaji:"Arigatou gozaimasu.",                     kanji:"„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ"},             translation:"Thank you very much" },
    { title:"Yes / No",       sentence:{romaji:"Hai, sou desu.",                          kanji:"„ÅØ„ÅÑ„ÄÅ„Åù„ÅÜ„Åß„Åô„ÄÇ"},                   translation:"Yes that is right" },
    { title:"Please",         sentence:{romaji:"Tasukete kudasai.",                       kanji:"Âä©„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"},                  translation:"Please help me" },
    { title:"Sorry",          sentence:{romaji:"Sumimasen, wakarimasen.",                 kanji:"„Åô„Åø„Åæ„Åõ„Çì„ÄÅ„Çè„Åã„Çä„Åæ„Åõ„Çì„ÄÇ"},          translation:"Sorry I do not understand" },
  ],
  sec2: [
    { title:"Family",         sentence:{romaji:"Watashi wa ani to imouto ga imasu.",      kanji:"ÁßÅ„ÅØÂÖÑ„Å®Â¶π„Åå„ÅÑ„Åæ„Åô„ÄÇ"},              translation:"I have an older brother and younger sister" },
    { title:"Food",           sentence:{romaji:"Watashi wa onaka ga suite imasu.",        kanji:"ÁßÅ„ÅØ„ÅäËÖπ„ÅåÁ©∫„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ"},          translation:"I am hungry" },
    { title:"Numbers",        sentence:{romaji:"Ringo ga mittsu arimasu.",                kanji:"„Çä„Çì„Åî„Åå‰∏â„Å§„ÅÇ„Çä„Åæ„Åô„ÄÇ"},             translation:"There are three apples" },
    { title:"Colors",         sentence:{romaji:"Sora wa aoi desu.",                       kanji:"Á©∫„ÅØÈùí„ÅÑ„Åß„Åô„ÄÇ"},                    translation:"The sky is blue" },
    { title:"Time",           sentence:{romaji:"Ima juuji desu.",                         kanji:"‰ªäÂçÅÊôÇ„Åß„Åô„ÄÇ"},                      translation:"It is ten o clock now" },
    { title:"Weather",        sentence:{romaji:"Kyou wa ame ga futte imasu.",             kanji:"‰ªäÊó•„ÅØÈõ®„ÅåÈôç„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ"},           translation:"It is raining today" },
  ],
  sec3: [
    { title:"Shopping",       sentence:{romaji:"Kore wa ikura desu ka?",                  kanji:"„Åì„Çå„ÅØ„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü"},              translation:"How much is this" },
    { title:"Directions",     sentence:{romaji:"Eki wa doko desu ka?",                    kanji:"ÈßÖ„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü"},                  translation:"Where is the station" },
    { title:"Work",           sentence:{romaji:"Watashi wa enjinia desu.",                kanji:"ÁßÅ„ÅØ„Ç®„É≥„Ç∏„Éã„Ç¢„Åß„Åô„ÄÇ"},              translation:"I am an engineer" },
    { title:"Hobbies",        sentence:{romaji:"Hon o yomu no ga suki desu.",             kanji:"Êú¨„ÇíË™≠„ÇÄ„ÅÆ„ÅåÂ•Ω„Åç„Åß„Åô„ÄÇ"},            translation:"I like reading books" },
    { title:"Travel",         sentence:{romaji:"Raishuu Tokyo ni ikimasu.",               kanji:"Êù•ÈÄ±Êù±‰∫¨„Å´Ë°å„Åç„Åæ„Åô„ÄÇ"},              translation:"I will go to Tokyo next week" },
    { title:"Health",         sentence:{romaji:"Isha ni itte kudasai.",                   kanji:"ÂåªËÄÖ„Å´Ë°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"},            translation:"Please go to the doctor" },
  ]
};
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA ‚Äì LINUX (150 lessons across 15 sections)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const linuxSections = [
  // ‚îÄ‚îÄ SECTION 1 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß1 ‚Äì The Terminal & Navigation",
    lessons: [
      {
        title: "What is the Terminal?",
        concepts: [
          { heading:"The Terminal: Your Direct Line to the System", body:"The terminal (shell/command line) lets you talk to your computer with text. Your desktop GUI is like a store clerk guiding you with menus. The terminal is calling the back office directly ‚Äî faster and more powerful, but you need to know what to ask.", analogy:"üè™ GUI = store clerk. Terminal = calling the warehouse directly.", commands:[], example:"", nuance:"On Linux the most common shell is Bash. Your prompt looks like 'user@host:~$'. $ = regular user. # = root (admin)." },
          { heading:"pwd ‚Äì Print Working Directory", body:"pwd tells you exactly where you are in the filesystem ‚Äî like asking 'which floor am I on?' in a large building. The filesystem is a giant filing cabinet and pwd shows your current drawer.", analogy:"üìç Like a 'You Are Here' marker on a mall map.", commands:[{cmd:"pwd",desc:"Show current directory path"}], example:"$ pwd\n/home/alice", nuance:"Every command runs relative to your current location unless you provide a full (absolute) path starting with /." },
          { heading:"ls ‚Äì List Directory Contents", body:"ls shows what's inside the current directory ‚Äî files and folders. Like opening a drawer to see what's inside. Common flags make it far more useful.", analogy:"üìÇ ls = looking inside a physical folder.", commands:[{cmd:"ls",desc:"List files"},{cmd:"ls -l",desc:"Long listing with permissions, size, date"},{cmd:"ls -a",desc:"Show hidden files (starting with .)"},{cmd:"ls -lh",desc:"Long listing with human-readable sizes"}], example:"$ ls -lh\ndrwxr-xr-x 2 alice alice 4.0K Jan 10 Documents\n-rw-r--r-- 1 alice alice  23K Jan 10 notes.txt", nuance:"Hidden files start with a dot (.). They're usually config files. ls -la shows everything." },
          { heading:"cd ‚Äì Change Directory", body:"cd moves you between folders. It's how you navigate the filing cabinet. Knowing a few shortcuts makes you much faster.", analogy:"üö∂ cd = walking from room to room in a building.", commands:[{cmd:"cd Documents",desc:"Move into Documents"},{cmd:"cd ..",desc:"Go up one folder"},{cmd:"cd ~",desc:"Go home"},{cmd:"cd /",desc:"Go to filesystem root"}], example:"$ cd Documents\n$ pwd\n/home/alice/Documents\n$ cd ..\n$ pwd\n/home/alice", nuance:"~ is always your home directory. / is the very top of the filesystem. cd - takes you to the previous directory ‚Äî handy shortcut." }
        ],
        matchPairs:[{cmd:"pwd",purpose:"Show current directory"},{cmd:"ls -a",purpose:"Show hidden files"},{cmd:"cd ..",purpose:"Go up one level"},{cmd:"cd ~",purpose:"Go to home directory"},{cmd:"ls -lh",purpose:"List with human-readable sizes"}]
      },
      {
        title: "Files & Directories",
        concepts: [
          { heading:"The Linux Filesystem Tree", body:"Linux organizes everything in one tree starting at / (root). Unlike Windows with C: D:, Linux puts everything under one roof. /home holds user files, /etc holds config, /var holds logs, /tmp is temporary, /usr holds programs.", analogy:"üå≥ / is the trunk. Every folder is a branch.", commands:[], example:"/\n‚îú‚îÄ‚îÄ home/alice/\n‚îú‚îÄ‚îÄ etc/\n‚îú‚îÄ‚îÄ var/\n‚îî‚îÄ‚îÄ usr/", nuance:"Everything in Linux is a file ‚Äî even devices like your hard drive appear as files in /dev/." },
          { heading:"mkdir & rmdir ‚Äì Create/Remove Directories", body:"mkdir creates a folder. rmdir removes an empty one. Like buying a new folder for your filing cabinet vs throwing away an empty one.", analogy:"üìÅ mkdir = new folder. rmdir = trash the empty one.", commands:[{cmd:"mkdir myfolder",desc:"Create a directory"},{cmd:"mkdir -p a/b/c",desc:"Create nested directories at once"},{cmd:"rmdir myfolder",desc:"Remove empty directory"}], example:"$ mkdir -p projects/2024/jan\n$ ls projects/2024/\njan", nuance:"rmdir only works on EMPTY folders. Use 'rm -r' to remove folders with files inside ‚Äî but be careful." },
          { heading:"touch ‚Äì Create Files", body:"touch creates an empty file or updates a file's timestamp. Like placing a blank sheet of paper in your filing system.", analogy:"üìÑ touch = place a blank labelled sheet of paper.", commands:[{cmd:"touch notes.txt",desc:"Create an empty file"}], example:"$ touch notes.txt\n$ ls\nnotes.txt", nuance:"touch is often used in scripts to create placeholder files or signal that something happened at a certain time." },
          { heading:"cp & mv ‚Äì Copy and Move", body:"cp copies a file. mv moves or renames it. Like photocopying a document vs physically relocating it.", analogy:"üìã cp = photocopy. mv = physically move the original.", commands:[{cmd:"cp file.txt backup.txt",desc:"Copy file"},{cmd:"cp -r folder/ new/",desc:"Copy entire folder"},{cmd:"mv file.txt docs/",desc:"Move file into docs"},{cmd:"mv old.txt new.txt",desc:"Rename a file"}], example:"$ cp report.txt report_backup.txt\n$ mv report.txt /home/alice/docs/", nuance:"mv has no undo. The original location is gone immediately. Always double-check before running." }
        ],
        matchPairs:[{cmd:"mkdir",purpose:"Create a folder"},{cmd:"touch",purpose:"Create an empty file"},{cmd:"cp",purpose:"Copy a file"},{cmd:"mv",purpose:"Move or rename a file"},{cmd:"rmdir",purpose:"Remove an empty folder"}]
      },
      {
        title: "Reading Files",
        concepts: [
          { heading:"cat ‚Äì Print File Contents", body:"cat prints an entire file to your screen. Great for small files, but it'll flood your terminal for large ones.", analogy:"üìñ cat = open the book and read every page aloud at once.", commands:[{cmd:"cat file.txt",desc:"Print entire file"},{cmd:"cat f1.txt f2.txt",desc:"Print two files in sequence"}], example:"$ cat notes.txt\nMeeting at 3pm\nBring laptop", nuance:"For large files use less instead ‚Äî cat will just scroll past everything too fast to read." },
          { heading:"less ‚Äì Page Through Files", body:"less opens a file you can scroll through. Space=forward, b=back, /=search, q=quit. Perfect for large files and log files.", analogy:"üìö less = reading a book page by page instead of all at once.", commands:[{cmd:"less bigfile.txt",desc:"Open file for scrollable reading (q to quit)"}], example:"$ less /var/log/syslog\n# Arrows to scroll, q to exit", nuance:"'less is more than more' ‚Äî less is almost always better than the older 'more' command." },
          { heading:"head & tail ‚Äì Start and End of Files", body:"head shows the first 10 lines. tail shows the last 10. For log files, tail -f is essential ‚Äî it live-streams new entries as they're written.", analogy:"üêç head = snake's head. tail = snake's tail.", commands:[{cmd:"head file.txt",desc:"First 10 lines"},{cmd:"head -n 20 f",desc:"First 20 lines"},{cmd:"tail file.txt",desc:"Last 10 lines"},{cmd:"tail -f /var/log/syslog",desc:"Live-follow a log file"}], example:"$ tail -f /var/log/auth.log\n# Streams new lines in real time", nuance:"tail -f is one of the most-used sysadmin tools. Use Ctrl+C to stop it." },
          { heading:"grep ‚Äì Search Inside Files", body:"grep finds lines matching a pattern. Like Ctrl+F in a document but far more powerful from the command line.", analogy:"üîç grep = highlight marker ‚Äî shows only lines containing your term.", commands:[{cmd:"grep error log.txt",desc:"Find lines with 'error'"},{cmd:"grep -i error log.txt",desc:"Case-insensitive"},{cmd:"grep -r TODO ./src/",desc:"Search recursively in folder"},{cmd:"grep -n pattern file",desc:"Show line numbers"}], example:"$ grep Failed /var/log/auth.log\nJan 10 sshd: Failed password for alice", nuance:"grep supports regular expressions. grep -E 'error|warning' log.txt matches either word." }
        ],
        matchPairs:[{cmd:"cat",purpose:"Print entire file"},{cmd:"less",purpose:"Scroll through a file"},{cmd:"tail -f",purpose:"Live-follow a log"},{cmd:"grep",purpose:"Search for text in files"},{cmd:"head",purpose:"Show first lines of file"}]
      },
      {
        title: "Wildcards & Globbing",
        concepts: [
          { heading:"Wildcards: Pattern Matching for Files", body:"Wildcards let you reference multiple files with a single pattern. The shell expands them BEFORE passing to the command ‚Äî a key detail. * matches anything, ? matches one character, [...] matches a set.", analogy:"üÉè Wildcards=playing cards with wild rules. * is a joker that matches everything. ? matches exactly one unknown card.", commands:[{cmd:"ls *.txt",desc:"List all .txt files"},{cmd:"ls report_?.pdf",desc:"report_1.pdf, report_2.pdf, etc."},{cmd:"ls [abc]*.log",desc:"Files starting with a, b, or c"},{cmd:"rm temp_*",desc:"Delete all files starting with temp_"}], example:"$ ls *.log\naccess.log  error.log  system.log\n\n$ ls report_[0-9][0-9].txt\nreport_01.txt  report_12.txt", nuance:"Shell expansion happens FIRST. 'cat *.log' becomes 'cat access.log error.log system.log' before cat runs. If no files match, you get an error." },
          { heading:"Brace Expansion ‚Äì Generate Sequences", body:"Brace expansion creates multiple strings from one pattern ‚Äî extremely useful for creating file structures, renaming in bulk, or building commands. It's expanded by the shell, not a separate command.", analogy:"üìã Brace expansion=a copy machine with automatic labeling. {a,b,c} makes three copies labelled a, b, c.", commands:[{cmd:"mkdir -p project/{src,docs,tests,config}",desc:"Create 4 dirs at once"},{cmd:"cp file.conf{,.bak}",desc:"Backup a file (copies to file.conf.bak)"},{cmd:"echo {1..10}",desc:"Expand to 1 2 3 4 5 6 7 8 9 10"},{cmd:"touch log_{2024..2026}.txt",desc:"Create log_2024.txt through log_2026.txt"}], example:"$ mkdir -p /var/www/{html,logs,ssl,conf.d}\n$ ls /var/www/\nhtml  logs  ssl  conf.d\n\n$ cp nginx.conf{,.backup}\n# nginx.conf.backup created instantly", nuance:"cp file.conf{,.bak} is one of the most useful real-world brace tricks ‚Äî always back up a config file before editing it." },
          { heading:"find ‚Äì Locating Files Precisely", body:"find searches the filesystem for files matching criteria you define ‚Äî name, type, size, age, permissions, ownership. Unlike ls, find is recursive and programmable with -exec.", analogy:"üîç find=a detective's database search. You define exactly what you're looking for and it checks everywhere.", commands:[{cmd:"find /var/log -name '*.log'",desc:"Find all .log files in /var/log"},{cmd:"find . -type f -newer config.txt",desc:"Files newer than config.txt"},{cmd:"find /home -size +100M",desc:"Files over 100MB in /home"},{cmd:"find . -name '*.py' -exec wc -l {} \\;",desc:"Count lines in each .py file"}], example:"# Find and delete files older than 30 days in /tmp:\n$ find /tmp -type f -mtime +30 -delete\n\n# Find all empty directories:\n$ find /var/www -type d -empty", nuance:"The -exec flag lets you run any command on each found file. {} is the placeholder for the filename. Always test find without -delete first." },
          { heading:"ln ‚Äì Hard Links and Symlinks", body:"ln creates links. A hard link is another name for the same file data ‚Äî deleting one doesn't lose the data. A symlink (soft link, -s) is a pointer/shortcut that can cross filesystems and point to directories.", analogy:"üîó Hard link=two equally official names for one person (aliases). Symlink=a forwarding address that redirects to where someone actually lives.", commands:[{cmd:"ln file.txt hardlink.txt",desc:"Create hard link"},{cmd:"ln -s /etc/nginx/sites-available/mysite /etc/nginx/sites-enabled/",desc:"Create symlink (common nginx pattern)"},{cmd:"ls -la",desc:"See symlinks (shown as ->)"},{cmd:"readlink -f symlink",desc:"Resolve symlink to real path"}], example:"$ ln -s /opt/myapp/current /var/www/html/app\n$ ls -la /var/www/html/\nlrwxrwxrwx 1 root root  20 app -> /opt/myapp/current\n\n# Now deploy by updating symlink:\n$ ln -sfn /opt/myapp/v2.1 /var/www/html/app", nuance:"Symlinks are used extensively in package managers, nginx site configs, and deployment strategies (blue-green deploys use symlinks to switch versions instantly)." }
        ],
        matchPairs:[{cmd:"*.txt",purpose:"Match all .txt files (wildcard)"},{cmd:"cp file{,.bak}",purpose:"Backup file with brace expansion"},{cmd:"find -mtime +30",purpose:"Find files older than 30 days"},{cmd:"ln -s",purpose:"Create a symbolic link"},{cmd:"find -exec",purpose:"Run command on each found file"}]
      },
      {
        title: "File Content & Comparison",
        concepts: [
          { heading:"wc, sort, uniq ‚Äì Count and Deduplicate", body:"wc counts lines, words, and bytes. sort orders lines alphabetically or numerically. uniq removes consecutive duplicates. Together they're powerful for analyzing any text output.", analogy:"üìä wc=a word count tool. sort=filing alphabetically. uniq=removing carbon copies.", commands:[{cmd:"wc -l file.txt",desc:"Count lines"},{cmd:"wc -w file.txt",desc:"Count words"},{cmd:"sort names.txt",desc:"Sort alphabetically"},{cmd:"sort -n numbers.txt",desc:"Sort numerically"},{cmd:"sort file | uniq",desc:"Remove duplicate lines"},{cmd:"sort file | uniq -c | sort -rn",desc:"Count occurrences, ranked"}], example:"# Find the most common IPs hitting your server:\n$ awk '{print $1}' /var/log/nginx/access.log \\\n  | sort | uniq -c | sort -rn | head -10\n   4521 203.0.113.42\n   1203 192.168.1.100", nuance:"uniq only removes CONSECUTIVE duplicates ‚Äî you must sort first or it won't work as expected." },
          { heading:"diff & patch ‚Äì Compare and Apply Changes", body:"diff shows differences between two files line by line. patch applies a diff file's changes to another file. Used in software development, configuration management, and system administration.", analogy:"üìù diff=a proofreader marking what changed between two drafts. patch=applying those marks to make the corrections.", commands:[{cmd:"diff file1.txt file2.txt",desc:"Show differences"},{cmd:"diff -u file1 file2",desc:"Unified diff format (more readable)"},{cmd:"diff -r dir1/ dir2/",desc:"Compare entire directories"},{cmd:"patch file.txt < changes.patch",desc:"Apply a patch file"}], example:"$ diff -u nginx.conf.orig nginx.conf\n--- nginx.conf.orig\n+++ nginx.conf\n@@ -10,3 +10,3 @@\n-worker_processes 1;\n+worker_processes auto;", nuance:"When editing config files in production, always create a diff before and after: 'diff -u file.orig file.new' creates a reviewable record of exactly what changed." },
          { heading:"tee ‚Äì Split Output to Screen and File", body:"tee reads from stdin and writes to BOTH stdout (your screen) AND a file simultaneously. Like a T-junction in a pipe. Essential for logging command output while still seeing it in real time.", analogy:"üì∫ tee=a TV signal splitter. The signal goes to your TV AND gets recorded at the same time.", commands:[{cmd:"command | tee output.log",desc:"See output AND save to file"},{cmd:"command | tee -a output.log",desc:"See output AND append to file"},{cmd:"make install | tee install.log",desc:"Log installation output"}], example:"$ apt upgrade | tee /var/log/upgrade-$(date +%Y%m%d).log\n# See output on screen AND save it\n\n$ ./deploy.sh | tee -a /var/log/deployments.log", nuance:"Without tee, using > redirects output to a file but you can't see it in real-time. tee solves this during long-running operations." },
          { heading:"xargs ‚Äì Build Commands from Input", body:"xargs reads items from stdin and passes them as arguments to a command. This lets you pipe the output of one command into the arguments of another ‚Äî handling the cases where a simple pipe isn't enough.", analogy:"üè≠ xargs=a factory that takes a list of inputs and runs a production machine on each one ‚Äî in bulk.", commands:[{cmd:"find . -name '*.tmp' | xargs rm",desc:"Delete all .tmp files found"},{cmd:"cat servers.txt | xargs -I{} ssh {} uptime",desc:"Run uptime on each server listed"},{cmd:"ls *.jpg | xargs -P4 -I{} convert {} {}.png",desc:"Convert images in parallel (4 at once)"},{cmd:"echo 'a b c' | xargs mkdir",desc:"Create directories a, b, c"}], example:"# Find all Python files with TODO and show them:\n$ grep -rl 'TODO' ./src/ | xargs grep -n 'TODO'\n\n# Safely delete files with spaces in names:\n$ find . -name '*.tmp' -print0 | xargs -0 rm", nuance:"Use -print0 with find and -0 with xargs when filenames might contain spaces. Without it, filenames with spaces get split incorrectly." }
        ],
        matchPairs:[{cmd:"wc -l",purpose:"Count lines in a file"},{cmd:"diff -u",purpose:"Show unified file differences"},{cmd:"tee",purpose:"Write to screen and file simultaneously"},{cmd:"xargs",purpose:"Pass stdin as command arguments"},{cmd:"sort | uniq -c",purpose:"Count unique occurrences"}]
      },
      {
        title: "Environment & Shell Config",
        concepts: [
          { heading:"Environment Variables ‚Äì Your Shell's Settings", body:"Environment variables are key=value pairs available to your shell and all programs it runs. They configure behavior ‚Äî PATH tells the shell where to find commands, HOME is your home directory, EDITOR sets your default text editor.", analogy:"üéõ Environment variables=your shell's control panel settings. Each program can read them to know how to behave.", commands:[{cmd:"env",desc:"Print all environment variables"},{cmd:"echo $HOME",desc:"Print value of HOME"},{cmd:"echo $PATH",desc:"Print command search path"},{cmd:"export EDITOR=vim",desc:"Set EDITOR for current session and children"},{cmd:"MYVAR=hello bash -c 'echo $MYVAR'",desc:"Set variable for one command only"}], example:"$ echo $PATH\n/usr/local/bin:/usr/bin:/bin\n\n$ export JAVA_HOME=/usr/lib/jvm/java-17\n$ export PATH=$PATH:$JAVA_HOME/bin\n$ java -version\njava version \"17\"", nuance:"Variables set without export are local to the current shell. export makes them available to child processes. This distinction matters for scripts." },
          { heading:".bashrc vs .bash_profile ‚Äì Shell Config Files", body:".bashrc is loaded for every new interactive shell (terminal window). .bash_profile is loaded at login (SSH, console login). .bashrc is where you put aliases, functions, and PATH additions. Most systems source .bashrc from .bash_profile.", analogy:"üìã .bash_profile=getting dressed when you leave home (login). .bashrc=rules for every room you enter in a building (new shell).", commands:[{cmd:"source ~/.bashrc",desc:"Reload .bashrc without restarting shell"},{cmd:"echo 'alias ll=\"ls -la\"' >> ~/.bashrc",desc:"Add alias permanently"},{cmd:"cat ~/.bashrc",desc:"View current .bashrc"},{cmd:"nano ~/.bashrc",desc:"Edit .bashrc"}], example:"# Useful additions to ~/.bashrc:\nalias ll='ls -la'\nalias gs='git status'\nalias ..='cd ..'\nexport EDITOR=vim\nexport HISTSIZE=10000\n\n# After editing:\n$ source ~/.bashrc", nuance:"Always source (or open a new terminal) after editing .bashrc ‚Äî changes don't apply to the current session until you do." },
          { heading:"aliases ‚Äì Shortcuts for Commands", body:"Aliases are shortcuts that expand to longer commands. They save typing for commands you use frequently. Temporary aliases last the session; permanent ones go in .bashrc.", analogy:"‚å®Ô∏è Aliases=speed dial buttons. Instead of dialing the full number every time, press one button.", commands:[{cmd:"alias ll='ls -la'",desc:"Create an alias for this session"},{cmd:"alias",desc:"List all current aliases"},{cmd:"unalias ll",desc:"Remove an alias"},{cmd:"alias gs='git status && git log --oneline -5'",desc:"Chain commands in an alias"}], example:"# Production sysadmin aliases:\nalias dps='docker ps --format \"table {{.Names}}\\t{{.Status}}\"'\nalias logs='journalctl -f -u'\nalias checkdisk='df -h && du -sh /var/log/*'\nalias ports='ss -tulnp'\nalias myip='curl -s ifconfig.me'", nuance:"Alias names override commands ‚Äî avoid naming an alias 'rm' or 'ls' unless you understand the implications fully. 'rm' aliased to 'rm -i' (interactive) is common and safe." },
          { heading:"Shell History ‚Äì Efficiency Secrets", body:"Bash saves your command history. Knowing how to search and reuse history makes you dramatically faster. history lists past commands, Ctrl+R searches them interactively.", analogy:"üîÑ Shell history=a perfect memory of everything you've typed. Ctrl+R=searching that memory instantly.", commands:[{cmd:"history",desc:"Show command history"},{cmd:"history | grep ssh",desc:"Find previous ssh commands"},{cmd:"!!",desc:"Repeat last command"},{cmd:"!ssh",desc:"Run last command starting with 'ssh'"},{cmd:"Ctrl+R",desc:"Reverse interactive search through history"}], example:"# Real-world history tricks:\n$ sudo !!          # Repeat last command with sudo\n$ !apt             # Run last apt command again\n$ history | tail -20 | grep docker\n  450  docker run -d nginx\n  489  docker ps", nuance:"Set HISTSIZE=50000 and HISTFILESIZE=50000 in .bashrc for a larger history. Also add HISTTIMEFORMAT='%Y-%m-%d %H:%M ' to timestamp entries." }
        ],
        matchPairs:[{cmd:"export VAR=val",purpose:"Set environment variable for children"},{cmd:"source ~/.bashrc",purpose:"Reload shell config"},{cmd:"alias ll='ls -la'",purpose:"Create command shortcut"},{cmd:"Ctrl+R",purpose:"Search command history"},{cmd:"echo $PATH",purpose:"Show command search path"}]
      },
      {
        title: "Streams, Pipes & Redirection",
        concepts: [
          { heading:"stdin, stdout, stderr ‚Äì The Three Streams", body:"Every Linux process has three data streams: stdin (input, fd 0), stdout (output, fd 1), stderr (error messages, fd 2). Understanding these is essential for building pipelines and handling errors correctly.", analogy:"üì° Three radio stations: stdin=the request line (input), stdout=main broadcast (output), stderr=the emergency alert system (errors).", commands:[{cmd:"command > out.txt",desc:"Redirect stdout to file"},{cmd:"command 2> err.txt",desc:"Redirect stderr to file"},{cmd:"command > out.txt 2>&1",desc:"Redirect both stdout and stderr to file"},{cmd:"command 2>/dev/null",desc:"Discard all errors"},{cmd:"command < input.txt",desc:"Read stdin from file"}], example:"# Log output, discard errors:\n$ find / -name 'nginx.conf' 2>/dev/null\n\n# Capture everything (both streams):\n$ apt upgrade > /var/log/upgrade.log 2>&1\n\n# Show only errors:\n$ make 2>&1 | grep -i error", nuance:"2>&1 means 'redirect stderr (2) to wherever stdout (1) is going'. Order matters ‚Äî 2>&1 must come AFTER the stdout redirect, not before." },
          { heading:"Process Substitution & Here Documents", body:"Process substitution <() lets you treat command output as a file. Here documents (heredoc) let you feed multi-line text to a command inline in a script. Both are powerful scripting tools.", analogy:"üìú Heredoc=writing a multi-line letter inside your script rather than reading it from a separate file.", commands:[{cmd:"diff <(ls dir1) <(ls dir2)",desc:"Compare directory contents without temp files"},{cmd:"cat << 'EOF'\n  text here\nEOF",desc:"Heredoc: feed multi-line text to cat"},{cmd:"mysql -u root <<EOF\nCREATE DATABASE myapp;\nEOF",desc:"Feed SQL to mysql via heredoc"}], example:"#!/bin/bash\n# Create a config file via heredoc:\ncat > /etc/myapp/config.conf << 'EOF'\n[server]\nhost = localhost\nport = 8080\ndebug = false\nEOF\necho 'Config written'", nuance:"Use 'EOF' (quoted) to prevent variable expansion inside the heredoc. Use EOF (unquoted) when you want $VARIABLES to expand inside it." },
          { heading:"Named Pipes (FIFOs)", body:"A named pipe (FIFO) is a special file that acts as a pipe between two processes that don't share a parent. Unlike regular pipes, named pipes have a filesystem path ‚Äî both processes open the file to communicate.", analogy:"üìÆ Named pipe=a physical mail slot in a wall. One side deposits mail. The other side collects it. They never need to be in the same room at the same time.", commands:[{cmd:"mkfifo mypipe",desc:"Create a named pipe"},{cmd:"tail -f /var/log/app.log > mypipe &",desc:"Feed log into pipe in background"},{cmd:"grep ERROR < mypipe",desc:"Read from pipe in foreground"}], example:"# Real use: parallel processing pipeline\n$ mkfifo /tmp/data_pipe\n$ producer_script > /tmp/data_pipe &\n$ consumer_script < /tmp/data_pipe\n$ rm /tmp/data_pipe", nuance:"Named pipes block ‚Äî the writing process waits until a reader opens the pipe, and vice versa. This synchronization makes them useful for controlled producer-consumer workflows." },
          { heading:"Real-World Pipeline Patterns", body:"Expert sysadmins build complex pipelines from simple tools. These patterns appear repeatedly in real work: log analysis, data extraction, bulk operations, and monitoring.", analogy:"üè≠ Pipelines=an assembly line. Raw materials (data) enter one end, and finished goods (insights) come out the other.", commands:[{cmd:"ss -tulnp | awk '{print $5}' | grep -v Address | sort -u",desc:"Clean list of listening addresses"},{cmd:"journalctl -u nginx | grep -oP 'client: \\K[^,]+' | sort | uniq -c | sort -rn",desc:"Top IPs from nginx journal"},{cmd:"ls -lt /var/log/*.log | head -5",desc:"Most recently modified log files"}], example:"# Monitor disk usage of top 10 biggest directories:\n$ du -h /var/ 2>/dev/null \\\n  | sort -rh \\\n  | head -10\n\n# Watch for new SSH connections live:\n$ tail -f /var/log/auth.log \\\n  | grep --line-buffered 'Accepted'", nuance:"Add --line-buffered to grep in pipelines with tail -f. Without it, grep buffers output and you won't see results in real-time." }
        ],
        matchPairs:[{cmd:"2>/dev/null",purpose:"Discard error messages"},{cmd:"2>&1",purpose:"Merge stderr into stdout"},{cmd:"mkfifo",purpose:"Create a named pipe"},{cmd:"<< 'EOF'",purpose:"Start a heredoc block"},{cmd:"diff <(cmd1) <(cmd2)",purpose:"Compare command outputs directly"}]
      },
      {
        title: "Text Editors on the Command Line",
        concepts: [
          { heading:"Why Text Editors Matter on Servers", body:"Servers often have no GUI. You MUST know at least one terminal text editor. nano is beginner-friendly. vim is ubiquitous ‚Äî even minimal Docker containers have it. Every sysadmin needs basic vim survival skills.", analogy:"üñä Terminal editors=pen and paper in a world without computers. When there's no GUI, these are your only writing tools.", commands:[{cmd:"nano /etc/nginx/nginx.conf",desc:"Open file in nano (Ctrl+O save, Ctrl+X exit)"},{cmd:"vim /etc/nginx/nginx.conf",desc:"Open in vim"},{cmd:"vi file.txt",desc:"vi is usually a symlink to vim"}], example:"# nano shortcuts:\n# Ctrl+O = save (write Out)\n# Ctrl+X = exit\n# Ctrl+W = search\n# Ctrl+K = cut line\n# Ctrl+U = paste", nuance:"nano shows its shortcuts at the bottom of the screen. vim does not ‚Äî you must know them. The single most important vim skill: press Escape then :q! to exit without saving." },
          { heading:"vim Survival Skills", body:"vim has modes: Normal (navigate), Insert (type), Visual (select), Command (:). You always start in Normal mode. Press i to insert. Press Escape to return to Normal. : enters Command mode for saving and quitting.", analogy:"üéÆ vim=a game controller. Different buttons do different things depending on which 'mode' you're in.", commands:[{cmd:"i",desc:"Enter Insert mode (start typing)"},{cmd:"Escape",desc:"Return to Normal mode"},{cmd:":w",desc:"Save (write)"},{cmd:":q!",desc:"Quit without saving"},{cmd:":wq",desc:"Save and quit"},{cmd:"dd",desc:"Delete current line"},{cmd:"/searchterm",desc:"Search forward in file"}], example:"# Edit a file with vim:\n1. vim /etc/hosts\n2. Press 'i' to enter insert mode\n3. Navigate with arrow keys, type changes\n4. Press Escape\n5. Type ':wq' and press Enter to save+quit\n\n# Search and replace all:\n# :%s/old/new/g", nuance:"Learn these 5 commands and you can survive any vim situation: i (insert), Escape, :w (save), :q! (force quit), :wq (save+quit). Everything else is optional." },
          { heading:"sed ‚Äì Stream Editor for File Editing", body:"sed edits text streams ‚Äî like a find-and-replace that works from the command line without opening an editor. The -i flag edits files in-place. Perfect for scripted config changes.", analogy:"üîÑ sed=a surgical robot that makes precise, scripted changes without you touching the keyboard.", commands:[{cmd:"sed 's/old/new/' file",desc:"Replace first occurrence on each line"},{cmd:"sed 's/old/new/g' file",desc:"Replace ALL occurrences"},{cmd:"sed -i 's/old/new/g' file",desc:"Edit file in-place"},{cmd:"sed -i.bak 's/old/new/g' file",desc:"Edit in-place, keeping .bak backup"},{cmd:"sed -n '10,20p' file",desc:"Print only lines 10-20"}], example:"# Change a config value across a file without opening an editor:\n$ sed -i 's/worker_processes 1/worker_processes auto/' /etc/nginx/nginx.conf\n\n# Verify the change:\n$ grep worker_processes /etc/nginx/nginx.conf\nworker_processes auto;", nuance:"Always use sed -i.bak in scripts to keep a backup before in-place edits. That .bak file has saved data many times." },
          { heading:"awk ‚Äì Structured Text Processing", body:"awk is a full programming language for processing structured text ‚Äî particularly columnar data. It processes each line automatically, splitting it into fields ($1, $2, etc.) based on a delimiter.", analogy:"üìä awk=Excel's VLOOKUP and column extraction, but for text files from the command line.", commands:[{cmd:"awk '{print $1}' file",desc:"Print first field of each line"},{cmd:"awk -F: '{print $1,$3}' /etc/passwd",desc:"Print username and UID (colon-separated)"},{cmd:"awk '$3 > 1000' /etc/passwd",desc:"Print lines where field 3 > 1000"},{cmd:"awk 'END{print NR}' file",desc:"Count total lines (like wc -l)"}], example:"# Extract failed login IPs from auth.log:\n$ grep 'Failed password' /var/log/auth.log \\\n  | awk '{print $(NF-3)}' \\\n  | sort | uniq -c | sort -rn | head\n   892 45.83.1.99\n   234 192.168.1.200", nuance:"NF = number of fields in current line. $(NF) = last field. $(NF-1) = second to last. These are essential for parsing log files where position varies." }
        ],
        matchPairs:[{cmd:":wq",purpose:"Save and quit vim"},{cmd:":q!",purpose:"Force quit vim without saving"},{cmd:"sed -i.bak",purpose:"Edit file in-place with backup"},{cmd:"awk '{print $1}'",purpose:"Print first column of each line"},{cmd:"i (in vim)",purpose:"Enter insert mode"}]
      },
      {
        title: "Archiving, Compression & Transfers",
        concepts: [
          { heading:"tar ‚Äì The Linux Archive Standard", body:"tar (Tape ARchive) bundles files into one archive. Originally for magnetic tape backups, now used everywhere. It preserves file permissions, ownership, and timestamps ‚Äî critical for system backups.", analogy:"üì¶ tar=a professional packing service that labels everything perfectly and preserves the exact state of your belongings.", commands:[{cmd:"tar -czf archive.tar.gz dir/",desc:"Create compressed .tar.gz"},{cmd:"tar -xzf archive.tar.gz",desc:"Extract .tar.gz"},{cmd:"tar -xzf archive.tar.gz -C /target/",desc:"Extract to specific directory"},{cmd:"tar -tzf archive.tar.gz",desc:"List contents without extracting"},{cmd:"tar -czf - dir/ | ssh user@host 'cat > /backup/dir.tar.gz'",desc:"Stream archive over SSH"}], example:"# Real backup strategy:\n$ tar -czf /backup/webapp-$(date +%Y%m%d-%H%M).tar.gz \\\n    --exclude='*.log' \\\n    --exclude='node_modules' \\\n    /var/www/webapp/\n\n# Later, restore:\n$ tar -xzf /backup/webapp-20240110-0200.tar.gz -C /tmp/restore/", nuance:"--exclude is invaluable. node_modules and *.log can make archives gigantic. Always exclude them. Use tar -tzf to verify an archive before trusting a backup." },
          { heading:"gzip, bzip2, xz ‚Äì Compression Tools", body:"These compress individual files or streams. gzip is fastest. bzip2 compresses better but slower. xz gives the best compression ratios (used for Linux kernel tarballs). Each is a tradeoff between speed and size.", analogy:"‚öñÔ∏è gzip=fast postal service. bzip2=slower but smaller packages. xz=maximum compression, worth the wait for large files.", commands:[{cmd:"gzip file.txt",desc:"Compress to file.txt.gz (replaces original)"},{cmd:"gzip -k file.txt",desc:"Keep original while compressing"},{cmd:"gunzip file.txt.gz",desc:"Decompress"},{cmd:"bzip2 -k largefile.tar",desc:"Better compression, slower"},{cmd:"xz -k largefile.tar",desc:"Best compression ratio"}], example:"$ ls -lh data.tar\n-rw-r--r-- 1 alice alice 1.2G data.tar\n\n$ gzip -k data.tar && ls -lh data.tar.gz\n-rw-r--r-- 1 alice alice 340M data.tar.gz  # 72% smaller\n\n$ xz -k data.tar && ls -lh data.tar.xz\n-rw-r--r-- 1 alice alice 180M data.tar.xz  # 85% smaller", nuance:"For most use cases, gzip is the right choice ‚Äî fast and universally supported. Use xz when storage is at a premium or transfer size matters most." },
          { heading:"rsync ‚Äì The Best Way to Copy Files", body:"rsync is far superior to cp for large transfers. It only copies what changed (delta transfer), compresses in transit, preserves all file attributes, and works over SSH. Used for backups, deployments, and syncing servers.", analogy:"üîÑ rsync=a smart moving company that only moves boxes that changed since last time, instead of moving everything every trip.", commands:[{cmd:"rsync -av src/ dest/",desc:"Sync directories locally"},{cmd:"rsync -avz src/ user@host:/dest/",desc:"Sync to remote server with compression"},{cmd:"rsync -av --delete src/ dest/",desc:"Mirror: delete files in dest not in src"},{cmd:"rsync -av --dry-run src/ dest/",desc:"Preview what would be synced (safe test)"}], example:"# Automated daily website backup:\n$ rsync -avz --delete \\\n    --exclude='*.log' \\\n    --exclude='.git/' \\\n    /var/www/mysite/ \\\n    backup@192.168.1.50:/backups/mysite/\n\n# Output shows only what changed:\ndeleting old_file.php\nsending new_page.html", nuance:"Always --dry-run first when using --delete. A mistake with --delete can wipe the destination. rsync -avz --dry-run shows exactly what would happen without doing it." },
          { heading:"scp & sftp ‚Äì Secure File Transfer", body:"scp copies files securely over SSH ‚Äî simple, one-off transfers. sftp is an interactive FTP-like session over SSH ‚Äî useful for browsing remote filesystems and transferring multiple files. Both work wherever SSH works.", analogy:"üìÆ scp=sending a package via courier (one operation). sftp=walking into a store and browsing before buying (interactive).", commands:[{cmd:"scp file.txt user@server:/path/",desc:"Upload file"},{cmd:"scp user@server:/path/file.txt ./",desc:"Download file"},{cmd:"scp -r folder/ user@server:/path/",desc:"Upload entire directory"},{cmd:"sftp user@server",desc:"Open interactive SFTP session"},{cmd:"sftp> get file.txt",desc:"Download file in SFTP"},{cmd:"sftp> put file.txt",desc:"Upload file in SFTP"}], example:"# Real scenario: grab a database backup from production:\n$ scp -i ~/.ssh/prod_key \\\n    deploy@prod-db:/var/backups/db-latest.sql.gz \\\n    /local/backups/\n\n# Verify transfer:\n$ md5sum /local/backups/db-latest.sql.gz", nuance:"For frequent transfers to the same server, prefer rsync ‚Äî it's faster because it skips unchanged files. scp always copies the entire file even if it hasn't changed." }
        ],
        matchPairs:[{cmd:"tar -czf",purpose:"Create a compressed archive"},{cmd:"tar --exclude",purpose:"Skip files when archiving"},{cmd:"rsync --delete",purpose:"Mirror directories exactly"},{cmd:"rsync --dry-run",purpose:"Preview rsync without changes"},{cmd:"scp -r",purpose:"Recursively copy a directory over SSH"}]
      },
      {
        title: "Advanced Navigation & Productivity",
        concepts: [
          { heading:"pushd, popd ‚Äì Directory Stack", body:"pushd saves your current directory to a stack and moves to a new one. popd pops you back. This lets you juggle multiple working directories without losing your place ‚Äî much better than repeatedly cd-ing back and forth.", analogy:"üìö Directory stack=a stack of bookmarks. pushd places a bookmark, popd jumps back to the last one.", commands:[{cmd:"pushd /etc/nginx",desc:"Save current dir and go to /etc/nginx"},{cmd:"popd",desc:"Return to previous directory"},{cmd:"dirs",desc:"Show directory stack"},{cmd:"pushd +2",desc:"Rotate to item 2 in stack"}], example:"$ pwd\n/home/alice\n$ pushd /etc/nginx    # stack: [/etc/nginx, /home/alice]\n$ pushd /var/log      # stack: [/var/log, /etc/nginx, /home/alice]\n$ dirs\n/var/log /etc/nginx /home/alice\n$ popd               # back to /etc/nginx\n$ popd               # back to /home/alice", nuance:"pushd/popd are most useful during complex tasks where you need to repeatedly visit two or three directories. Most pros use them in shell sessions but rarely in scripts." },
          { heading:"screen ‚Äì Persistent Terminal Sessions", body:"screen (like tmux) lets you detach and reattach terminal sessions. If your SSH connection drops, your running processes survive inside screen. It's older than tmux but virtually always installed.", analogy:"üì∫ screen=a TV set you can put on pause. You leave, come back, and resume exactly where you were.", commands:[{cmd:"screen",desc:"Start a new screen session"},{cmd:"screen -S name",desc:"Start named session"},{cmd:"Ctrl+A, then D",desc:"Detach from screen (keeps running)"},{cmd:"screen -r",desc:"Reattach to session"},{cmd:"screen -ls",desc:"List all sessions"}], example:"# Start a long-running task in screen:\n$ screen -S database-migration\n$ python3 migrate.py --large-dataset\n# Ctrl+A, D to detach\n\n# Hours later:\n$ screen -r database-migration\n# See the migration progress still running!", nuance:"Choose tmux for new systems (more features). Use screen on older servers or minimal installs where tmux isn't available ‚Äî screen ships with most Linux distros." },
          { heading:"keyboard shortcuts ‚Äì Terminal Speed", body:"Terminal keyboard shortcuts turn good sysadmins into great ones. These work in Bash and most terminal applications. Muscle memory for these shortcuts saves hours every week.", analogy:"üéπ Terminal shortcuts=piano scales. Learn them until they're automatic and your hands fly.", commands:[{cmd:"Ctrl+C",desc:"Kill current command"},{cmd:"Ctrl+Z",desc:"Suspend command to background"},{cmd:"Ctrl+L",desc:"Clear screen (like 'clear')"},{cmd:"Ctrl+A",desc:"Go to beginning of line"},{cmd:"Ctrl+E",desc:"Go to end of line"},{cmd:"Ctrl+U",desc:"Delete from cursor to start of line"},{cmd:"Ctrl+W",desc:"Delete previous word"},{cmd:"Tab",desc:"Autocomplete filenames and commands"}], example:"# Efficient workflow example:\n$ sudo vim /etc/nginx/sites-available/mysi[Tab]  # autocompletes\n# Ctrl+A to jump to beginning to add something\n# Ctrl+E to jump back to end\n# Ctrl+U to clear the line if you change your mind", nuance:"Tab completion is the single most impactful habit to develop. It prevents typos, confirms the file exists, and is faster than typing. Always tab-complete paths." },
          { heading:"man pages & Getting Help", body:"Every Linux command has a manual page (man page) documenting all its options and behavior. man command opens it. --help gives a shorter summary. info gives even more detail for GNU tools.", analogy:"üìñ man pages=the official operations manual for every tool. Always exist, always accurate, no internet required.", commands:[{cmd:"man ls",desc:"Read ls manual (q to quit)"},{cmd:"man -k 'list files'",desc:"Search man pages by keyword"},{cmd:"ls --help",desc:"Quick flag summary"},{cmd:"apropos disk",desc:"Find commands related to 'disk'"},{cmd:"man 5 crontab",desc:"Man page section 5 (file formats)"}], example:"# Searching man pages:\n$ man -k compress | grep -i zip\ngzip (1)  - compress or expand files\nzip (1)   - package and compress files\n\n# Quick lookup:\n$ tar --help | grep exclude\n  --exclude=PATTERN    exclude files matching PATTERN", nuance:"Man pages have sections: 1=user commands, 2=system calls, 3=library functions, 5=file formats, 8=admin commands. 'man 5 crontab' and 'man 8 useradd' show the right sections." }
        ],
        matchPairs:[{cmd:"pushd /path",purpose:"Save dir and navigate to new one"},{cmd:"popd",purpose:"Return to previous directory"},{cmd:"screen -r",purpose:"Reattach to screen session"},{cmd:"Ctrl+R",purpose:"Search command history"},{cmd:"man -k keyword",purpose:"Search man pages by keyword"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 2 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß2 ‚Äì File Permissions & Users",
    lessons: [
      {
        title: "Understanding Permissions",
        concepts: [
          { heading:"Linux Permissions: Who Can Do What?", body:"Every file has 3 permission types: read (r), write (w), execute (x). These apply to 3 groups: owner, group, others. Like a document only you can edit, your team can read, but strangers can't touch.", analogy:"üè† Your house: you have all rooms. Family has some. Guests only the hallway.", commands:[], example:"-rwxr-xr-- 1 alice devs 4096 script.sh\n‚îÇ‚îî‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îò\n‚îÇ  u    g    o", nuance:"Leading - = regular file. d = directory. l = symlink (shortcut)." },
          { heading:"chmod ‚Äì Change Permissions", body:"chmod modifies who can read, write, or execute. Use symbolic (+x) or octal (755) notation.", analogy:"üîë chmod = changing which keys open which locks.", commands:[{cmd:"chmod +x script.sh",desc:"Make executable"},{cmd:"chmod 755 file",desc:"Owner:all, Group:rx, Others:rx"},{cmd:"chmod 600 secret",desc:"Only owner can read/write"},{cmd:"chmod -R 755 folder/",desc:"Apply recursively"}], example:"$ chmod 755 deploy.sh\n$ ls -l deploy.sh\n-rwxr-xr-x 1 alice alice 512 deploy.sh", nuance:"4=read 2=write 1=execute. 7=rwx 6=rw- 5=r-x 4=r--. chmod 777 is a security risk in production." },
          { heading:"chown ‚Äì Change Ownership", body:"chown changes who owns a file. Only root can do this. Like legally transferring a property deed.", analogy:"üìú chown = transferring a house deed to a new owner.", commands:[{cmd:"chown alice file.txt",desc:"Make alice the owner"},{cmd:"chown alice:devs file.txt",desc:"Set owner and group"},{cmd:"chown -R alice /var/www",desc:"Recursive ownership change"}], example:"$ sudo chown www-data:www-data /var/www/html", nuance:"Web servers often run as www-data or nginx. Web files need to be owned by that user." },
          { heading:"sudo ‚Äì Run as Administrator", body:"sudo (superuser do) runs a command as root. Root has unlimited power ‚Äî use it carefully. Linux keeps you from running as root all the time to protect against accidents.", analogy:"ü¶∏ sudo = acting as building manager for one task only.", commands:[{cmd:"sudo command",desc:"Run as root"},{cmd:"sudo su",desc:"Switch to a root shell"},{cmd:"sudo -l",desc:"See what sudo commands you can run"}], example:"$ sudo apt update\n[sudo] password for alice:", nuance:"Never use sudo carelessly. One typo as root can delete critical system files." }
        ],
        matchPairs:[{cmd:"chmod",purpose:"Change file permissions"},{cmd:"chown",purpose:"Change file ownership"},{cmd:"sudo",purpose:"Run as administrator"},{cmd:"chmod 600",purpose:"Owner-only read/write"},{cmd:"chmod +x",purpose:"Make file executable"}]
      },
      {
        title: "Users & Groups",
        concepts: [
          { heading:"Linux Is a Multi-User System", body:"Every person and even many programs run as a specific user. Users belong to groups that control what resources they can share. Like employees, departments, and a CEO.", analogy:"üè¢ Users=employees. Groups=departments. Root=CEO.", commands:[], example:"$ whoami\nalice\n$ id\nuid=1000(alice) groups=1000(alice),27(sudo)", nuance:"System users (www-data, daemon) aren't people ‚Äî they exist so services run with limited permissions." },
          { heading:"useradd, passwd, userdel", body:"useradd creates a user. passwd sets their password. userdel removes them. The core of access management.", analogy:"üë§ useradd=HR onboarding. passwd=badge PIN. userdel=offboarding.", commands:[{cmd:"sudo useradd -m bob",desc:"Create bob with home dir"},{cmd:"sudo passwd bob",desc:"Set bob's password"},{cmd:"sudo userdel -r bob",desc:"Delete bob and home dir"},{cmd:"whoami",desc:"Show current user"},{cmd:"id",desc:"Show UID, GID, groups"}], example:"$ sudo useradd -m bob\n$ sudo passwd bob\nNew password:", nuance:"Always use -m with useradd to create the home directory. Without it the user exists but has nowhere to store files." },
          { heading:"groupadd & usermod ‚Äì Groups", body:"groupadd creates a group. usermod modifies a user ‚Äî most commonly to add them to a group. Groups control access to shared resources.", analogy:"üóÇ groupadd=new department. usermod=transfer employee to it.", commands:[{cmd:"sudo groupadd devteam",desc:"Create a group"},{cmd:"sudo usermod -aG devteam alice",desc:"Add alice to devteam"},{cmd:"groups alice",desc:"List alice's groups"}], example:"$ sudo usermod -aG devteam alice\n$ groups alice\nalice : alice sudo devteam", nuance:"The -a in -aG means APPEND. Without it the user is removed from all other groups first ‚Äî a common painful mistake." },
          { heading:"su ‚Äì Switch User", body:"su switches to another user. su - (with a dash) loads their full environment too. You need their password unless you're root.", analogy:"üé≠ su = stepping into someone's office and working as them.", commands:[{cmd:"su bob",desc:"Switch to bob"},{cmd:"su - bob",desc:"Switch with full environment"},{cmd:"exit",desc:"Return to original user"}], example:"$ su - bob\n$ whoami\nbob\n$ exit\n$ whoami\nalice", nuance:"su - is preferred ‚Äî it loads the target's .bashrc and PATH properly." }
        ],
        matchPairs:[{cmd:"useradd",purpose:"Create a new user"},{cmd:"passwd",purpose:"Set a password"},{cmd:"usermod -aG",purpose:"Add user to a group"},{cmd:"whoami",purpose:"Show current username"},{cmd:"su -",purpose:"Switch user with full env"}]
      },
      {
        title: "Advanced Permission Scenarios",
        concepts: [
          { heading:"The Sticky Bit ‚Äì Shared Directories", body:"The sticky bit on a directory means only a file's OWNER (or root) can delete or rename it ‚Äî even if the directory is world-writable. /tmp uses it so users can't delete each other's temp files.", analogy:"üè† Sticky bit=/tmp is like a shared public mailbox. Anyone can deposit mail, but only the owner of each letter and the postmaster can remove it.", commands:[{cmd:"chmod +t /shared",desc:"Set sticky bit"},{cmd:"chmod 1777 /shared",desc:"World-writable + sticky bit (like /tmp)"},{cmd:"ls -ld /tmp",desc:"See sticky bit as 't' in permissions"}], example:"$ ls -ld /tmp\ndrwxrwxrwt 15 root root 4096 /tmp\n#          ^\n# 't' at the end = sticky bit set\n\n$ chmod 1777 /project/shared\n$ ls -ld /project/shared\ndrwxrwxrwt 2 alice alice 40 /project/shared", nuance:"The sticky bit was originally used to keep programs in swap memory (hence 'sticky'). For directories, it now means only the owner can delete their files. This is its only modern use." },
          { heading:"SetUID and SetGID Bits", body:"SetUID (SUID) on an executable makes it run as the FILE'S OWNER, not the user who ran it. This is how /usr/bin/passwd can write to /etc/shadow (owned by root) when run by a regular user. SetGID on a directory makes new files inherit the directory's group.", analogy:"ü¶∏ SUID=/usr/bin/passwd has a superpower: it temporarily becomes root to update the password file, then gives up that power when done.", commands:[{cmd:"chmod u+s /usr/bin/myapp",desc:"Set SUID bit"},{cmd:"chmod g+s /shared/",desc:"Set SGID bit on directory"},{cmd:"find / -perm -4000 -type f",desc:"Find all SUID files (security audit)"},{cmd:"find / -perm -2000 -type d",desc:"Find all SGID directories"}], example:"$ ls -l /usr/bin/passwd\n-rwsr-xr-x 1 root root /usr/bin/passwd\n#    ^-- 's' instead of 'x' = SUID\n# This file runs as root regardless of who executes it\n\n# SGID on a project directory:\n$ chmod g+s /var/www/html\n# New files created here inherit 'www-data' group", nuance:"SUID files are a security concern ‚Äî finding unexpected SUID executables is a key step in security audits and intrusion detection. Legitimate SUID files are few and well-known." },
          { heading:"Access Control Lists (ACLs)", body:"Standard Unix permissions only allow three tiers (owner/group/others). ACLs extend this to give any specific user or group fine-grained access to any file without changing group membership.", analogy:"üîë ACLs=giving individual spare keys to specific people, rather than changing who lives in the house (group membership).", commands:[{cmd:"getfacl file.txt",desc:"View ACL on a file"},{cmd:"setfacl -m u:bob:rx file.txt",desc:"Give bob read+execute on file.txt"},{cmd:"setfacl -m g:devteam:rw project/",desc:"Give devteam group read+write"},{cmd:"setfacl -x u:bob file.txt",desc:"Remove bob's ACL entry"},{cmd:"setfacl -b file.txt",desc:"Remove ALL ACL entries"}], example:"# Scenario: Web developer needs to read config without being in root group\n$ setfacl -m u:webdev:r /etc/myapp/config.conf\n$ getfacl /etc/myapp/config.conf\nuser:webdev:r--\ngroup::---\nother::---", nuance:"ACLs require the filesystem to be mounted with 'acl' option (ext4 enables this by default on modern Ubuntu). Check with 'tune2fs -l /dev/sda1 | grep acl'." },
          { heading:"umask ‚Äì Default Permission Control", body:"umask sets the default permissions subtracted from new files and directories. The default umask 022 means new files get 644 (rw-r--r--) and directories get 755 (rwxr-xr-x).", analogy:"üé≠ umask=a mask over a painting. You start with full permissions (666 for files), then the mask punches holes where permissions should be removed.", commands:[{cmd:"umask",desc:"Show current umask"},{cmd:"umask 027",desc:"Set umask to 027 (group can read, others nothing)"},{cmd:"umask 077",desc:"Set umask to 077 (owner only)"},{cmd:"echo 'umask 027' >> ~/.bashrc",desc:"Make umask permanent"}], example:"# Calculate: 666 - umask = file permissions\n# 666 - 022 = 644 (rw-r--r--)  standard\n# 666 - 027 = 640 (rw-r-----)  group readable\n# 666 - 077 = 600 (rw-------)  owner only\n\n$ umask 027\n$ touch newfile.txt\n$ ls -l newfile.txt\n-rw-r----- 1 alice alice newfile.txt", nuance:"For security-sensitive environments (keys, configs), set umask 077 so new files are owner-only by default. Remember umask is session-specific unless set in .bashrc." }
        ],
        matchPairs:[{cmd:"chmod +t",purpose:"Set sticky bit on directory"},{cmd:"chmod u+s",purpose:"Set SUID bit"},{cmd:"setfacl -m u:bob:rx",purpose:"Give bob specific ACL access"},{cmd:"getfacl",purpose:"View a file's ACL"},{cmd:"umask 077",purpose:"Make new files owner-only"}]
      },
      {
        title: "sudo Deep Dive",
        concepts: [
          { heading:"How sudo Works Internally", body:"sudo uses the /etc/sudoers file to determine what commands a user may run as root (or another user). It logs every invoked command. The sudo group (or wheel on RHEL) grants full sudo access.", analogy:"üèõ /etc/sudoers=a constitution listing exactly who has which executive powers, with a full audit trail.", commands:[{cmd:"sudo visudo",desc:"Safely edit /etc/sudoers (validates syntax)"},{cmd:"sudo -l",desc:"List commands YOU can run via sudo"},{cmd:"sudo -u alice command",desc:"Run command as alice (not just root)"},{cmd:"sudo -i",desc:"Interactive root shell"}], example:"$ sudo -l\nUser alice may run:\n  (ALL:ALL) ALL          # full sudo access\n  (ALL) NOPASSWD: /usr/bin/apt update  # no password for apt update", nuance:"NEVER edit /etc/sudoers directly ‚Äî a syntax error locks out all sudo access. Always use 'sudo visudo', which validates before saving." },
          { heading:"Writing sudoers Rules", body:"sudoers rules follow the format: WHO WHERE=(AS_WHOM) WHAT. You can restrict by host, target user, specific command, and whether a password is required. Fine-grained rules follow least-privilege principles.", analogy:"üìú sudoers rule=a signed permission slip specifying exactly who can do what, where, and as whom.", commands:[{cmd:"alice ALL=(ALL) ALL",desc:"Full sudo for alice"},{cmd:"alice ALL=(root) NOPASSWD: /usr/bin/systemctl restart nginx",desc:"Alice can restart nginx, no password"},{cmd:"%devteam ALL=(ALL) /usr/bin/apt",desc:"Group devteam can run apt"},{cmd:"Defaults timestamp_timeout=30",desc:"Remember sudo password for 30 minutes"}], example:"# /etc/sudoers.d/webteam\n# Web team can restart web services only:\n%webteam ALL=(root) NOPASSWD: \\\n  /usr/bin/systemctl restart nginx, \\\n  /usr/bin/systemctl restart php-fpm, \\\n  /usr/bin/nginx -t", nuance:"Use /etc/sudoers.d/ for per-user or per-team files rather than editing the main sudoers file ‚Äî it's cleaner and easier to manage. Files must have 0440 permissions." },
          { heading:"PAM ‚Äì Pluggable Authentication Modules", body:"PAM (Pluggable Authentication Modules) is the authentication backbone of Linux. It handles login authentication, password policies, session setup, and limits. sudo, SSH, login ‚Äî all use PAM.", analogy:"üîê PAM=a customizable security checkpoint framework. Each service uses PAM but PAM can be configured independently for each service.", commands:[{cmd:"cat /etc/pam.d/sshd",desc:"PAM config for SSH"},{cmd:"cat /etc/pam.d/sudo",desc:"PAM config for sudo"},{cmd:"faillock --user alice",desc:"See failed login attempts for alice"},{cmd:"faillock --user alice --reset",desc:"Reset alice's lockout counter"}], example:"# /etc/pam.d/common-password: enforce strong passwords\npassword requisite pam_pwquality.so \\\n  minlen=12 \\\n  dcredit=-1 \\\n  ucredit=-1 \\\n  lcredit=-1 \\\n  ocredit=-1\n# Requires: 12+ chars, 1 digit, 1 uppercase, 1 lowercase, 1 special", nuance:"PAM configuration mistakes can lock ALL users out of the system. Always keep a root session open while testing PAM changes, and test in a VM first." },
          { heading:"nsswitch.conf & Name Resolution", body:"/etc/nsswitch.conf controls where Linux looks for users, groups, hostnames, and other name lookups ‚Äî and in what order. It can pull from local files, LDAP, NIS, or DNS depending on your configuration.", analogy:"üìû nsswitch.conf=the directory assistance policy: 'first check the local phonebook, then call the central database'.", commands:[{cmd:"cat /etc/nsswitch.conf",desc:"View name service switch config"},{cmd:"getent passwd alice",desc:"Look up user alice via configured sources"},{cmd:"getent group devteam",desc:"Look up group devteam"},{cmd:"getent hosts myserver",desc:"Resolve hostname via configured sources"}], example:"# /etc/nsswitch.conf (typical):\npasswd: files systemd\ngroup:  files systemd\nhosts:  files mdns4_minimal dns\n\n# 'files' = /etc/passwd, /etc/group\n# 'dns'   = DNS server lookup\n\n$ getent hosts google.com\n142.250.185.238 google.com", nuance:"When LDAP or Active Directory integration is needed, nsswitch.conf is configured to include 'ldap' in the passwd and group lookups ‚Äî enabling centralized user management." }
        ],
        matchPairs:[{cmd:"sudo visudo",purpose:"Safely edit sudoers file"},{cmd:"sudo -l",purpose:"List your sudo permissions"},{cmd:"NOPASSWD:",purpose:"sudoers rule requiring no password"},{cmd:"getent passwd",purpose:"Look up user via name services"},{cmd:"faillock --reset",purpose:"Reset a user's lockout"}]
      },
      {
        title: "Ownership in Real Deployments",
        concepts: [
          { heading:"Web Server File Ownership Patterns", body:"Web servers like nginx and Apache run as specific users (www-data, nginx). Your application files need the right ownership and permissions so the server can read them but not modify them unnecessarily.", analogy:"üè™ Web server file ownership=a shop owner who can read the inventory list but can't alter the pricing records without a manager's key.", commands:[{cmd:"sudo chown -R www-data:www-data /var/www/html",desc:"Give web server ownership"},{cmd:"sudo chmod -R 755 /var/www/html",desc:"Directories readable, files executable"},{cmd:"sudo chmod -R 644 /var/www/html/**/*.html",desc:"HTML files: owner write, others read"},{cmd:"stat /var/www/html/index.html",desc:"Detailed file ownership and perms"}], example:"# Secure web root setup:\n$ sudo chown -R deploy:www-data /var/www/mysite\n$ sudo find /var/www/mysite -type d -exec chmod 750 {} \\;\n$ sudo find /var/www/mysite -type f -exec chmod 640 {} \\;\n# deploy user owns files (can write), www-data group can read", nuance:"Avoid making web-accessible files writable by www-data ‚Äî if the web server is compromised, attackers can modify your code. Owner writes, www-data group reads." },
          { heading:"Service Account Best Practices", body:"Production services should run as dedicated, non-privileged system users with restricted home directories, no login shell, and membership only in required groups. This limits damage if the service is compromised.", analogy:"üîí Service accounts=keycard access for robots. Each robot only opens the doors it absolutely needs ‚Äî no master key.", commands:[{cmd:"sudo useradd -r -s /usr/sbin/nologin myapp",desc:"Create system user, no login shell"},{cmd:"sudo useradd -r -d /opt/myapp -s /bin/false myapp",desc:"With specific home dir, no shell"},{cmd:"id myapp",desc:"Verify service user configuration"},{cmd:"loginctl list-sessions",desc:"See active login sessions"}], example:"# Create proper service account:\n$ sudo useradd \\\n    --system \\\n    --no-create-home \\\n    --shell /usr/sbin/nologin \\\n    --comment 'MyApp Service Account' \\\n    myapp\n\n# Verify:\n$ id myapp\nuid=999(myapp) gid=999(myapp) groups=999(myapp)", nuance:"--system accounts get UIDs below 1000. /usr/sbin/nologin as shell prevents interactive login even with valid credentials. This is standard practice for service accounts." },
          { heading:"Capabilities ‚Äì Fine-Grained Privileges", body:"Linux capabilities divide root's power into small units. Instead of running a service as root to bind port 80, you can grant just CAP_NET_BIND_SERVICE. This is a key tool for minimizing privilege.", analogy:"üîë Capabilities=surgical key cutting. Instead of a master key (root), give each service only the specific key cuts it needs.", commands:[{cmd:"getcap /usr/bin/ping",desc:"View capabilities on ping"},{cmd:"sudo setcap 'cap_net_bind_service=+ep' /usr/bin/node",desc:"Allow node to bind ports below 1024"},{cmd:"capsh --print",desc:"Show capabilities of current process"},{cmd:"sudo setcap -r /usr/bin/node",desc:"Remove all capabilities"}], example:"# Instead of running your app as root to use port 443:\n$ sudo setcap 'cap_net_bind_service=+ep' /usr/local/bin/myapp\n# Now myapp can bind port 443 running as an unprivileged user\n\n$ getcap /usr/local/bin/myapp\n/usr/local/bin/myapp = cap_net_bind_service+ep", nuance:"This is how modern servers handle low ports (80, 443) without running as root. CAP_NET_BIND_SERVICE is the most commonly used capability in this context." },
          { heading:"Auditing Permissions at Scale", body:"In a real environment with dozens of servers and hundreds of files, manually checking permissions doesn't scale. Scripting permission audits and using tools like find to detect drift is essential.", analogy:"üî≠ Permission auditing=a security guard doing a systematic building walkthrough ‚Äî checking every door and window, not just the obvious ones.", commands:[{cmd:"find /var/www -type f -perm /o=w",desc:"Find world-writable files (security risk)"},{cmd:"find / -nouser 2>/dev/null",desc:"Find files with no owner (orphaned)"},{cmd:"find / -nogroup 2>/dev/null",desc:"Find files with no group"},{cmd:"getfacl -R /var/www 2>/dev/null | grep -v ^#",desc:"Dump all ACLs recursively"}], example:"#!/bin/bash\n# Daily permission audit script:\necho '=== World-writable files in /var/www ==='\nfind /var/www -type f -perm /o=w 2>/dev/null\n\necho '=== SUID files (verify these are expected) ==='\nfind / -perm -4000 -type f 2>/dev/null\n\necho '=== Orphaned files ==='\nfind / -nouser 2>/dev/null | head -20", nuance:"Run permission audits after every deployment and user change. Unexpected world-writable files or new SUID executables are serious red flags that warrant immediate investigation." }
        ],
        matchPairs:[{cmd:"chown -R www-data",purpose:"Give web server file ownership"},{cmd:"useradd -r",purpose:"Create a system service account"},{cmd:"setcap cap_net_bind_service",purpose:"Allow low port binding without root"},{cmd:"find -perm /o=w",purpose:"Find world-writable files"},{cmd:"getcap",purpose:"View file capabilities"}]
      },
      {
        title: "PAM & Password Policies",
        concepts: [
          { heading:"Password Policy Enforcement", body:"Linux systems can enforce password complexity, minimum length, history, and expiry via PAM and chage. Without policies, users set weak passwords. With them, you meet compliance requirements (SOC2, PCI-DSS).", analogy:"üè¶ Password policy=bank vault combination rules: must be a certain length, changed regularly, and not reused.", commands:[{cmd:"sudo chage -l alice",desc:"Show alice's password expiry info"},{cmd:"sudo chage -M 90 alice",desc:"Set 90-day password expiry"},{cmd:"sudo chage -W 7 alice",desc:"Warn alice 7 days before expiry"},{cmd:"sudo passwd -e alice",desc:"Force alice to change password at next login"}], example:"$ sudo chage -l alice\nLast password change: Jan 01 2024\nPassword expires: Apr 01 2024\nPassword inactive: never\nAccount expires: never\nMin days between changes: 0\nMax days between changes: 90\nNumber of days of warning: 7", nuance:"chage settings only affect local user accounts. In environments with LDAP or Active Directory, password policies are managed centrally in the directory server." },
          { heading:"pam_pwquality ‚Äì Complexity Rules", body:"pam_pwquality enforces password complexity requirements ‚Äî minimum length, character classes, prohibition of dictionary words and usernames. It's configured in /etc/security/pwquality.conf.", analogy:"üõ° pam_pwquality=a password referee. It checks every proposed password against the rules and rejects those that don't qualify.", commands:[{cmd:"cat /etc/security/pwquality.conf",desc:"View password quality config"},{cmd:"sudo nano /etc/security/pwquality.conf",desc:"Edit password quality rules"},{cmd:"pwscore",desc:"Test a password's quality score (type password, then Ctrl+D)"}], example:"# /etc/security/pwquality.conf:\nminlen = 14        # minimum 14 characters\ndcredit = -1       # require at least 1 digit\nucredit = -1       # require at least 1 uppercase\nlcredit = -1       # require at least 1 lowercase\nocredit = -1       # require at least 1 special char\nmaxrepeat = 3      # no more than 3 identical chars in a row\nbadwords = company password admin", nuance:"Negative credits (-1) mean 'require at least one'. Positive credits would mean 'earning' complexity credit, reducing required length. Negative is what you want for enforcement." },
          { heading:"Account Locking & Login Restrictions", body:"pam_tally2 (older) or pam_faillock (modern) locks accounts after repeated failed logins. /etc/security/access.conf restricts which users can log in from which sources.", analogy:"üîí Account locking=a bank card that gets blocked after 3 wrong PINs. Prevents brute-force attacks on local logins.", commands:[{cmd:"faillock --user alice",desc:"Show alice's failed login count"},{cmd:"faillock --user alice --reset",desc:"Unlock alice's account"},{cmd:"pam_tally2 --user alice",desc:"Older systems: check tally"},{cmd:"cat /etc/security/access.conf",desc:"View login access restrictions"}], example:"# /etc/pam.d/common-auth for faillock:\nauth required pam_faillock.so preauth audit deny=5 unlock_time=600\n# After 5 failures, lock for 600 seconds (10 minutes)\n\n# Check who is locked:\n$ faillock | grep 'failure time'", nuance:"Set unlock_time to something reasonable ‚Äî not forever (0) or too short (30s). 600-3600 seconds (10-60 minutes) is typical for employee workstations." },
          { heading:"LDAP Integration for Centralized Auth", body:"In multi-server environments, managing users locally on each server doesn't scale. LDAP (Lightweight Directory Access Protocol) provides centralized user management. nsswitch and PAM route authentication to the LDAP server.", analogy:"üè¢ LDAP=corporate HR database. Instead of each department keeping their own employee list, everyone queries the single authoritative source.", commands:[{cmd:"sudo apt install libnss-ldap libpam-ldap",desc:"Install LDAP integration packages"},{cmd:"ldapsearch -x -H ldap://server -b 'dc=example,dc=com'",desc:"Test LDAP connection"},{cmd:"getent passwd",desc:"Verify LDAP users appear in output"},{cmd:"id ldapuser",desc:"Check if LDAP user is recognized"}], example:"# Verify LDAP integration:\n$ getent passwd | grep ldapuser\nldapuser:x:5000:5000:LDAP User:/home/ldapuser:/bin/bash\n\n# Can now SSH with LDAP credentials:\n$ ssh ldapuser@server\n# Authenticated against central LDAP!", nuance:"For production LDAP integration, use SSSD (System Security Services Daemon) instead of libnss-ldap ‚Äî it's more robust, caches credentials, and works when the LDAP server is temporarily unreachable." }
        ],
        matchPairs:[{cmd:"chage -M 90",purpose:"Set 90-day password expiry"},{cmd:"passwd -e alice",purpose:"Force password change at next login"},{cmd:"faillock --reset",purpose:"Unlock a locked account"},{cmd:"pam_pwquality",purpose:"Enforce password complexity"},{cmd:"getent passwd",purpose:"List all users including LDAP"}]
      },
      {
        title: "Real-World: Securing a New Server",
        concepts: [
          { heading:"The First 30 Minutes on a New Server", body:"When you get access to a fresh server, there's a standard hardening checklist to run through. These steps close the most common attack vectors before you deploy anything.", analogy:"üè† First 30 minutes=moving into a new house: change the locks, check the windows, install a security system before unpacking.", commands:[{cmd:"apt update && apt upgrade -y",desc:"Patch all packages immediately"},{cmd:"timedatectl set-timezone UTC",desc:"Set timezone to UTC (standard for servers)"},{cmd:"hostnamectl set-hostname prod-web-01",desc:"Set meaningful hostname"},{cmd:"useradd -m -s /bin/bash -G sudo deploy",desc:"Create deploy user"}], example:"#!/bin/bash\n# first-login.sh ‚Äî run on every new server\napt update && apt upgrade -y\nuseradd -m -s /bin/bash -G sudo deploy\nmkdir -p /home/deploy/.ssh\nchmod 700 /home/deploy/.ssh\nchown -R deploy:deploy /home/deploy/.ssh\necho 'YOUR_PUBLIC_KEY' > /home/deploy/.ssh/authorized_keys\nchmod 600 /home/deploy/.ssh/authorized_keys", nuance:"Never leave root as the only login. Create a non-root sudo user immediately. If root SSH login is disabled and your user is misconfigured, you can get locked out." },
          { heading:"Hardening SSH Configuration", body:"The default SSH config accepts password logins, allows root login, and allows all users. Hardening it dramatically reduces attack surface ‚Äî password brute-force attacks are constant on internet-facing servers.", analogy:"üîê Default SSH=an unlocked front door. Hardened SSH=a reinforced door with a deadbolt, chain, and alarm.", commands:[{cmd:"sed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config",desc:"Disable root login"},{cmd:"sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config",desc:"Disable password auth"},{cmd:"echo 'AllowUsers deploy alice' >> /etc/ssh/sshd_config",desc:"Whitelist allowed users"},{cmd:"sudo sshd -t",desc:"Test config before restarting"},{cmd:"sudo systemctl restart sshd",desc:"Apply changes"}], example:"# Secure sshd_config settings:\nPermitRootLogin no\nPasswordAuthentication no\nPubkeyAuthentication yes\nMaxAuthTries 3\nLoginGraceTime 60\nAllowUsers deploy alice\nX11Forwarding no\nAcceptEnv LANG LC_*", nuance:"ALWAYS keep your current SSH session open while testing! If you misconfigure and restart sshd in a separate session, you can diagnose it without losing access." },
          { heading:"fail2ban Configuration", body:"fail2ban watches log files and auto-bans IPs that make too many failed attempts. After installation, configure it for SSH and any other exposed services. Review and tune the ban time based on your threat model.", analogy:"üöì fail2ban=an automatic police response. Too many suspicious actions triggers an automatic ban, no manual intervention needed.", commands:[{cmd:"sudo apt install fail2ban",desc:"Install fail2ban"},{cmd:"cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local",desc:"Create local override file"},{cmd:"sudo fail2ban-client status",desc:"View active jails"},{cmd:"sudo fail2ban-client status sshd",desc:"View SSH jail stats"}], example:"# /etc/fail2ban/jail.local\n[DEFAULT]\nbantime = 3600      # ban for 1 hour\nfindtime = 600      # within 10-minute window\nmaxretry = 5        # after 5 failures\n\n[sshd]\nenabled = true\nport = 22\nlogpath = /var/log/auth.log\nmaxretry = 3        # stricter for SSH", nuance:"Use a whitelist for your own IPs: 'ignoreip = 127.0.0.1/8 ::1 YOUR.OFFICE.IP' in [DEFAULT]. This prevents accidentally banning yourself during testing." },
          { heading:"Automated Security Updates", body:"Unpatched systems are the #1 cause of server compromises. The unattended-upgrades package automatically applies security patches on Ubuntu/Debian without requiring manual intervention.", analogy:"üíä Automated updates=automatic medication refills. You don't have to remember to pick up your prescription ‚Äî it shows up before you run out.", commands:[{cmd:"sudo apt install unattended-upgrades",desc:"Install automatic updates"},{cmd:"sudo dpkg-reconfigure unattended-upgrades",desc:"Configure (choose Yes)"},{cmd:"cat /etc/apt/apt.conf.d/50unattended-upgrades",desc:"View configuration"},{cmd:"sudo unattended-upgrade --dry-run -d",desc:"Test what would be upgraded"}], example:"# /etc/apt/apt.conf.d/50unattended-upgrades\nUnattended-Upgrade::Allowed-Origins {\n  \"${distro_id}:${distro_codename}-security\";\n};\nUnattended-Upgrade::AutoFixInterruptedDpkg \"true\";\nUnattended-Upgrade::Mail \"admin@example.com\";\nUnattended-Upgrade::Automatic-Reboot \"true\";\nUnattended-Upgrade::Automatic-Reboot-Time \"03:00\";", nuance:"Set Automatic-Reboot-Time to a maintenance window. Kernel updates require reboots to take effect. Without auto-reboot, a kernel patch sits unapplied until you reboot manually." }
        ],
        matchPairs:[{cmd:"PermitRootLogin no",purpose:"Disable root SSH login"},{cmd:"PasswordAuthentication no",purpose:"Require SSH keys"},{cmd:"fail2ban-client status",purpose:"View fail2ban jails"},{cmd:"unattended-upgrades",purpose:"Automatically apply security patches"},{cmd:"sshd -t",purpose:"Test SSH config for errors"}]
      },
      {
        title: "Special Files & Filesystems",
        concepts: [
          { heading:"/proc ‚Äì The Process Information Filesystem", body:"/proc is a virtual filesystem that exposes kernel and process information as files. Every running process has a directory /proc/PID/ with detailed runtime information. System-wide info is in /proc directly.", analogy:"üî¨ /proc=a live MRI scan of your system's internals. Files aren't on disk ‚Äî they're generated on demand by the kernel.", commands:[{cmd:"cat /proc/cpuinfo",desc:"CPU details (cores, model, speed)"},{cmd:"cat /proc/meminfo",desc:"Detailed memory statistics"},{cmd:"cat /proc/loadavg",desc:"Load averages (same as uptime)"},{cmd:"ls /proc/$(pgrep nginx)/",desc:"Files for nginx's process"},{cmd:"cat /proc/1/cmdline | tr '\\0' ' '",desc:"Command line of PID 1 (systemd)"}], example:"$ cat /proc/1/status | head -5\nName: systemd\nState: S (sleeping)\nTgid: 1\nPid:  1\n\n$ cat /proc/$(pgrep nginx | head -1)/net/tcp\n# Shows nginx's open TCP connections in hex", nuance:"/proc files are not real files ‚Äî they can't be copied with cp -p (no size). Reading them gives a real-time snapshot of kernel state at that moment." },
          { heading:"/sys and /dev ‚Äì Hardware Interfaces", body:"/sys exposes kernel parameters and hardware configuration as a virtual filesystem. /dev contains device files ‚Äî your hard drive is /dev/sda, terminals are /dev/tty*, and /dev/null is the 'black hole' that discards everything written to it.", analogy:"üîå /dev=the control panel plugboard where every hardware device has a corresponding socket. /sys=the wiring diagram behind that panel.", commands:[{cmd:"ls /dev/sd*",desc:"List hard disk devices"},{cmd:"ls /dev/tty*",desc:"List terminal devices"},{cmd:"cat /dev/urandom | head -c 16 | base64",desc:"Generate random bytes from kernel entropy"},{cmd:"cat /sys/class/thermal/thermal_zone0/temp",desc:"CPU temperature in millidegrees"},{cmd:"ls /sys/block/",desc:"List block devices via sysfs"}], example:"$ cat /sys/block/sda/size\n1953525168  # sectors * 512 = bytes = drive size\n\n$ cat /sys/class/net/eth0/speed\n1000  # 1000 Mbps link speed\n\n# The null device - discard output:\n$ command > /dev/null 2>&1", nuance:"Kernel parameters in /sys can often be written to change system behavior at runtime: 'echo 1 > /sys/block/sda/queue/rotational' would tell the kernel this is an SSD." },
          { heading:"Inodes, Hard Links & Disk Reality", body:"Every file has an inode ‚Äî a data structure tracking its metadata (size, permissions, timestamps, location on disk) but NOT its name. The directory just maps names to inode numbers. Hard links are multiple names for one inode.", analogy:"üìö Inode=a library catalog card. The actual book (data) can have multiple catalog cards (hard links) pointing to it. Removing one card doesn't remove the book.", commands:[{cmd:"ls -li file.txt",desc:"Show inode number"},{cmd:"stat file.txt",desc:"Full inode info: size, blocks, times"},{cmd:"df -i",desc:"Inode usage per filesystem"},{cmd:"find / -inum 12345",desc:"Find all files sharing inode 12345"}], example:"$ ls -li\n1234567 -rw-r--r-- 2 alice alice 1024 notes.txt\n1234567 -rw-r--r-- 2 alice alice 1024 notes_link.txt\n# Same inode (1234567)! Same file, two names\n# Link count '2' confirms it\n\n$ df -i /\nFilesystem  Inodes  IUsed  IFree  IUse%\n/dev/sda1   3M      250K   2.75M    9%", nuance:"Running out of inodes is rare but possible ‚Äî you'll get 'no space left' errors even when df shows free space. df -i reveals this. Happens on filesystems with millions of tiny files." },
          { heading:"tmpfs and ramfs ‚Äì Memory-Based Filesystems", body:"tmpfs is a filesystem that lives in RAM (and swap). /tmp and /run are typically tmpfs on modern systems. It's much faster than disk, but data is lost on reboot. Used for temporary data, IPC sockets, and shared memory.", analogy:"üß† tmpfs=a whiteboard. Fast to write on, immediately readable, but erased when the office closes (reboot).", commands:[{cmd:"df -h | grep tmpfs",desc:"See all tmpfs mounts"},{cmd:"mount -t tmpfs tmpfs /mnt/ramdisk -o size=512m",desc:"Create a 512MB RAM disk"},{cmd:"ls /run",desc:"Runtime data: PIDs, sockets (tmpfs)"},{cmd:"ls /dev/shm",desc:"Shared memory (tmpfs)"}], example:"$ df -h | grep tmpfs\ntmpfs      3.9G   28M  3.9G   1% /run\ntmpfs      3.9G  100M  3.8G   3% /dev/shm\ntmpfs       20G    0   20G   0% /tmp\n\n# Create a ramdisk for a build pipeline:\n$ sudo mount -t tmpfs tmpfs /mnt/build -o size=2g\n$ # Build output here ‚Äî super fast, auto-cleaned on reboot", nuance:"tmpfs automatically expands and contracts as needed, up to its size limit. It's not a fixed block of RAM ‚Äî it only uses what's actually stored in it." }
        ],
        matchPairs:[{cmd:"cat /proc/cpuinfo",purpose:"View CPU information from kernel"},{cmd:"/dev/null",purpose:"Discard all written output"},{cmd:"df -i",purpose:"Check inode usage"},{cmd:"stat file.txt",purpose:"Show complete file metadata"},{cmd:"tmpfs",purpose:"RAM-based temporary filesystem"}]
      },
      {
        title: "Filesystem Permissions: Production Patterns",
        concepts: [
          { heading:"Shared Project Directory Setup", body:"Teams frequently need shared directories where multiple users can collaborate ‚Äî read/write ‚Äî but outside parties cannot access. Getting this right with groups, SGID, and permissions is a practical skill.", analogy:"üè¢ Shared project directory=a team office where everyone on the project has a key, but it's locked to outsiders.", commands:[{cmd:"sudo groupadd project",desc:"Create project group"},{cmd:"sudo usermod -aG project alice bob",desc:"Add team members"},{cmd:"sudo mkdir /opt/project && sudo chown root:project /opt/project",desc:"Create and assign group ownership"},{cmd:"sudo chmod 2775 /opt/project",desc:"SGID + rwxrwxr-x"}], example:"#!/bin/bash\n# Setup shared team directory\nGROUP=devteam\nDIR=/opt/shared\n\nsudo groupadd $GROUP\nsudo mkdir -p $DIR\nsudo chown root:$GROUP $DIR\nsudo chmod 2775 $DIR  # 2=SGID, 7=owner full, 7=group full, 5=others read+execute\n\n# Now any new files created here inherit 'devteam' group\necho 'Test' > $DIR/test.txt && ls -l $DIR/test.txt\n# -rw-r--r-- 1 alice devteam test.txt", nuance:"chmod 2775 sets rwxrwsr-x ‚Äî the 's' in group position is SGID. Without it, new files would get the creator's primary group, breaking the collaborative workflow." },
          { heading:"Web Application Permission Architecture", body:"A properly secured web app runs as a dedicated user, files are owned by a deploy user, the web server group can read them, and PHP/Node processes can write only to specific upload directories.", analogy:"üè™ Web app security layers=a store with a stockroom. Customers see the shop floor (web root). Only staff enter the stockroom (upload dirs). Management has master keys (deploy user).", commands:[{cmd:"sudo useradd -r -s /usr/sbin/nologin webapp",desc:"Create service user"},{cmd:"sudo find /var/www/app -type d -exec chmod 750 {} \\;",desc:"Directories: owner+group access"},{cmd:"sudo find /var/www/app -type f -exec chmod 640 {} \\;",desc:"Files: owner read/write, group read"},{cmd:"sudo chmod 770 /var/www/app/uploads/",desc:"Upload dir: service user can write"}], example:"# Complete web app permission setup:\n$ sudo chown -R deploy:www-data /var/www/myapp\n$ sudo find /var/www/myapp -type d -exec chmod 750 {} \\;\n$ sudo find /var/www/myapp -type f -exec chmod 640 {} \\;\n$ sudo chmod 770 /var/www/myapp/storage/  # Laravel/Django writable dirs\n\n# Result: deploy writes code, www-data reads it, users see nothing", nuance:"Never chmod 777 in production, even temporarily. It's a security hole. If a process needs write access, adjust ownership or ACLs instead." },
          { heading:"Deployment with Minimal Permissions", body:"Zero-downtime deployments use symlinks and carefully orchestrated permission changes. The deployment process briefly needs elevated permissions, then drops back to normal service permissions.", analogy:"üîÑ Deployment=changing a store's merchandise overnight while it's closed, then opening with everything in perfect order.", commands:[{cmd:"mkdir -p /opt/releases/v2.0",desc:"Create new release directory"},{cmd:"rsync -av build/ /opt/releases/v2.0/",desc:"Copy new code"},{cmd:"chown -R deploy:www-data /opt/releases/v2.0",desc:"Set ownership"},{cmd:"ln -sfn /opt/releases/v2.0 /opt/current",desc:"Atomic symlink swap ‚Äî instant cutover"}], example:"#!/bin/bash\n# Zero-downtime deploy:\nVERSION=$(git describe --tags)\nDEPLOY_DIR=/opt/releases/$VERSION\n\nrsync -av --chown=deploy:www-data ./dist/ $DEPLOY_DIR/\nfind $DEPLOY_DIR -type d -exec chmod 750 {} \\;\nfind $DEPLOY_DIR -type f -exec chmod 640 {} \\;\n\n# Atomic cutover:\nln -sfn $DEPLOY_DIR /opt/current\n\n# nginx serves /opt/current ‚Üí points to new version instantly\nnginx -s reload", nuance:"Symlink swaps are atomic from the OS's perspective ‚Äî nginx sees either the old or new version, never a mix. This is how tools like Capistrano and Deployer work." },
          { heading:"Security Scanning for Permission Issues", body:"Regular automated scans of your filesystem for permission issues catch misconfigurations before attackers do. These patterns should be part of any security baseline check.", analogy:"üîç Permission scanning=a security guard's systematic building inspection ‚Äî checking every door and window, not just the obvious ones.", commands:[{cmd:"find /var/www -perm /o=w -type f",desc:"World-writable files in web root (bad!)"},{cmd:"find / -perm -4000 -user root 2>/dev/null",desc:"Root-owned SUID files (verify each)"},{cmd:"find /home -maxdepth 2 -name '.ssh' ! -perm 700",desc:"SSH dirs with wrong permissions"},{cmd:"find /etc -maxdepth 1 -writable ! -user root",desc:"Non-root writable /etc files (suspicious)"}], example:"#!/bin/bash\n# Daily security permission audit:\n\necho '=== World-writable files in web roots ==='\nfind /var/www /opt -type f -perm /o=w 2>/dev/null | head -20\n\necho '=== Unexpected SUID executables ==='\nfind / -perm -4000 2>/dev/null | grep -v -f /etc/security/known_suid.txt\n\necho '=== SSH key permissions ==='\nfind /home -name 'authorized_keys' ! -perm 600 2>/dev/null", nuance:"Create a baseline list of expected SUID files after initial hardening. Then audit against it ‚Äî any new entry is suspicious and worth investigating immediately." }
        ],
        matchPairs:[{cmd:"chmod 2775",purpose:"Set SGID on shared directory"},{cmd:"ln -sfn new current",purpose:"Atomic symlink deployment swap"},{cmd:"find -perm /o=w",purpose:"Find world-writable files"},{cmd:"chown deploy:www-data",purpose:"Set deploy/webserver ownership"},{cmd:"find -perm -4000",purpose:"Find SUID root executables"}]
      },
      {
        title: "Password & Key Management",
        concepts: [
          { heading:"SSH Key Best Practices for Teams", body:"Managing SSH keys at scale requires discipline. Individual developers should use unique keys per machine. Servers should have a curated authorized_keys. Key rotation and auditing should be automated.", analogy:"üîë SSH key management=a building's keycard system. Each person has their own card. Lost/left company = card is immediately deactivated. Regular audits check who has access to what.", commands:[{cmd:"cat ~/.ssh/authorized_keys",desc:"List authorized keys for this account"},{cmd:"ssh-keygen -l -f ~/.ssh/id_ed25519.pub",desc:"Show key fingerprint"},{cmd:"ssh-keygen -t ed25519 -C 'alice@laptop-2024'",desc:"Generate key with identifying comment"},{cmd:"grep -c '^' ~/.ssh/authorized_keys",desc:"Count authorized keys"}], example:"# Audit authorized keys across all users:\n$ for user in $(getent passwd | awk -F: '$3>=1000{print $1}'); do\n    keyfile=\"/home/$user/.ssh/authorized_keys\"\n    [ -f \"$keyfile\" ] && echo \"=== $user ==\" && cat \"$keyfile\"\n  done\n\n# Show key fingerprints:\n$ ssh-keygen -l -f ~/.ssh/authorized_keys", nuance:"Use ed25519 keys (not RSA 2048). Include a comment with -C 'user@machine-date' to identify old keys during audits. Rotate keys when team members leave." },
          { heading:"gpg ‚Äì Encrypting Files and Signing", body:"GPG (GNU Privacy Guard) enables public-key encryption and digital signatures. Encrypt sensitive files so only the intended recipient can read them. Sign files to prove they came from you without modification.", analogy:"üì¨ GPG=a combination of a sealed envelope (encryption) and a notarized signature (digital signature). Only the recipient can open the envelope, and the signature proves who sent it.", commands:[{cmd:"gpg --gen-key",desc:"Generate a GPG key pair"},{cmd:"gpg --list-keys",desc:"List your keys"},{cmd:"gpg -e -r recipient@email secret.txt",desc:"Encrypt for recipient"},{cmd:"gpg -d secret.txt.gpg",desc:"Decrypt"},{cmd:"gpg --sign file.tar.gz",desc:"Create detached signature"}], example:"# Encrypt a database backup:\n$ mysqldump myapp | gzip | gpg -e -r admin@company.com > backup.sql.gz.gpg\n\n# Only the admin's private key can decrypt:\n$ gpg -d backup.sql.gz.gpg | gunzip | mysql myapp_restore", nuance:"GPG encryption is only as strong as the key management. Store private keys in a password manager. Use a strong passphrase on your private key." },
          { heading:"Secrets Management with Environment Variables", body:"Never hardcode credentials in code or config files that end up in git. Use environment variables to inject secrets at runtime. For production, use dedicated secrets managers (Vault, AWS Secrets Manager, etc.).", analogy:"üîê Environment variable secrets=a combination lock's combination memorized separately from the safe's location. The safe (code) and the combination (secret) are never written in the same place.", commands:[{cmd:"export DB_PASSWORD='secret'",desc:"Set secret in current shell"},{cmd:"DB_PASSWORD=$(cat /etc/secrets/db_password) ./app",desc:"Load secret from file"},{cmd:"printenv | grep -i pass",desc:"Audit for plaintext passwords in environment"},{cmd:"cat /proc/1/environ | tr '\\0' '\\n' | grep -i pass",desc:"Check init process environment"}], example:"# Never do this:\n# DB_URL=postgresql://admin:SuperSecret@db:5432/prod\n\n# Do this instead in systemd service:\n[Service]\nEnvironmentFile=/etc/myapp/secrets.env\n\n# /etc/myapp/secrets.env (chmod 600, owned by root):\nDB_PASSWORD=SuperSecret\nAPI_KEY=abc123", nuance:"EnvironmentFile in systemd services is one of the cleanest ways to inject secrets. Set chmod 600 and root ownership on the file so only root and the service can read it." },
          { heading:"Auditing and Rotating Credentials", body:"Credentials (passwords, API keys, SSH keys, certificates) have a lifecycle. Regular rotation limits the damage window if a credential is compromised. Auditing ensures you know what exists and who has access.", analogy:"üîÑ Credential rotation=changing locks periodically and after any suspicion of compromise. Regular audits=checking who has a copy of the key.", commands:[{cmd:"sudo chage -l alice",desc:"Check password age and expiry"},{cmd:"sudo passwd -e alice",desc:"Force immediate password change"},{cmd:"openssl x509 -in cert.pem -noout -dates",desc:"Check SSL certificate expiry"},{cmd:"lastlog",desc:"Last login for all users ‚Äî spot unused accounts"}], example:"#!/bin/bash\n# Weekly credential audit:\n\necho '=== Accounts that never logged in ==='\nlastlog | awk '$3 == \"Never\" && $1 != \"Username\" {print $1}'\n\necho '=== SSL certs expiring in 30 days ==='\nfor cert in /etc/ssl/certs/*.pem; do\n  openssl x509 -in $cert -noout -checkend 2592000 2>/dev/null || \\\n    echo \"EXPIRING: $cert\"\ndone", nuance:"Automate certificate expiry alerts. Let's Encrypt auto-renews, but custom/purchased certificates require manual renewal. Expired certs cause complete service outages." }
        ],
        matchPairs:[{cmd:"ssh-keygen -t ed25519",purpose:"Generate a modern SSH key pair"},{cmd:"gpg -e -r",purpose:"Encrypt file for recipient"},{cmd:"chage -l",purpose:"Check password expiry info"},{cmd:"EnvironmentFile=",purpose:"Load secrets into systemd service"},{cmd:"lastlog",purpose:"Show last login for all users"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 3 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß3 ‚Äì Processes & System Info",
    lessons: [
      {
        title: "Managing Processes",
        concepts: [
          { heading:"What Is a Process?", body:"A process is any running program. Every command, every service ‚Äî they're all processes, each with a unique PID (Process ID). Like active orders in a restaurant kitchen, each with a ticket number.", analogy:"üçΩ Computer=restaurant. Processes=active orders. PID=ticket number.", commands:[], example:"$ echo hello\nhello\n# That echo was a process ‚Äî started and finished instantly", nuance:"Processes spawn child processes. Your terminal is a process that spawns children when you run commands." },
          { heading:"ps & top ‚Äì View Processes", body:"ps gives a snapshot of current processes. top is a live updating view ‚Äî like a task manager. htop is a friendlier colorized version.", analogy:"üìã ps=photo of the kitchen. top=live camera feed.", commands:[{cmd:"ps aux",desc:"All running processes with details"},{cmd:"ps aux | grep nginx",desc:"Find a specific process"},{cmd:"top",desc:"Live process monitor (q to quit)"},{cmd:"htop",desc:"Enhanced live monitor (if installed)"}], example:"$ ps aux | grep apache\nwww-data  1234  0.0  apache2", nuance:"In top: press M to sort by memory, P to sort by CPU. The PID column is what you need to kill a process." },
          { heading:"kill & killall ‚Äì Stop Processes", body:"kill sends a signal to a process. Signal 15 (TERM) asks nicely. Signal 9 (KILL) forces immediate termination. killall targets by name.", analogy:"üõë Signal 15=asking an employee to stop. Signal 9=pulling the power plug.", commands:[{cmd:"kill 1234",desc:"Graceful stop PID 1234"},{cmd:"kill -9 1234",desc:"Force-kill PID 1234"},{cmd:"killall nginx",desc:"Kill all nginx processes"}], example:"$ ps aux | grep stuck\nalice 5678 99.9\n$ kill 5678\n$ kill -9 5678  # if needed", nuance:"kill -9 doesn't let the process save its work. Always try regular kill first and wait a few seconds." },
          { heading:"jobs, bg, fg ‚Äì Background Jobs", body:"Add & at the end of a command to background it. jobs lists background tasks. fg brings one forward. bg resumes a paused job in the background.", analogy:"üé≠ fg=task you're doing. bg=download running while you do something else.", commands:[{cmd:"command &",desc:"Run in background"},{cmd:"jobs",desc:"List background jobs"},{cmd:"fg %1",desc:"Bring job 1 to foreground"},{cmd:"Ctrl+Z",desc:"Pause current job"}], example:"$ sleep 100 &\n[1] 4321\n$ jobs\n[1]+ Running    sleep 100 &", nuance:"Background jobs die when you close the terminal. Use nohup or tmux to keep them running after logout." }
        ],
        matchPairs:[{cmd:"ps aux",purpose:"Show all processes"},{cmd:"top",purpose:"Live process monitor"},{cmd:"kill -9",purpose:"Force-kill a process"},{cmd:"killall",purpose:"Kill processes by name"},{cmd:"jobs",purpose:"List background jobs"}]
      },
      {
        title: "System Information",
        concepts: [
          { heading:"Disk, Memory & CPU Checks", body:"As a sysadmin, watching system resources is routine. Disks fill up, RAM gets exhausted, CPUs max out ‚Äî catching these early prevents outages.", analogy:"üè• Resource checks = doctor doing routine vitals. Catch problems before they become emergencies.", commands:[{cmd:"df -h",desc:"Disk space (human-readable)"},{cmd:"du -sh folder/",desc:"Size of a specific folder"},{cmd:"free -h",desc:"RAM and swap usage"},{cmd:"uptime",desc:"System uptime and CPU load"}], example:"$ df -h\n/dev/sda1   50G  38G  12G  76%\n\n$ free -h\nMem: 7.8G  4.2G  3.6G", nuance:"A filesystem at 100% can freeze the system ‚Äî services crash, logs stop writing. Monitor proactively." },
          { heading:"uname & hostname ‚Äì System Identity", body:"uname shows kernel and OS info. hostname shows the machine's network name. These are often the first things you check on a new server.", analogy:"ü™™ uname=birth certificate. hostname=name tag.", commands:[{cmd:"uname -a",desc:"Kernel, arch, date, all info"},{cmd:"hostname",desc:"Machine's hostname"},{cmd:"hostnamectl",desc:"Full host info (systemd systems)"}], example:"$ uname -a\nLinux webserver01 5.15.0-91 x86_64 GNU/Linux\n$ hostname\nwebserver01", nuance:"The kernel version is critical for security patching ‚Äî outdated kernels have known vulnerabilities." },
          { heading:"journalctl & dmesg ‚Äì System Logs", body:"dmesg shows kernel messages ‚Äî especially useful during boot or after plugging in hardware. journalctl reads systemd's central log journal ‚Äî the modern way to view all system logs.", analogy:"üì∞ dmesg=hardware diary. journalctl=complete newspaper archive of everything.", commands:[{cmd:"dmesg | tail -20",desc:"Last 20 kernel messages"},{cmd:"journalctl -xe",desc:"Recent logs with explanations"},{cmd:"journalctl -u nginx",desc:"Logs for one service"},{cmd:"journalctl --since today",desc:"Today's logs"}], example:"$ journalctl -u sshd --since today\nJan 10 sshd: Accepted password for alice\nJan 10 sshd: Failed password for root", nuance:"journalctl -xe is the first command to run when a service fails ‚Äî it gives recent critical errors with context." },
          { heading:"env & which ‚Äì Environment", body:"env shows your shell's environment variables. which shows exactly where a command lives on disk ‚Äî essential when you have multiple versions installed.", analogy:"üó∫ env=reading your shell's settings panel. which=asking 'where does this tool live?'", commands:[{cmd:"env",desc:"Show all environment variables"},{cmd:"echo $PATH",desc:"Show command search path"},{cmd:"which python3",desc:"Location of python3"},{cmd:"export MYVAR=hello",desc:"Set a session variable"}], example:"$ which nginx\n/usr/sbin/nginx\n$ which python3\n/usr/bin/python3", nuance:"PATH determines which version of a command runs. If a command 'isn't found', it's usually a PATH problem." }
        ],
        matchPairs:[{cmd:"df -h",purpose:"Disk space usage"},{cmd:"free -h",purpose:"RAM usage"},{cmd:"uname -a",purpose:"Kernel and system info"},{cmd:"journalctl",purpose:"View system logs"},{cmd:"which",purpose:"Find command location"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 4 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß4 ‚Äì Networking",
    lessons: [
      {
        title: "Network Basics",
        concepts: [
          { heading:"How Servers Communicate", body:"Every server has an IP address ‚Äî its postal address. Ports are like apartment numbers within that address. A web server on port 80 means 'web traffic goes to apartment 80'.", analogy:"üèô IP=street address. Port=apartment number. Data=packages.", commands:[], example:"http://192.168.1.10:80\n       ‚îî‚îÄIP addr‚îÄ‚îò‚îîport‚îò", nuance:"Common ports: 22=SSH, 80=HTTP, 443=HTTPS, 3306=MySQL, 5432=Postgres, 6379=Redis." },
          { heading:"ip & ifconfig ‚Äì Network Interfaces", body:"These commands show your machine's network interfaces ‚Äî its connection points. Each interface is a different 'radio' (wired, wireless, loopback).", analogy:"üì° Network interfaces = the phone's different radios (WiFi, cellular).", commands:[{cmd:"ip addr",desc:"All interfaces and IPs"},{cmd:"ip addr show eth0",desc:"One specific interface"},{cmd:"ifconfig",desc:"Older equivalent"}], example:"$ ip addr\n2: eth0: <UP>\n    inet 192.168.1.50/24", nuance:"lo (127.0.0.1/loopback) is your machine talking to itself ‚Äî it's always present." },
          { heading:"ping & traceroute ‚Äì Test Connectivity", body:"ping sends test packets and measures if they return. traceroute shows every router hop data takes ‚Äî like tracking every stop on a delivery route.", analogy:"üì¨ ping=mailing a postcard and waiting for it back. traceroute=tracking every stop.", commands:[{cmd:"ping google.com",desc:"Test if host is reachable"},{cmd:"ping -c 4 8.8.8.8",desc:"Send exactly 4 pings"},{cmd:"traceroute google.com",desc:"Show all network hops"}], example:"$ ping -c 4 8.8.8.8\n64 bytes: icmp_seq=1 time=12.3ms\n4 packets, 0% packet loss", nuance:"Some servers block ICMP (ping) for security ‚Äî no response doesn't always mean the server is down." },
          { heading:"ss & netstat ‚Äì Network Connections", body:"ss (socket statistics) shows active network connections and which ports are listening. It replaced the older netstat. Essential for verifying services are up.", analogy:"üö™ ss = showing all open doors and who's standing at each one.", commands:[{cmd:"ss -tuln",desc:"All listening TCP/UDP ports"},{cmd:"ss -tulnp",desc:"Same + which process owns each"},{cmd:"netstat -tuln",desc:"Older equivalent"}], example:"$ ss -tulnp\ntcp 0.0.0.0:22  sshd\ntcp 0.0.0.0:80  nginx", nuance:"An unexpected open port could indicate a security issue. Review regularly." }
        ],
        matchPairs:[{cmd:"ip addr",purpose:"Show IP addresses"},{cmd:"ping",purpose:"Test network reachability"},{cmd:"traceroute",purpose:"Show hops to a host"},{cmd:"ss -tuln",purpose:"Show listening ports"},{cmd:"ifconfig",purpose:"Older interface config tool"}]
      },
      {
        title: "SSH & Remote Access",
        concepts: [
          { heading:"SSH ‚Äì Secure Shell", body:"SSH connects you to remote Linux servers with encryption. Before SSH, admins used telnet which sent passwords in plain text. SSH fixed that with an encrypted tunnel.", analogy:"üîê SSH=armored vehicle carrying your commands. Telnet=shouting through an open window.", commands:[{cmd:"ssh user@hostname",desc:"Connect to remote server"},{cmd:"ssh alice@192.168.1.10",desc:"Connect using IP"},{cmd:"ssh -p 2222 user@host",desc:"Non-standard port"},{cmd:"exit",desc:"Close SSH session"}], example:"$ ssh alice@192.168.1.10\nalice@192.168.1.10's password:\nalice@webserver01:~$", nuance:"After SSH, all commands run on the REMOTE machine. Check your prompt ‚Äî it shows which host you're on." },
          { heading:"SSH Keys ‚Äì Passwordless Login", body:"SSH key pairs replace passwords. Your public key goes on the server; your private key stays local. The server verifies you without ever seeing your private key.", analogy:"üóù Public key=lock on the server door. Private key=your unique key. Only you can open it.", commands:[{cmd:"ssh-keygen -t ed25519",desc:"Generate modern key pair"},{cmd:"ssh-copy-id user@host",desc:"Copy public key to server"},{cmd:"cat ~/.ssh/authorized_keys",desc:"View allowed public keys on server"}], example:"$ ssh-keygen -t ed25519\n$ ssh-copy-id alice@192.168.1.10\n# Now login without password", nuance:"NEVER share your private key (~/.ssh/id_ed25519). Only the .pub file goes on servers." },
          { heading:"scp & rsync ‚Äì Copy Files Remotely", body:"scp copies files over SSH. rsync only copies what changed ‚Äî much faster for large transfers and perfect for backups.", analogy:"üì¶ scp=shipping a whole box. rsync=only replacing items that changed.", commands:[{cmd:"scp file.txt user@host:/path/",desc:"Copy file to remote"},{cmd:"scp user@host:/file.txt ./",desc:"Copy from remote to local"},{cmd:"rsync -avz src/ user@host:/dest/",desc:"Sync a folder remotely"}], example:"$ rsync -avz ./website/ alice@webserver:/var/www/html/", nuance:"rsync -avz: a=archive (preserves permissions), v=verbose, z=compress. Use rsync for regular backups." },
          { heading:"curl & wget ‚Äì Downloads & API Calls", body:"curl makes HTTP requests from the command line ‚Äî great for downloading and API testing. wget is simpler and better for just downloading files.", analogy:"üåê curl=browser dev tools from the terminal. wget=download manager.", commands:[{cmd:"curl https://example.com",desc:"Fetch a URL"},{cmd:"curl -O https://site.com/file",desc:"Download a file"},{cmd:"curl -X POST -d data url",desc:"Send a POST request"},{cmd:"wget https://site.com/file",desc:"Download with wget"}], example:"$ curl https://api.ipify.org\n203.0.113.42\n# Returns your public IP", nuance:"curl -v shows full request/response headers. Add -I for just the headers." }
        ],
        matchPairs:[{cmd:"ssh",purpose:"Connect to remote server"},{cmd:"ssh-keygen",purpose:"Generate SSH key pair"},{cmd:"scp",purpose:"Copy files over SSH"},{cmd:"rsync",purpose:"Sync folders efficiently"},{cmd:"curl",purpose:"Make HTTP requests"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 5 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß5 ‚Äì Packages & Services",
    lessons: [
      {
        title: "Installing Software",
        concepts: [
          { heading:"Package Managers: Linux's App Store", body:"Linux uses package managers instead of an app store. apt on Ubuntu/Debian, yum/dnf on RHEL/CentOS. They download, install, update, and remove software ‚Äî including all dependencies automatically.", analogy:"üõí Package manager=grocery delivery. You say what you want, it figures out all ingredients.", commands:[{cmd:"sudo apt update",desc:"Refresh available package list"},{cmd:"sudo apt upgrade",desc:"Install all updates"},{cmd:"sudo apt install nginx",desc:"Install nginx"},{cmd:"sudo apt remove nginx",desc:"Remove nginx"},{cmd:"apt search nginx",desc:"Search for a package"}], example:"$ sudo apt update && sudo apt install nginx\nReading package lists...\nnginx is already the newest version", nuance:"Always run apt update before apt install to get the latest version." },
          { heading:"dpkg ‚Äì Low-Level Package Tool", body:"dpkg is the engine behind apt on Debian/Ubuntu. It installs .deb files directly. apt is usually preferred because it handles dependencies automatically.", analogy:"üîß apt=automatic assembly line. dpkg=assembling each part by hand.", commands:[{cmd:"sudo dpkg -i package.deb",desc:"Install a .deb file"},{cmd:"dpkg -l | grep nginx",desc:"Check if package is installed"}], example:"$ sudo dpkg -i chrome.deb\n$ dpkg -l | grep chrome\nii  google-chrome-stable", nuance:"'ii' in dpkg -l output means installed and working correctly. 'rc' means removed but config files remain." },
          { heading:"systemctl ‚Äì Control Services", body:"systemctl manages services (daemons) ‚Äî long-running background programs like web servers and databases. Services can start automatically when the system boots.", analogy:"üéõ systemctl=control panel for all background workers.", commands:[{cmd:"systemctl status nginx",desc:"Check if nginx is running"},{cmd:"sudo systemctl start nginx",desc:"Start nginx"},{cmd:"sudo systemctl stop nginx",desc:"Stop nginx"},{cmd:"sudo systemctl restart nginx",desc:"Restart nginx"},{cmd:"sudo systemctl enable nginx",desc:"Start on every boot"},{cmd:"sudo systemctl disable nginx",desc:"Don't start on boot"}], example:"$ systemctl status nginx\n‚óè nginx.service\n   Active: active (running)", nuance:"enable and disable affect boot behavior but don't start/stop now. Use --now to do both: 'systemctl enable --now nginx'." },
          { heading:"cron ‚Äì Schedule Tasks", body:"cron runs commands at set times ‚Äî like a backup every night at 2am. You define schedules in a crontab file using a specific 5-field format.", analogy:"‚è∞ cron=recurring calendar event for your computer.", commands:[{cmd:"crontab -e",desc:"Edit your cron schedule"},{cmd:"crontab -l",desc:"List current cron jobs"},{cmd:"sudo crontab -e",desc:"Edit root's cron schedule"}], example:"# minute hour day month weekday command\n0 2 * * * /usr/bin/backup.sh\n# Runs backup.sh at 2am every day\n\n*/5 * * * * /usr/bin/check.sh\n# Runs check.sh every 5 minutes", nuance:"Cron doesn't have your PATH. Always use absolute paths like /usr/bin/python3 not just python3." }
        ],
        matchPairs:[{cmd:"apt install",purpose:"Install a package"},{cmd:"apt update",purpose:"Refresh package lists"},{cmd:"systemctl status",purpose:"Check a service's status"},{cmd:"systemctl enable",purpose:"Start service on boot"},{cmd:"crontab -e",purpose:"Edit scheduled tasks"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 6 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß6 ‚Äì Text Processing & Scripting",
    lessons: [
      {
        title: "Power Text Tools",
        concepts: [
          { heading:"Pipes & Redirection", body:"The pipe | feeds one command's output into the next. > saves output to a file. >> appends. This is one of Linux's greatest superpowers ‚Äî chaining simple tools to do complex things.", analogy:"üîß Pipes=assembly line conveyor belts. Each station does one job and passes results on.", commands:[{cmd:"ls | wc -l",desc:"Count files in directory"},{cmd:"cat log | grep err | tail -20",desc:"Find last 20 error lines"},{cmd:"echo text > file.txt",desc:"Write to file (overwrites)"},{cmd:"echo more >> file.txt",desc:"Append to file"}], example:"$ ps aux | grep python | wc -l\n3\n# 3 python processes running", nuance:"> overwrites the file completely. >> appends. Mixing them up is a common way to accidentally destroy files." },
          { heading:"awk & sed ‚Äì Transform Text", body:"sed finds and replaces text in streams. awk processes and extracts fields from structured text ‚Äî like printing specific columns from a table.", analogy:"‚úÇÔ∏è sed=find-and-replace. awk=Excel's column extraction.", commands:[{cmd:"sed 's/old/new/g' file",desc:"Replace all 'old' with 'new'"},{cmd:"sed -i 's/old/new/g' file",desc:"In-place replacement (edits file)"},{cmd:"awk '{print $1}' file",desc:"Print first column"},{cmd:"awk -F: '{print $1}' /etc/passwd",desc:"Extract usernames"}], example:"$ echo 'Hello World' | sed 's/World/Linux/'\nHello Linux\n$ df -h | awk '{print $1, $5}'\nFilesystem Use%", nuance:"sed -i edits the file directly. Use sed -i.bak to keep a backup of the original before editing." },
          { heading:"sort, uniq, wc ‚Äì Analyze Text", body:"sort alphabetically orders lines. uniq removes consecutive duplicates (use after sort). wc counts lines, words, and characters.", analogy:"üìä sort=alphabetize a stack of cards. uniq=remove duplicates. wc=count the stack.", commands:[{cmd:"sort names.txt",desc:"Sort alphabetically"},{cmd:"sort file | uniq",desc:"Remove duplicates"},{cmd:"sort file | uniq -c",desc:"Count occurrences of each line"},{cmd:"wc -l file.txt",desc:"Count lines"}], example:"$ cat access.log | awk '{print $1}' | sort | uniq -c | sort -rn | head -5\n342 192.168.1.100\n251 10.0.0.5\n# Top 5 IPs hitting your server", nuance:"This pipeline is a classic sysadmin one-liner for log analysis. Small tools become powerful when chained." },
          { heading:"Shell Scripting Basics", body:"A shell script is a text file of commands that run in sequence. Write repetitive tasks once, run them with one command. Scripts are the foundation of automation.", analogy:"üìã A shell script=a recipe. Write it once, follow it every time.", commands:[{cmd:"#!/bin/bash",desc:"Shebang ‚Äî tells system to use bash"},{cmd:"chmod +x script.sh",desc:"Make script executable"},{cmd:"./script.sh",desc:"Run the script"},{cmd:"bash script.sh",desc:"Run without making executable"}], example:"#!/bin/bash\n# backup.sh\nDATE=$(date +%Y-%m-%d)\ntar -czf /backup/files-$DATE.tar.gz /var/www/html/\necho \"Done: files-$DATE.tar.gz\"", nuance:"The shebang (#!/bin/bash) must be the very first line. Use shellcheck.net to check scripts for mistakes." }
        ],
        matchPairs:[{cmd:"|",purpose:"Pipe output to next command"},{cmd:">",purpose:"Redirect output to file"},{cmd:"sed 's/a/b/'",purpose:"Find and replace text"},{cmd:"awk '{print $1}'",purpose:"Extract first column"},{cmd:"wc -l",purpose:"Count lines in a file"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 7 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß7 ‚Äì Storage & Disks",
    lessons: [
      {
        title: "Managing Storage",
        concepts: [
          { heading:"Linux Storage Concepts", body:"Linux sees disks as files in /dev/. A disk might be /dev/sda. Partitions are /dev/sda1, /dev/sda2, etc. To use a partition you 'mount' it to a directory ‚Äî making its contents accessible at that path.", analogy:"üì¶ Disk=storage unit building. Partitions=individual units. Mounting=getting a key and room number.", commands:[{cmd:"lsblk",desc:"List all block devices"},{cmd:"fdisk -l",desc:"Partition details (root)"},{cmd:"blkid",desc:"Show UUIDs and filesystems"}], example:"$ lsblk\nsda   50G disk\n‚îú‚îÄsda1 49G / \n‚îî‚îÄsda2  1G [SWAP]", nuance:"UUID (from blkid) is used in /etc/fstab. UUIDs don't change even if you add/remove disks." },
          { heading:"mount & umount", body:"mount connects a filesystem to a directory. umount safely disconnects it. Always unmount before physically unplugging a drive.", analogy:"üîå mount=plugging in a USB. umount=safely ejecting before removing.", commands:[{cmd:"mount /dev/sdb1 /mnt/data",desc:"Mount partition"},{cmd:"mount | grep sdb",desc:"Verify mount"},{cmd:"umount /mnt/data",desc:"Safely unmount"}], example:"$ sudo mount /dev/sdb1 /mnt/external\n$ df -h | grep sdb\n/dev/sdb1  100G  20G  80G  20% /mnt/external", nuance:"If umount says 'device is busy', something is using it. Use 'lsof +D /mnt/data' to find what." },
          { heading:"/etc/fstab ‚Äì Persistent Mounts", body:"/etc/fstab tells Linux what to mount automatically at boot. Each line defines device, mount point, filesystem type, and options.", analogy:"üìÖ fstab=recurring calendar event: 'every time system starts, mount this drive here'.", commands:[{cmd:"cat /etc/fstab",desc:"View persistent mounts"},{cmd:"sudo nano /etc/fstab",desc:"Edit fstab"},{cmd:"sudo mount -a",desc:"Mount everything in fstab (test)"}], example:"# /etc/fstab\nUUID=abc-123  /mnt/data  ext4  defaults  0  2", nuance:"A typo in fstab can prevent the system from booting. Always test with 'mount -a' before rebooting." },
          { heading:"mkfs & fsck ‚Äì Format and Repair", body:"mkfs creates a filesystem on a partition (formatting). fsck checks and repairs a filesystem. These are powerful, destructive operations ‚Äî extreme care required.", analogy:"üíø mkfs=formatting a blank drive. fsck=running Check Disk in Windows.", commands:[{cmd:"sudo mkfs.ext4 /dev/sdb1",desc:"Format as ext4 ‚Äî DESTROYS DATA"},{cmd:"sudo fsck /dev/sdb1",desc:"Check and repair filesystem"}], example:"$ sudo mkfs.ext4 /dev/sdb1\nmke2fs 1.46.5\nCreating filesystem...", nuance:"NEVER run mkfs on a mounted partition. Triple-check the device name ‚Äî the wrong device permanently erases all data." }
        ],
        matchPairs:[{cmd:"lsblk",purpose:"List block devices"},{cmd:"mount",purpose:"Attach a filesystem"},{cmd:"umount",purpose:"Safely detach filesystem"},{cmd:"mkfs",purpose:"Format a partition"},{cmd:"fsck",purpose:"Check/repair filesystem"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 8 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß8 ‚Äì Security & Advanced Admin",
    lessons: [
      {
        title: "Firewalls & Security",
        concepts: [
          { heading:"ufw ‚Äì Uncomplicated Firewall", body:"ufw is the beginner-friendly Ubuntu firewall. A firewall is a bouncer deciding which network traffic is allowed in and out based on rules you define.", analogy:"üöß Firewall=airport security checkpoint. ufw lets you define who gets through.", commands:[{cmd:"sudo ufw status",desc:"Check firewall state and rules"},{cmd:"sudo ufw enable",desc:"Turn on firewall"},{cmd:"sudo ufw allow 22",desc:"Allow SSH"},{cmd:"sudo ufw allow 80",desc:"Allow HTTP"},{cmd:"sudo ufw deny 3306",desc:"Block MySQL externally"}], example:"$ sudo ufw status\nTo    Action  From\n22    ALLOW   Anywhere\n80    ALLOW   Anywhere\n3306  DENY    Anywhere", nuance:"Allow port 22 BEFORE enabling ufw or you'll lock yourself out remotely. This is a very common mistake." },
          { heading:"fail2ban ‚Äì Block Brute Force", body:"fail2ban monitors logs for repeated failed logins and blocks those IPs with firewall rules. Without it, attackers can try millions of passwords against SSH.", analogy:"üîí fail2ban=bank that locks after 5 wrong PINs ‚Äî making brute force impractical.", commands:[{cmd:"sudo systemctl status fail2ban",desc:"Check if running"},{cmd:"sudo fail2ban-client status sshd",desc:"See banned IPs for SSH"},{cmd:"sudo fail2ban-client set sshd unbanip 1.2.3.4",desc:"Unban an IP"}], example:"$ sudo fail2ban-client status sshd\nCurrently banned: 3\nBanned IPs: 45.83.1.10", nuance:"fail2ban can protect nginx, apache, postfix ‚Äî any service that logs auth failures." },
          { heading:"find ‚Äì Advanced File Search", body:"find locates files by name, size, age, owner, permissions, and more. Essential for security audits and cleanup tasks.", analogy:"üî¶ find=professional investigator ‚Äî far more thorough than looking in obvious places.", commands:[{cmd:"find / -name '*.log'",desc:"Find all .log files"},{cmd:"find /home -user alice",desc:"Files owned by alice"},{cmd:"find / -perm -4000",desc:"SUID files (security check)"},{cmd:"find /tmp -mtime +7 -delete",desc:"Delete temp files older than 7 days"},{cmd:"find . -size +100M",desc:"Files larger than 100MB"}], example:"$ find / -perm -4000 2>/dev/null\n/usr/bin/sudo\n/usr/bin/passwd", nuance:"Always test find without -delete first to preview what would be removed. Add 2>/dev/null to suppress permission errors." },
          { heading:"tar & gzip ‚Äì Archives", body:"tar bundles files into one archive. gzip compresses them. Together (.tar.gz) you get compressed archives ‚Äî the Linux equivalent of .zip.", analogy:"üì¶ tar=packing a box. gzip=vacuum-sealing it. tar.gz=vacuum-sealed box.", commands:[{cmd:"tar -czf archive.tar.gz folder/",desc:"Create compressed archive"},{cmd:"tar -xzf archive.tar.gz",desc:"Extract archive"},{cmd:"tar -tzf archive.tar.gz",desc:"List contents without extracting"},{cmd:"gzip file.txt",desc:"Compress one file"}], example:"$ tar -czf backup-$(date +%Y%m%d).tar.gz /var/www/html/\n$ ls -lh\n-rw-r--r-- 1 alice 145M backup-20240110.tar.gz", nuance:"Flags: c=create x=extract z=gzip f=file v=verbose. Mnemonic: 'create or extract, always need file'." }
        ],
        matchPairs:[{cmd:"ufw enable",purpose:"Turn on firewall"},{cmd:"ufw allow 22",purpose:"Allow SSH through firewall"},{cmd:"fail2ban",purpose:"Block brute force attacks"},{cmd:"tar -czf",purpose:"Create compressed archive"},{cmd:"find -perm -4000",purpose:"Find SUID files"}]
      },
      {
        title: "Advanced Administration",
        concepts: [
          { heading:"tmux ‚Äì Terminal Multiplexer", body:"tmux lets you run multiple terminal sessions in one window and keep them alive after disconnecting. If SSH drops, your processes keep running inside tmux.", analogy:"üñ• tmux=an office that keeps running even when you go home ‚Äî you reconnect and everything is as you left it.", commands:[{cmd:"tmux",desc:"Start new session"},{cmd:"tmux new -s name",desc:"Start named session"},{cmd:"tmux attach -t name",desc:"Reattach to session"},{cmd:"tmux ls",desc:"List all sessions"}], example:"# Inside tmux:\n# Ctrl+b, c = new window\n# Ctrl+b, n = next window\n# Ctrl+b, d = detach (keeps running)\n# Ctrl+b, % = split pane", nuance:"Without tmux, a dropped SSH connection kills all your running processes. Every serious sysadmin uses it." },
          { heading:"watch & iostat ‚Äì Live Monitoring", body:"watch runs a command every N seconds showing live updates. iostat monitors disk I/O. Together they give a real-time health picture.", analogy:"üëÅ watch=security camera pointed at a metric ‚Äî keeps refreshing automatically.", commands:[{cmd:"watch -n 2 df -h",desc:"Refresh disk usage every 2s"},{cmd:"watch -n 1 'ps aux | grep nginx'",desc:"Monitor process every second"},{cmd:"iostat -x 2",desc:"Disk I/O every 2s"},{cmd:"vmstat 2",desc:"Virtual memory stats every 2s"}], example:"$ watch -n 5 'tail -5 /var/log/nginx/access.log'\n# Refreshes last 5 nginx log lines every 5 seconds", nuance:"watch is excellent during deployments ‚Äî set it monitoring a service status or disk space in a tmux pane." },
          { heading:"at ‚Äì One-Time Scheduled Tasks", body:"cron is for repeating schedules. at runs a task once at a specific future time ‚Äî like scheduling a maintenance reboot at 3am.", analogy:"‚è± cron=recurring alarm. at=a single one-time alarm.", commands:[{cmd:"at 3am tomorrow",desc:"Schedule task for 3am tomorrow"},{cmd:"at now + 30 minutes",desc:"Schedule 30 minutes from now"},{cmd:"atq",desc:"List pending at jobs"},{cmd:"atrm 3",desc:"Remove at job #3"}], example:"$ at 2am tomorrow\nat> /usr/bin/certbot renew\nat> (Ctrl+D)\njob 7 at Tue Jan 11 02:00:00 2024", nuance:"at requires the atd daemon. Check 'systemctl status atd'. You may need 'apt install at' on minimal installs." },
          { heading:"The Sysadmin Mindset", body:"Great sysadmins aren't defined by memorizing commands ‚Äî they're defined by systematic problem-solving. When something breaks: 1) Check logs. 2) Check services. 3) Check resources. 4) Check network. 5) Read error messages carefully.", analogy:"üïµÔ∏è Sysadmin=detective. Server=crime scene. Logs=witness statements. Gather evidence before guessing.", commands:[{cmd:"journalctl -xe",desc:"First stop: recent errors"},{cmd:"systemctl status svc",desc:"Is the service running?"},{cmd:"df -h && free -h",desc:"Is disk or RAM full?"},{cmd:"ss -tulnp",desc:"Is the expected port listening?"}], example:"# Service down checklist:\n$ systemctl status myapp\n$ journalctl -u myapp -n 50\n$ df -h && free -h\n$ ss -tulnp | grep 8080", nuance:"Document everything during incidents. Your future self (and colleagues) will thank you." }
        ],
        matchPairs:[{cmd:"tmux",purpose:"Persistent terminal sessions"},{cmd:"watch -n 2",purpose:"Refresh command every 2s"},{cmd:"at 3am",purpose:"One-time scheduled task"},{cmd:"iostat",purpose:"Monitor disk I/O"},{cmd:"journalctl -xe",purpose:"View recent system errors"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 9 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß9 ‚Äì Shell Scripting Deep Dive",
    lessons: [
      {
        title: "Variables & Input",
        concepts: [
          { heading:"Variables in Bash", body:"Variables store data you can reuse. In Bash, define with NAME=value (no spaces around =). Access with $NAME. Like labeled boxes that hold values.", analogy:"üì¶ Variable=labeled box. You put something in it (NAME=value) and retrieve it later ($NAME).", commands:[{cmd:"NAME=Alice",desc:"Set a variable"},{cmd:"echo $NAME",desc:"Print variable value"},{cmd:"echo ${NAME}world",desc:"Use variable in a string"},{cmd:"readonly PI=3.14",desc:"Constant that can't be changed"}], example:"#!/bin/bash\nSERVER=webserver01\nLOG=/var/log/app.log\necho \"Checking $SERVER...\"\ntail -f $LOG", nuance:"No spaces around = when assigning. NAME=value is correct. NAME = value is wrong and will cause an error." },
          { heading:"Reading User Input", body:"read takes input from the user during script execution. -p adds a prompt. -s hides input (for passwords). Makes scripts interactive.", analogy:"üìù read=a form asking the user to fill in a field.", commands:[{cmd:"read name",desc:"Read input into variable 'name'"},{cmd:"read -p 'Enter name: ' name",desc:"Read with a prompt"},{cmd:"read -s password",desc:"Read silently (for passwords)"}], example:"#!/bin/bash\nread -p 'Server name: ' SERVER\nread -sp 'Password: ' PASS\necho\necho \"Connecting to $SERVER...\"", nuance:"Always echo a newline after read -s (password). Without it, the next output appears on the same line as the hidden input." },
          { heading:"Command-Line Arguments", body:"Scripts can accept arguments from the command line. $1 is the first argument, $2 the second, $@ is all of them, $# is the count.", analogy:"üìÆ Arguments=mail slots. $1 is the first slot, $2 the second, $@=all the mail.", commands:[{cmd:"$1 $2 $3",desc:"First, second, third argument"},{cmd:"$@",desc:"All arguments"},{cmd:"$#",desc:"Number of arguments"},{cmd:"$0",desc:"Script name itself"}], example:"#!/bin/bash\n# deploy.sh server environment\nSERVER=$1\nENV=$2\necho \"Deploying to $SERVER in $ENV mode\"\n\n$ ./deploy.sh web01 production", nuance:"Always validate arguments: if [ -z \"$1\" ]; then echo 'Usage: $0 server'; exit 1; fi" },
          { heading:"String Operations", body:"Bash has built-in string manipulation: get length, extract substrings, find/replace within variables ‚Äî all without running external commands.", analogy:"‚úÇÔ∏è String operations=scissors and tape for text manipulation.", commands:[{cmd:"${#NAME}",desc:"Length of variable NAME"},{cmd:"${NAME:2:5}",desc:"Substring: skip 2, take 5 chars"},{cmd:"${NAME/old/new}",desc:"Replace first occurrence"},{cmd:"${NAME//old/new}",desc:"Replace all occurrences"},{cmd:"${NAME,,}",desc:"Convert to lowercase"}], example:"$ FILE=MyReport_2024.txt\n$ echo ${FILE%.txt}\nMyReport_2024\n$ echo ${#FILE}\n18", nuance:"${FILE%.txt} removes a trailing .txt suffix ‚Äî very useful in scripts that process files of a specific type." }
        ],
        matchPairs:[{cmd:"$1",purpose:"First command-line argument"},{cmd:"$#",purpose:"Number of arguments"},{cmd:"read -p",purpose:"Read input with prompt"},{cmd:"${#NAME}",purpose:"Length of a string variable"},{cmd:"readonly",purpose:"Create a constant variable"}]
      },
      {
        title: "Control Flow",
        concepts: [
          { heading:"if/else ‚Äì Conditional Logic", body:"if lets your script make decisions. Like a flowchart decision diamond: 'if this is true, do this; otherwise, do that'. Conditions use [ ] or [[ ]] for testing.", analogy:"üö¶ if/else=traffic light logic. Green=do this. Red=do that instead.", commands:[{cmd:"if [ condition ]; then",desc:"Start an if block"},{cmd:"elif [ condition ]; then",desc:"Else if branch"},{cmd:"else",desc:"Default case if nothing matched"},{cmd:"fi",desc:"End the if block"}], example:"#!/bin/bash\nif [ -f /etc/nginx/nginx.conf ]; then\n  echo 'nginx config found'\nelif [ -f /etc/apache2/apache2.conf ]; then\n  echo 'apache config found'\nelse\n  echo 'No web server config found'\nfi", nuance:"Spaces inside [ ] are required. [ -f file ] works. [-f file] does not. This trips up beginners constantly." },
          { heading:"Test Operators", body:"Bash has special test operators for files, strings, and numbers. -f checks if file exists, -d for directory, -z for empty string, -eq for equal numbers, etc.", analogy:"üî¨ Test operators=different types of litmus tests for your conditions.", commands:[{cmd:"[ -f file ]",desc:"True if file exists and is regular"},{cmd:"[ -d dir ]",desc:"True if directory exists"},{cmd:"[ -z \"$var\" ]",desc:"True if variable is empty"},{cmd:"[ \"$a\" = \"$b\" ]",desc:"True if strings are equal"},{cmd:"[ $n -gt 10 ]",desc:"True if number > 10"}], example:"if [ -z \"$1\" ]; then\n  echo 'Error: no argument given'\n  exit 1\nfi\n\nif [ $DISK_PCT -gt 90 ]; then\n  echo 'ALERT: disk almost full!'\nfi", nuance:"-eq -ne -lt -gt -le -ge are numeric comparisons. For strings use = and !=. Mixing them causes subtle bugs." },
          { heading:"for & while Loops", body:"Loops repeat actions. for iterates over a list. while keeps going as long as a condition is true. Like telling someone to process every item in a pile, or keep checking until something changes.", analogy:"üîÑ for=process each item in a list. while=keep going until the light turns green.", commands:[{cmd:"for item in list; do",desc:"Iterate over items"},{cmd:"for i in {1..10}; do",desc:"Loop 1 to 10"},{cmd:"while [ condition ]; do",desc:"Loop while condition is true"},{cmd:"done",desc:"End a loop"}], example:"#!/bin/bash\nfor server in web01 web02 db01; do\n  echo \"Checking $server...\"\n  ping -c 1 $server &>/dev/null && echo '  UP' || echo '  DOWN'\ndone", nuance:"Don't forget 'done' to close loops. A script that loops infinitely with no exit condition will hang your terminal." },
          { heading:"Functions", body:"Functions group commands into reusable blocks ‚Äî like mini-scripts within your script. Avoids repeating the same code in multiple places.", analogy:"üì¶ Function=a recipe you can call by name instead of writing out all steps every time.", commands:[{cmd:"function_name() {",desc:"Define a function"},{cmd:"  # commands",desc:"Function body"},{cmd:"}",desc:"End function definition"},{cmd:"function_name arg1",desc:"Call function with argument"}], example:"#!/bin/bash\ncheck_service() {\n  local SVC=$1\n  systemctl is-active --quiet $SVC && \\\n    echo \"$SVC: running\" || echo \"$SVC: STOPPED\"\n}\n\ncheck_service nginx\ncheck_service mysql\ncheck_service ssh", nuance:"Use 'local' for variables inside functions. Without it, variables are global and can accidentally overwrite outer script variables." }
        ],
        matchPairs:[{cmd:"if [ -f file ]",purpose:"Check if file exists"},{cmd:"[ -z \"$var\" ]",purpose:"Check if variable is empty"},{cmd:"for item in list",purpose:"Iterate over a list"},{cmd:"while [ cond ]",purpose:"Loop while condition is true"},{cmd:"local VAR",purpose:"Declare local function variable"}]
      },
      {
        title: "Error Handling & Best Practices",
        concepts: [
          { heading:"Exit Codes", body:"Every command returns an exit code: 0 = success, non-zero = error. $? holds the last exit code. Scripts should check exit codes to detect failures and respond accordingly.", analogy:"üö¶ Exit codes=a thumbs up (0) or thumbs down (non-zero) after every command.", commands:[{cmd:"echo $?",desc:"Print last command's exit code"},{cmd:"command && echo ok",desc:"Run echo only if command succeeded"},{cmd:"command || echo failed",desc:"Run echo only if command failed"},{cmd:"exit 1",desc:"Exit script with error code 1"}], example:"$ ls /tmp\n$ echo $?\n0\n\n$ ls /nonexistent\nls: No such file\n$ echo $?\n2", nuance:"A good script always returns meaningful exit codes. exit 0 = success. exit 1 or higher = failure. Callers and cron jobs rely on these." },
          { heading:"set -e and set -u", body:"set -e makes the script exit immediately on any error instead of continuing. set -u treats unset variables as errors. Together they prevent many silent script failures.", analogy:"üõ° set -e=ejector seat that activates the moment something goes wrong. set -u=alarm that fires if you reference an empty box.", commands:[{cmd:"set -e",desc:"Exit on any error"},{cmd:"set -u",desc:"Error on unset variables"},{cmd:"set -x",desc:"Print each command before executing (debug mode)"},{cmd:"set -euo pipefail",desc:"Safest combination for production scripts"}], example:"#!/bin/bash\nset -euo pipefail\n\n# If any command fails, script stops immediately\ncp config.yml /etc/myapp/\nchown myapp:myapp /etc/myapp/config.yml\nsystemctl restart myapp", nuance:"set -euo pipefail is the modern standard opening for production bash scripts. Add it to every script you write." },
          { heading:"Logging in Scripts", body:"Good scripts log what they're doing. Use a log function that timestamps every message. Redirect stdout and stderr to a log file. This makes debugging failed scripts much easier.", analogy:"üìã Script logging=writing in a captain's log. When something goes wrong you can read exactly what happened and when.", commands:[{cmd:"echo \"$(date): $msg\" >> /var/log/myscript.log",desc:"Append timestamped message"},{cmd:"exec >> logfile 2>&1",desc:"Redirect all output to log file"},{cmd:"logger 'my message'",desc:"Send message to system log (syslog)"}], example:"#!/bin/bash\nLOGFILE=/var/log/backup.log\n\nlog() { echo \"$(date '+%Y-%m-%d %H:%M:%S') $1\" | tee -a $LOGFILE; }\n\nlog 'Starting backup'\ntar -czf /backup/site.tar.gz /var/www/\nlog 'Backup complete'", nuance:"tee -a writes to both the log file and the terminal simultaneously ‚Äî useful so you can see output while also saving it." },
          { heading:"Trap ‚Äì Cleanup on Exit", body:"trap runs code when a script exits or receives a signal. Use it to clean up temp files, send notifications, or ensure services are restarted even if the script crashes.", analogy:"üßπ trap=an automatic cleanup crew that activates when you leave the room, even if you left in a hurry.", commands:[{cmd:"trap 'cleanup' EXIT",desc:"Run cleanup() when script exits"},{cmd:"trap 'echo interrupted' INT",desc:"Handle Ctrl+C"},{cmd:"trap 'rm -f /tmp/myfile' EXIT",desc:"Delete temp file on exit"}], example:"#!/bin/bash\nTMPFILE=$(mktemp)\ntrap 'rm -f $TMPFILE' EXIT\n\n# TMPFILE is deleted automatically when script ends\necho 'data' > $TMPFILE\nprocess_data $TMPFILE", nuance:"Without trap, temp files accumulate every time a script crashes. Trap-based cleanup is a mark of professional scripting." }
        ],
        matchPairs:[{cmd:"$?",purpose:"Last command exit code"},{cmd:"set -e",purpose:"Exit script on any error"},{cmd:"set -u",purpose:"Error on unset variables"},{cmd:"trap cmd EXIT",purpose:"Run cleanup on script exit"},{cmd:"logger",purpose:"Send message to syslog"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 10 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß10 ‚Äì Web Servers & Databases",
    lessons: [
      {
        title: "Nginx Web Server",
        concepts: [
          { heading:"What is Nginx?", body:"Nginx (pronounced 'engine-x') is one of the world's most popular web servers. It serves web pages, acts as a reverse proxy (forwarding traffic to backend apps), and can handle SSL/TLS encryption. It's famous for handling thousands of simultaneous connections efficiently.", analogy:"üè® Nginx=a hotel receptionist. They greet every visitor, check which room (backend service) they need, and send them there.", commands:[{cmd:"sudo apt install nginx",desc:"Install nginx"},{cmd:"sudo systemctl start nginx",desc:"Start nginx"},{cmd:"sudo systemctl status nginx",desc:"Check if running"},{cmd:"nginx -t",desc:"Test configuration for errors"}], example:"$ nginx -t\nnginx: configuration file /etc/nginx/nginx.conf test is successful", nuance:"Always run nginx -t before reloading/restarting ‚Äî a config error will bring down the web server." },
          { heading:"Nginx Configuration", body:"Nginx config lives in /etc/nginx/. The main file is nginx.conf. Site configs go in /etc/nginx/sites-available/ and are enabled by symlinking to /etc/nginx/sites-enabled/.", analogy:"üìã nginx.conf=the hotel's rules. sites-available=available floor plans. sites-enabled=floors currently in use.", commands:[{cmd:"cat /etc/nginx/nginx.conf",desc:"View main config"},{cmd:"ls /etc/nginx/sites-available/",desc:"See all site configs"},{cmd:"sudo ln -s /etc/nginx/sites-available/mysite /etc/nginx/sites-enabled/",desc:"Enable a site"},{cmd:"sudo nginx -s reload",desc:"Reload config without downtime"}], example:"# /etc/nginx/sites-available/mysite\nserver {\n    listen 80;\n    server_name example.com;\n    root /var/www/mysite;\n    index index.html;\n}", nuance:"sudo nginx -s reload applies config changes without dropping existing connections. sudo systemctl restart nginx is more disruptive." },
          { heading:"Nginx as Reverse Proxy", body:"A reverse proxy sits in front of your application (like a Node.js or Python server) and forwards incoming requests to it. This lets nginx handle SSL, load balancing, and caching while your app focuses on logic.", analogy:"üìû Reverse proxy=corporate receptionist who routes incoming calls to the right department.", commands:[{cmd:"proxy_pass http://localhost:3000;",desc:"Forward traffic to port 3000"},{cmd:"sudo nginx -s reload",desc:"Apply proxy config changes"},{cmd:"curl http://localhost",desc:"Test if proxy is working"}], example:"server {\n    listen 80;\n    server_name api.example.com;\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_set_header Host $host;\n    }\n}", nuance:"Always set proxy_set_header Host $host and X-Real-IP $remote_addr so your app can see the original request headers." },
          { heading:"SSL/TLS with Let's Encrypt", body:"Let's Encrypt provides free SSL certificates. Certbot is the tool that automates getting and renewing them. HTTPS is no longer optional ‚Äî browsers warn users about non-HTTPS sites.", analogy:"üîí SSL certificate=padlock on your website. Certbot=a locksmith who installs and replaces it for free automatically.", commands:[{cmd:"sudo apt install certbot python3-certbot-nginx",desc:"Install certbot"},{cmd:"sudo certbot --nginx -d example.com",desc:"Get certificate for domain"},{cmd:"sudo certbot renew --dry-run",desc:"Test auto-renewal"}], example:"$ sudo certbot --nginx -d mysite.com\nObtaining a new certificate\nDeploying certificate to virtualhost\nHTTPS enabled!", nuance:"Certbot adds a cron/systemd timer to auto-renew before expiry. Certificates expire every 90 days ‚Äî auto-renewal is essential." }
        ],
        matchPairs:[{cmd:"nginx -t",purpose:"Test nginx config"},{cmd:"nginx -s reload",purpose:"Reload without downtime"},{cmd:"certbot --nginx",purpose:"Get SSL certificate"},{cmd:"proxy_pass",purpose:"Forward traffic to backend"},{cmd:"sites-enabled",purpose:"Active nginx site configs"}]
      },
      {
        title: "MySQL & PostgreSQL Basics",
        concepts: [
          { heading:"Databases: Where Data Lives", body:"A database is structured storage for your application's data. MySQL and PostgreSQL are the two most common relational databases on Linux servers. They store data in tables with rows and columns ‚Äî like spreadsheets that can talk to each other.", analogy:"üìä Database=digital filing cabinet with strict organization rules. Tables=drawers. Rows=documents. Columns=fields.", commands:[{cmd:"sudo apt install mysql-server",desc:"Install MySQL"},{cmd:"sudo systemctl start mysql",desc:"Start MySQL service"},{cmd:"sudo mysql -u root",desc:"Connect as root"}], example:"$ sudo mysql -u root\nmysql> SHOW DATABASES;\n+--------------------+\n| information_schema |\n| mysql              |\n+--------------------+", nuance:"Always secure a new MySQL installation with 'sudo mysql_secure_installation' ‚Äî it removes default insecure settings." },
          { heading:"Basic MySQL Commands", body:"Once connected to MySQL, you use SQL (Structured Query Language) to create databases, tables, and manage data. Essential operations for any sysadmin managing web applications.", analogy:"üóÑ SQL=the language you speak to the database. Like a librarian's lookup system.", commands:[{cmd:"CREATE DATABASE myapp;",desc:"Create a database"},{cmd:"USE myapp;",desc:"Select a database"},{cmd:"SHOW TABLES;",desc:"List all tables"},{cmd:"mysqldump -u root myapp > backup.sql",desc:"Backup a database"}], example:"mysql> CREATE DATABASE webapp;\nmysql> CREATE USER 'appuser'@'localhost' IDENTIFIED BY 'password';\nmysql> GRANT ALL ON webapp.* TO 'appuser'@'localhost';", nuance:"Always create a dedicated database user for each application ‚Äî never let apps connect as root." },
          { heading:"PostgreSQL Basics", body:"PostgreSQL (postgres) is more advanced than MySQL ‚Äî better for complex queries, more standards-compliant, preferred by many modern applications. It uses a 'psql' command-line client.", analogy:"üî¨ PostgreSQL=the Swiss Army knife of databases ‚Äî more powerful and precise than MySQL.", commands:[{cmd:"sudo apt install postgresql",desc:"Install PostgreSQL"},{cmd:"sudo -u postgres psql",desc:"Connect as postgres superuser"},{cmd:"\\l",desc:"List all databases"},{cmd:"\\dt",desc:"List tables in current database"},{cmd:"\\q",desc:"Quit psql"}], example:"$ sudo -u postgres psql\npostgres=# CREATE DATABASE myapp;\npostgres=# \\c myapp\nmyapp=#", nuance:"PostgreSQL runs as the 'postgres' system user. You often need 'sudo -u postgres' to administer it." },
          { heading:"Database Backups", body:"Regular database backups are non-negotiable. mysqldump and pg_dump create SQL dumps that can restore a database from scratch. Automate them with cron.", analogy:"üíæ Database backup=photocopying all your important documents before a possible disaster.", commands:[{cmd:"mysqldump -u root myapp > backup.sql",desc:"MySQL backup"},{cmd:"mysql -u root myapp < backup.sql",desc:"MySQL restore"},{cmd:"sudo -u postgres pg_dump myapp > backup.sql",desc:"PostgreSQL backup"},{cmd:"sudo -u postgres psql myapp < backup.sql",desc:"PostgreSQL restore"}], example:"# Automated nightly MySQL backup\n#!/bin/bash\nDATE=$(date +%Y%m%d)\nmysqldump -u backup -pPASSWORD myapp > /backup/myapp-$DATE.sql\ngzip /backup/myapp-$DATE.sql", nuance:"Test your backups by actually restoring them to a test server. An untested backup is not a real backup." }
        ],
        matchPairs:[{cmd:"mysqldump",purpose:"Backup a MySQL database"},{cmd:"mysql -u root",purpose:"Connect to MySQL"},{cmd:"nginx -t",purpose:"Test nginx configuration"},{cmd:"\\l",purpose:"List PostgreSQL databases"},{cmd:"GRANT ALL",purpose:"Give user database access"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 11 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß11 ‚Äì Monitoring & Logging",
    lessons: [
      {
        title: "System Monitoring Tools",
        concepts: [
          { heading:"Why Monitoring Matters", body:"You can't fix what you can't see. Monitoring tells you the current state of your systems, alerts you when something breaks, and gives you historical data to spot trends before they become problems.", analogy:"üè• Monitoring=continuous health tracking. Without it, you only know the patient is sick after they collapse.", commands:[], example:"# Key questions monitoring answers:\n# - Is my service running?\n# - Is disk space filling up?\n# - Is CPU/RAM exhausted?\n# - Are users getting errors?", nuance:"The goal of monitoring isn't just to alert when things break ‚Äî it's to give you enough data to predict and prevent outages." },
          { heading:"sar ‚Äì System Activity Reporter", body:"sar records and reports historical system activity ‚Äî CPU, memory, disk, network over time. It's installed as part of 'sysstat'. Unlike top which shows only the present, sar shows the past.", analogy:"üìà top=looking out the window right now. sar=watching recorded security camera footage of what happened.", commands:[{cmd:"sudo apt install sysstat",desc:"Install sysstat suite"},{cmd:"sar -u 1 5",desc:"CPU usage: 5 samples, 1 second apart"},{cmd:"sar -r 1 5",desc:"Memory usage"},{cmd:"sar -d 1 5",desc:"Disk I/O"},{cmd:"sar -n DEV 1 5",desc:"Network interface stats"}], example:"$ sar -u 1 3\n12:00:01  CPU  %user  %system  %idle\n12:00:02  all   12.5      2.1   85.4\n12:00:03  all    8.3      1.8   89.9", nuance:"Enable sar data collection by setting ENABLED=true in /etc/default/sysstat. Data is collected every 10 minutes by a cron job." },
          { heading:"lsof ‚Äì List Open Files", body:"lsof lists all open files on the system ‚Äî including network connections, since in Linux everything is a file. Essential for figuring out what's using a port or who has a file locked.", analogy:"üîç lsof=complete inventory of every open door, window, and drawer in the building right now.", commands:[{cmd:"lsof -i :80",desc:"What's using port 80"},{cmd:"lsof -p 1234",desc:"All files opened by PID 1234"},{cmd:"lsof -u alice",desc:"All files opened by alice"},{cmd:"lsof +D /var/log",desc:"Processes using files in /var/log"}], example:"$ lsof -i :80\nCOMMAND  PID      USER   FD\nnginx   1234  www-data  6u  TCP *:http (LISTEN)", nuance:"lsof is invaluable when umount says 'device is busy' ‚Äî use 'lsof +D /mountpoint' to find what process is holding it open." },
          { heading:"Alerts with cron and mail", body:"A basic alerting system: a cron script checks something (disk space, service status), and emails you if it's problematic. Simple but effective for small setups.", analogy:"üìß Monitoring alert=automatic email from your server saying 'Hey, something needs attention'.", commands:[{cmd:"df -h | awk '$5 > 80'",desc:"Find filesystems over 80% full"},{cmd:"mail -s 'Subject' user@example.com",desc:"Send an email"},{cmd:"systemctl is-active nginx",desc:"Check if service is running (for scripts)"}], example:"#!/bin/bash\n# disk-alert.sh\ndf -h | awk 'NR>1 && $5+0 > 85 {print}' | while read line; do\n  echo \"DISK ALERT: $line\" | mail -s 'Disk Full Warning' admin@example.com\ndone", nuance:"For serious environments, use dedicated monitoring systems like Prometheus, Grafana, Nagios, or Zabbix instead of home-grown scripts." }
        ],
        matchPairs:[{cmd:"sar -u",purpose:"Historical CPU usage"},{cmd:"lsof -i :80",purpose:"Find what uses port 80"},{cmd:"sar -r",purpose:"Historical memory usage"},{cmd:"systemctl is-active",purpose:"Check service status in scripts"},{cmd:"lsof -u alice",purpose:"Files opened by a user"}]
      },
      {
        title: "Log Management",
        concepts: [
          { heading:"Where Logs Live", body:"Linux logs are mostly in /var/log/. Key files: syslog (general system), auth.log (logins), kern.log (kernel), nginx/access.log and error.log (web server). Understanding log locations is essential for debugging.", analogy:"üìö /var/log = the server's diary collection. Each service keeps its own journal.", commands:[{cmd:"ls /var/log/",desc:"See all log files"},{cmd:"cat /var/log/auth.log",desc:"Authentication log"},{cmd:"tail -f /var/log/nginx/error.log",desc:"Live nginx error feed"},{cmd:"grep ERROR /var/log/app/app.log",desc:"Find errors in app log"}], example:"$ ls /var/log/\nauth.log  kern.log  nginx/  syslog  apt/\n\n$ tail -f /var/log/nginx/access.log\n192.168.1.1 - GET /api/users 200\n192.168.1.1 - GET /api/data 404", nuance:"Log files grow forever if not managed. A full /var/log partition can crash the system." },
          { heading:"logrotate ‚Äì Manage Log Size", body:"logrotate automatically compresses and rotates log files ‚Äî archiving old logs and deleting very old ones to prevent disks from filling up. It runs daily via cron.", analogy:"üóÇ logrotate=a librarian who archives old books, compresses them, and discards ones older than a retention period.", commands:[{cmd:"cat /etc/logrotate.conf",desc:"View main logrotate config"},{cmd:"ls /etc/logrotate.d/",desc:"Per-service logrotate configs"},{cmd:"sudo logrotate -f /etc/logrotate.conf",desc:"Force rotation now"},{cmd:"sudo logrotate -d /etc/logrotate.d/nginx",desc:"Dry-run (test) nginx rotation"}], example:"# /etc/logrotate.d/nginx\n/var/log/nginx/*.log {\n    daily\n    missingok\n    rotate 14\n    compress\n    delaycompress\n    notifempty\n    postrotate\n        nginx -s reopen\n    endscript\n}", nuance:"The 'rotate 14' means keep 14 rotated copies. 'compress' gzips old logs. 'postrotate' tells nginx to open new log files after rotation." },
          { heading:"rsyslog ‚Äì Centralized Logging", body:"rsyslog receives logs from local and remote systems and routes them to files or other destinations. A central log server collects logs from all your servers in one place.", analogy:"üì¨ rsyslog=a central post office that receives mail (logs) from everywhere and sorts it into the right folders.", commands:[{cmd:"sudo systemctl status rsyslog",desc:"Check rsyslog status"},{cmd:"cat /etc/rsyslog.conf",desc:"Main rsyslog configuration"},{cmd:"logger 'test message'",desc:"Send a test message to syslog"},{cmd:"grep test /var/log/syslog",desc:"Verify message appeared"}], example:"# In /etc/rsyslog.conf ‚Äî forward to central log server:\n*.* @logserver.internal:514\n\n$ logger 'Deployment started'\n$ grep 'Deployment' /var/log/syslog\nJan 10 12:00:01 web01 alice: Deployment started", nuance:"Centralized logging is critical for security ‚Äî if attackers compromise a server, they often delete local logs. Central logs can't be tampered with from the compromised host." },
          { heading:"grep Patterns for Log Analysis", body:"Analyzing logs with grep is a core sysadmin skill. Combining grep with cut, awk, sort, and uniq turns raw log files into actionable insights.", analogy:"üî¨ Log analysis=mining for gold. grep, awk, and sort are your tools to separate valuable signals from noise.", commands:[{cmd:"grep 'ERROR' app.log | wc -l",desc:"Count error lines"},{cmd:"grep -E 'ERROR|WARN' app.log",desc:"Find errors or warnings"},{cmd:"grep 'POST /api' access.log | awk '{print $1}' | sort | uniq -c | sort -rn",desc:"Top IPs making POST requests"}], example:"# Find top 10 slowest requests (over 2 seconds)\n$ awk '$NF > 2.0' /var/log/nginx/access.log | \\\n  sort -k$NF -rn | head -10", nuance:"For complex log analysis, consider tools like goaccess (web server stats), awk one-liners, or shipping logs to Elasticsearch/Splunk." }
        ],
        matchPairs:[{cmd:"tail -f app.log",purpose:"Live-follow a log file"},{cmd:"logrotate",purpose:"Manage log file rotation"},{cmd:"logger",purpose:"Send message to syslog"},{cmd:"grep -E 'ERR|WARN'",purpose:"Find errors or warnings in logs"},{cmd:"/var/log/auth.log",purpose:"System authentication log"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 12 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß12 ‚Äì Advanced Networking",
    lessons: [
      {
        title: "DNS & Network Config",
        concepts: [
          { heading:"How DNS Works", body:"DNS (Domain Name System) translates human-readable names (example.com) into IP addresses. Without DNS you'd have to memorize IP addresses instead of domain names. It's the internet's phone book.", analogy:"üìû DNS=phone book. You look up a name (example.com) and get the number (IP address) to dial.", commands:[{cmd:"nslookup example.com",desc:"Lookup DNS record for a domain"},{cmd:"dig example.com",desc:"Detailed DNS lookup"},{cmd:"dig example.com MX",desc:"Lookup mail server records"},{cmd:"host example.com",desc:"Simple DNS lookup"}], example:"$ dig example.com\n;; ANSWER SECTION:\nexample.com. 3600 IN A 93.184.216.34", nuance:"dig is more powerful than nslookup for troubleshooting. DNS propagation after changes can take up to 48 hours (depends on TTL)." },
          { heading:"Network Configuration Files", body:"Linux network config is stored in files. On modern Ubuntu systems, Netplan manages configuration. On older systems, /etc/network/interfaces was used. /etc/hosts maps names to IPs locally.", analogy:"üìã Network config files=the network settings panel but as plain text files you can edit directly.", commands:[{cmd:"cat /etc/hosts",desc:"Local hostname to IP mappings"},{cmd:"cat /etc/resolv.conf",desc:"DNS server configuration"},{cmd:"cat /etc/netplan/*.yaml",desc:"Netplan network configuration"},{cmd:"sudo netplan apply",desc:"Apply netplan changes"}], example:"# /etc/hosts\n127.0.0.1  localhost\n192.168.1.10  webserver01\n192.168.1.20  db01", nuance:"/etc/hosts is checked before DNS ‚Äî useful for local development or overriding DNS during maintenance." },
          { heading:"iptables ‚Äì Advanced Firewall", body:"iptables is the low-level Linux firewall. ufw sits on top of it. Understanding iptables lets you create complex, precise rules. Rules process traffic through chains: INPUT (incoming), OUTPUT (outgoing), FORWARD (routing).", analogy:"üèó iptables=the actual bricks of the firewall. ufw=a user-friendly tool that arranges the bricks for you.", commands:[{cmd:"sudo iptables -L -n -v",desc:"List all rules verbosely"},{cmd:"sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT",desc:"Allow SSH"},{cmd:"sudo iptables -A INPUT -j DROP",desc:"Drop all other incoming traffic"},{cmd:"sudo iptables-save > rules.txt",desc:"Save rules to file"}], example:"$ sudo iptables -L INPUT -n -v\nChain INPUT (policy DROP)\n pkts bytes target  prot opt  dport\n  820  52K  ACCEPT  tcp   --   22\n    0    0  ACCEPT  tcp   --   80", nuance:"iptables rules are not persistent by default. Use iptables-persistent or netfilter-persistent to save rules across reboots." },
          { heading:"Network Troubleshooting Workflow", body:"When network issues arise, follow a systematic top-down approach: check physical (is cable in?), link layer, IP config, routing, DNS, then application. Skipping steps wastes time.", analogy:"üîß Network troubleshooting=plumber tracing a leak. Start at the source and work toward the problem point.", commands:[{cmd:"ip link",desc:"Check if interface is UP"},{cmd:"ip addr",desc:"Check IP address assignment"},{cmd:"ip route",desc:"Check routing table"},{cmd:"ping 8.8.8.8",desc:"Can you reach the internet?"},{cmd:"dig google.com",desc:"Is DNS working?"}], example:"# Troubleshooting checklist:\n$ ip link show eth0      # Interface up?\n$ ip addr show eth0      # Has an IP?\n$ ip route               # Default gateway?\n$ ping 192.168.1.1       # Can reach gateway?\n$ ping 8.8.8.8           # Internet reachable?\n$ dig google.com         # DNS working?", nuance:"Test the layers in order. Don't check DNS if basic ping fails ‚Äî fix the simpler problem first." }
        ],
        matchPairs:[{cmd:"dig",purpose:"Detailed DNS lookup"},{cmd:"/etc/hosts",purpose:"Local hostname mappings"},{cmd:"iptables -L",purpose:"List firewall rules"},{cmd:"ip route",purpose:"Show routing table"},{cmd:"netplan apply",purpose:"Apply network config"}]
      },
      {
        title: "VPNs & Tunneling",
        concepts: [
          { heading:"What is a VPN?", body:"A VPN (Virtual Private Network) creates an encrypted tunnel between two points over the internet. Used to securely connect remote workers to an office network, or link two server networks together.", analogy:"üöá VPN=a private underground tunnel through a busy city. Everyone can see there's a tunnel, but not what's inside.", commands:[], example:"# VPN use cases:\n# - Remote staff accessing internal servers\n# - Connecting two data centers securely\n# - Routing traffic through a trusted exit point", nuance:"For server-to-server VPNs, WireGuard is the modern choice. OpenVPN is older but widely supported. IPSec is used in enterprise environments." },
          { heading:"WireGuard ‚Äì Modern VPN", body:"WireGuard is a fast, simple, secure VPN built into the Linux kernel. Much easier to configure than OpenVPN. It uses key pairs like SSH.", analogy:"üîê WireGuard=a modern high-speed encrypted tunnel with minimal complexity.", commands:[{cmd:"sudo apt install wireguard",desc:"Install WireGuard"},{cmd:"wg genkey | tee private.key | wg pubkey > public.key",desc:"Generate key pair"},{cmd:"sudo wg show",desc:"Show WireGuard status"},{cmd:"sudo wg-quick up wg0",desc:"Bring up WireGuard interface"}], example:"# /etc/wireguard/wg0.conf\n[Interface]\nPrivateKey = <your-private-key>\nAddress = 10.0.0.1/24\nListenPort = 51820\n\n[Peer]\nPublicKey = <peer-public-key>\nAllowedIPs = 10.0.0.2/32", nuance:"WireGuard has no concept of 'up' or 'authenticated' state ‚Äî either traffic is flowing through the tunnel or it's not. Simpler but different from OpenVPN." },
          { heading:"SSH Tunneling", body:"SSH can create encrypted tunnels for other traffic ‚Äî called port forwarding. Local forwarding sends traffic from your machine to a remote host through SSH. This can securely expose databases, admin panels, etc.", analogy:"üìÆ SSH tunnel=a diplomatic pouch. Sensitive documents travel inside regular diplomatic mail ‚Äî others see a normal package, not the contents.", commands:[{cmd:"ssh -L 3306:localhost:3306 user@server",desc:"Forward local port 3306 to remote MySQL"},{cmd:"ssh -R 8080:localhost:3000 user@server",desc:"Expose local port to remote server"},{cmd:"ssh -D 1080 user@server",desc:"Create a SOCKS proxy through SSH"}], example:"# Access a remote MySQL database locally:\n$ ssh -L 3306:localhost:3306 alice@dbserver\n# Now connect with: mysql -h 127.0.0.1\n# Traffic is encrypted through SSH", nuance:"SSH tunnels are temporary ‚Äî they exist only while the SSH connection is open. Use autossh to keep them alive automatically." },
          { heading:"nmap ‚Äì Network Scanning", body:"nmap scans networks to discover hosts and open ports. Essential for security audits ‚Äî it tells you exactly what's visible from outside your server. If nmap sees it, attackers can too.", analogy:"üî≠ nmap=a telescope pointed at your network infrastructure. Shows exactly what's visible from outside.", commands:[{cmd:"nmap 192.168.1.10",desc:"Scan a host's open ports"},{cmd:"nmap -sV 192.168.1.10",desc:"Detect service versions"},{cmd:"nmap -p 22,80,443 host",desc:"Scan specific ports"},{cmd:"nmap 192.168.1.0/24",desc:"Scan entire subnet"}], example:"$ nmap 192.168.1.10\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n443/tcp open https", nuance:"Only scan networks you own or have explicit permission to scan. Unauthorized port scanning is illegal in many jurisdictions." }
        ],
        matchPairs:[{cmd:"ssh -L",purpose:"Local port forwarding"},{cmd:"wg show",purpose:"Show WireGuard status"},{cmd:"nmap",purpose:"Scan for open ports"},{cmd:"ssh -D",purpose:"Create SOCKS proxy"},{cmd:"wg-quick up wg0",purpose:"Bring up WireGuard interface"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 13 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß13 ‚Äì Containers & Virtualization",
    lessons: [
      {
        title: "Docker Basics",
        concepts: [
          { heading:"What Are Containers?", body:"Containers package an application with all its dependencies into a portable unit that runs identically everywhere. Unlike virtual machines, containers share the host OS kernel ‚Äî they're lighter and faster to start.", analogy:"üö¢ Container=a standardized shipping container. Same size, same interface. Works on any ship (server). Contents are isolated from each other.", commands:[], example:"# Traditional: 'it works on my machine'\n# Containers: works EVERYWHERE the same way\n\n# Container = app + libraries + runtime\n# No 'works on my machine' problem", nuance:"Docker is the most popular container tool, but containers are a Linux kernel feature (namespaces + cgroups). Podman is a rootless alternative." },
          { heading:"Basic Docker Commands", body:"Docker commands let you pull images from registries, run containers, manage them, and clean up. An image is a blueprint; a container is a running instance of that blueprint.", analogy:"üç≥ Image=recipe. Container=the dish you cooked from that recipe. You can make many dishes from one recipe.", commands:[{cmd:"docker pull nginx",desc:"Download the nginx image"},{cmd:"docker run -d -p 80:80 nginx",desc:"Run nginx container in background"},{cmd:"docker ps",desc:"List running containers"},{cmd:"docker ps -a",desc:"List all containers including stopped"},{cmd:"docker stop containerID",desc:"Stop a container"},{cmd:"docker rm containerID",desc:"Delete a container"}], example:"$ docker run -d -p 80:80 --name webserver nginx\n9a4b3c2d1e...\n$ docker ps\nCONTAINER ID  IMAGE  STATUS   PORTS          NAMES\n9a4b3c2d1e..  nginx  Up 5s    0.0.0.0:80->80 webserver", nuance:"-d means detached (background). -p 80:80 maps host port 80 to container port 80. Without -d the container runs in the foreground." },
          { heading:"Dockerfile & Building Images", body:"A Dockerfile is a script that defines how to build a custom Docker image. Each line adds a layer. Build with 'docker build'. Push to Docker Hub or a private registry to share.", analogy:"üìã Dockerfile=a recipe you write yourself to create a custom dish, instead of using a pre-made one.", commands:[{cmd:"docker build -t myapp:1.0 .",desc:"Build image from Dockerfile in current dir"},{cmd:"docker images",desc:"List local images"},{cmd:"docker push myrepo/myapp:1.0",desc:"Push image to registry"},{cmd:"docker rmi imageName",desc:"Remove an image"}], example:"# Dockerfile\nFROM ubuntu:22.04\nRUN apt-get update && apt-get install -y python3\nCOPY app.py /app/\nWORKDIR /app\nCMD [\"python3\", \"app.py\"]", nuance:"Each RUN command creates a layer. Combine apt-get update and install in one RUN to keep images smaller and avoid caching issues." },
          { heading:"Docker Compose", body:"Docker Compose defines and runs multi-container applications. Instead of long docker run commands, you write a docker-compose.yml file describing all your services (app, database, cache) and their relationships.", analogy:"üéº Docker Compose=a conductor's score. Instead of cueing each musician (container) individually, you run one command and everything starts in the right order.", commands:[{cmd:"docker compose up -d",desc:"Start all services in background"},{cmd:"docker compose down",desc:"Stop and remove containers"},{cmd:"docker compose logs -f",desc:"Follow logs from all services"},{cmd:"docker compose ps",desc:"List running services"}], example:"# docker-compose.yml\nservices:\n  web:\n    image: nginx\n    ports: ['80:80']\n  db:\n    image: postgres\n    environment:\n      POSTGRES_PASSWORD: secret", nuance:"docker compose down removes containers but not volumes. Use 'docker compose down -v' to also remove volumes (deletes data). Be careful." }
        ],
        matchPairs:[{cmd:"docker run -d",purpose:"Run container in background"},{cmd:"docker ps",purpose:"List running containers"},{cmd:"docker build",purpose:"Build an image from Dockerfile"},{cmd:"docker compose up",purpose:"Start all compose services"},{cmd:"docker pull",purpose:"Download an image"}]
      },
      {
        title: "Systemd & Init Systems",
        concepts: [
          { heading:"What Is systemd?", body:"systemd is the modern init system for Linux ‚Äî the first process that starts when Linux boots (PID 1) and the parent of everything else. It manages services, mounts, timers, and system state.", analogy:"üèó systemd=the foreman who sets up the entire worksite when construction begins. Everything else starts under its supervision.", commands:[{cmd:"systemctl list-units",desc:"List all active units"},{cmd:"systemctl list-units --type=service",desc:"List only services"},{cmd:"systemctl list-timers",desc:"List scheduled timers"},{cmd:"systemd-analyze",desc:"Show boot time breakdown"}], example:"$ systemd-analyze\nStartup finished in 3.121s (kernel) + 12.456s (userspace)\n\n$ systemd-analyze blame | head -5\n  5.234s mysql.service\n  3.102s networking.service", nuance:"systemd replaced SysV init on most modern Linux distributions. Scripts in /etc/init.d/ still work on systemd through compatibility." },
          { heading:"Creating Custom Services", body:"You can create your own systemd service to manage any application ‚Äî ensuring it starts on boot, restarts if it crashes, and has proper logging. Service files go in /etc/systemd/system/.", analogy:"ü§ñ Custom service=hiring a full-time robot to manage your app ‚Äî starts it at boot, restarts it if it crashes, keeps logs.", commands:[{cmd:"sudo nano /etc/systemd/system/myapp.service",desc:"Create service file"},{cmd:"sudo systemctl daemon-reload",desc:"Reload systemd to see new file"},{cmd:"sudo systemctl enable --now myapp",desc:"Enable and start immediately"},{cmd:"journalctl -u myapp -f",desc:"Follow service logs"}], example:"# /etc/systemd/system/myapp.service\n[Unit]\nDescription=My Application\nAfter=network.target\n\n[Service]\nUser=myapp\nWorkingDirectory=/opt/myapp\nExecStart=/usr/bin/python3 /opt/myapp/server.py\nRestart=always\n\n[Install]\nWantedBy=multi-user.target", nuance:"'Restart=always' makes systemd automatically restart your app if it crashes. This is one of the most valuable features of systemd services." },
          { heading:"systemd Timers", body:"systemd timers are a modern replacement for cron jobs. They're managed like services ‚Äî easy to check status, view logs, and debug. More powerful than cron for complex scheduling needs.", analogy:"‚è± systemd timers=cron with a doctor's tracking app ‚Äî you can check if the task ran, when it ran, and what happened.", commands:[{cmd:"systemctl list-timers",desc:"Show all timers and when they last ran"},{cmd:"systemctl status mytask.timer",desc:"Check timer status"},{cmd:"systemctl enable --now mytask.timer",desc:"Enable and start timer"}], example:"# mytask.timer\n[Unit]\nDescription=Run mytask daily\n\n[Timer]\nOnCalendar=daily\nPersistent=true\n\n[Install]\nWantedBy=timers.target", nuance:"Persistent=true means: if the system was off when the timer was supposed to fire, run it immediately on next boot. Very useful for backup jobs." },
          { heading:"Targets ‚Äì Boot Levels", body:"Systemd targets are groups of units that represent a system state. They replaced SysV runlevels. multi-user.target is normal server operation. graphical.target adds a desktop GUI.", analogy:"üéØ Targets=gears in a car. Each gear (target) enables a different set of capabilities and speed (system features).", commands:[{cmd:"systemctl get-default",desc:"Show default boot target"},{cmd:"sudo systemctl set-default multi-user.target",desc:"Boot to text mode (no GUI)"},{cmd:"sudo systemctl isolate rescue.target",desc:"Switch to recovery mode"},{cmd:"who -r",desc:"Show current runlevel"}], example:"$ systemctl get-default\ngraphical.target\n\n# For a server (no desktop needed):\n$ sudo systemctl set-default multi-user.target", nuance:"Servers should use multi-user.target ‚Äî installing a desktop GUI on a server wastes resources and increases attack surface." }
        ],
        matchPairs:[{cmd:"systemctl daemon-reload",purpose:"Reload systemd after file changes"},{cmd:"Restart=always",purpose:"Auto-restart crashed service"},{cmd:"systemctl list-timers",purpose:"Show all scheduled timers"},{cmd:"systemd-analyze",purpose:"Show boot time stats"},{cmd:"multi-user.target",purpose:"Normal server boot state"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 14 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß14 ‚Äì Performance Tuning",
    lessons: [
      {
        title: "CPU & Memory Optimization",
        concepts: [
          { heading:"Understanding CPU Load", body:"Load average (from uptime/top) shows work demand over 1, 5, 15 minutes. Values over your CPU count indicate overload. 1-minute vs 15-minute trends show if things are getting better or worse.", analogy:"üìä Load average=a highway traffic report. Load of 4.0 on a 4-core system=100% capacity. Higher=traffic jam.", commands:[{cmd:"uptime",desc:"Show load averages"},{cmd:"nproc",desc:"Number of CPU cores"},{cmd:"top",desc:"Live CPU per-process breakdown"},{cmd:"mpstat 1",desc:"CPU stats per core every second"}], example:"$ uptime\n12:00  up 5 days,  load average: 0.85, 1.20, 0.95\n# 0.85 load on ? cores:\n$ nproc\n4\n# 0.85/4 = 21% of total CPU ‚Äî fine", nuance:"A load of 1.0 per core is 100%. 0.7 or lower is comfortable. Above 1.0 per core means processes are waiting for CPU." },
          { heading:"Memory Management", body:"Linux uses free RAM for disk caching (buffers/cache) ‚Äî this looks like high memory usage but is actually good. 'Available' memory is what's actually free to use. Swap is used when RAM is exhausted.", analogy:"üß† RAM=your desk. Disk cache=things you keep on the desk 'just in case'. Swap=emergency overflow shelf (much slower).", commands:[{cmd:"free -h",desc:"Show RAM and swap usage"},{cmd:"cat /proc/meminfo",desc:"Detailed memory stats"},{cmd:"swapon --show",desc:"Show swap devices"},{cmd:"sudo swapoff -a && sudo swapon -a",desc:"Clear swap (flush to RAM)"}], example:"$ free -h\n             total  used   free  available\nMem:          7.8G  5.2G  200M      2.4G\nSwap:         2.0G  100M  1.9G\n# 2.4G available ‚Äî healthy despite 5.2G 'used'", nuance:"If swap usage is consistently high, you need more RAM ‚Äî swapping causes significant performance degradation as disk is much slower than RAM." },
          { heading:"nice & renice ‚Äì CPU Priority", body:"nice sets the priority of a new process. renice changes an existing process's priority. Priority ranges from -20 (highest) to 19 (lowest). Only root can set negative (high) priorities.", analogy:"üéü nice=priority boarding. Negative nice=business class. Positive nice=standby passenger ‚Äî gets CPU only when others aren't using it.", commands:[{cmd:"nice -n 19 backup.sh",desc:"Run backup with lowest priority"},{cmd:"renice -n 10 -p 1234",desc:"Lower priority of PID 1234"},{cmd:"ps -eo pid,ni,comm | sort -k2",desc:"Show processes by niceness"}], example:"# Run a CPU-intensive task without hogging the system:\n$ nice -n 19 tar -czf backup.tar.gz /home/\n# tar will use CPU only when nothing else needs it", nuance:"Positive nice values (lower priority) are the most useful ‚Äî run batch jobs nicely so they don't impact interactive users or services." },
          { heading:"ulimit ‚Äì Resource Limits", body:"ulimit limits what resources a user or process can consume ‚Äî preventing runaway processes from crashing the system. Limits include max file sizes, open files, processes, and memory.", analogy:"üß± ulimit=a city code that limits how tall buildings can be. Prevents one tenant from hogging all city resources.", commands:[{cmd:"ulimit -a",desc:"Show all current limits"},{cmd:"ulimit -n 65536",desc:"Set max open files to 65536"},{cmd:"ulimit -u 1000",desc:"Set max processes to 1000"},{cmd:"cat /etc/security/limits.conf",desc:"Persistent limits config file"}], example:"$ ulimit -a\nopen files  (-n) 1024\nmax processes  (-u) 31559\n\n# Nginx needs more open files:\n$ ulimit -n 65536", nuance:"The default 1024 open files limit is too low for busy web servers. Nginx, MySQL, and others need much higher limits. Set in /etc/security/limits.conf for persistence." }
        ],
        matchPairs:[{cmd:"nproc",purpose:"Show number of CPU cores"},{cmd:"nice -n 19",purpose:"Run process at lowest priority"},{cmd:"renice",purpose:"Change priority of running process"},{cmd:"ulimit -n",purpose:"Set max open files"},{cmd:"free -h",purpose:"Show RAM and swap usage"}]
      },
      {
        title: "Disk & I/O Performance",
        concepts: [
          { heading:"Identifying Disk Bottlenecks", body:"Slow disk I/O is a common cause of system sluggishness. iostat shows read/write speeds and utilization per disk. High %util (close to 100%) means the disk is the bottleneck.", analogy:"üöó Disk I/O bottleneck=a highway merging from 8 lanes to 1. Everything backs up waiting for the narrow point.", commands:[{cmd:"iostat -xz 1",desc:"Disk I/O extended stats every second"},{cmd:"iotop",desc:"Show disk I/O by process (like top for disks)"},{cmd:"hdparm -t /dev/sda",desc:"Test raw disk read speed"}], example:"$ iostat -xz 1\nDevice  r/s   w/s  rMB/s  wMB/s  %util\nsda    45.2  12.3   5.6    1.2    87.3\n# 87% util means disk is almost saturated", nuance:"SSDs handle random I/O much better than spinning hard drives. If %util is consistently high, consider upgrading to SSD or distributing I/O across multiple disks." },
          { heading:"Filesystem Tuning", body:"ext4 and XFS have mount options and tuning parameters that can significantly impact performance. noatime is one of the simplest and most impactful changes for read-heavy workloads.", analogy:"‚öôÔ∏è Filesystem tuning=adjusting tire pressure and engine settings for the road type ‚Äî small changes, significant performance impact.", commands:[{cmd:"mount | grep ' / '",desc:"See current mount options for root"},{cmd:"tune2fs -l /dev/sda1",desc:"View ext4 filesystem parameters"},{cmd:"tune2fs -m 1 /dev/sdb1",desc:"Reduce reserved blocks from 5% to 1%"}], example:"# In /etc/fstab, add noatime:\n/dev/sda1 / ext4 defaults,noatime 0 1\n\n# noatime: don't update 'last accessed' time\n# on every file read ‚Äî reduces unnecessary writes", nuance:"noatime can noticeably improve performance on read-heavy servers (web, database). The savings come from eliminating constant metadata writes." },
          { heading:"Swap Configuration", body:"Swappiness controls how aggressively Linux uses swap. Default is 60 (moderate). Servers often benefit from a lower value (10-20) to keep more data in RAM before swapping.", analogy:"üí° Swappiness=thermostat setting for RAM vs swap usage. Lower=prefer RAM. Higher=move things to swap sooner.", commands:[{cmd:"cat /proc/sys/vm/swappiness",desc:"Current swappiness value"},{cmd:"sudo sysctl vm.swappiness=10",desc:"Set swappiness to 10 (temporary)"},{cmd:"echo 'vm.swappiness=10' | sudo tee /etc/sysctl.d/99-swap.conf",desc:"Make permanent"}], example:"$ cat /proc/sys/vm/swappiness\n60\n$ sudo sysctl vm.swappiness=10\nvm.swappiness = 10\n# System will now prefer RAM over swap much more", nuance:"For database servers (MySQL, Postgres), swappiness of 1-10 is often recommended ‚Äî swapping database buffers causes severe performance degradation." },
          { heading:"dd ‚Äì Disk Benchmarking", body:"dd is a low-level data copying tool. It's used for disk benchmarking, creating test files, and writing disk images. It can also wipe disks by writing zeros or random data.", analogy:"üèé dd=a dragstrip for your disk. It measures the raw top speed without all the overhead of a real filesystem.", commands:[{cmd:"dd if=/dev/zero of=/tmp/test bs=1M count=1024",desc:"Write 1GB test file (write speed)"},{cmd:"dd if=/tmp/test of=/dev/null bs=1M",desc:"Read test file (read speed)"},{cmd:"sudo dd if=/dev/urandom of=/dev/sdb bs=1M",desc:"Wipe disk with random data"}], example:"$ dd if=/dev/zero of=/tmp/test bs=1M count=1024\n1024+0 records\n1073741824 bytes copied, 2.1 s, 511 MB/s", nuance:"dd of=/dev/sdb with the wrong device name permanently wipes data. Triple-check your target device. There's no undo." }
        ],
        matchPairs:[{cmd:"iostat -xz",purpose:"Show disk I/O utilization"},{cmd:"iotop",purpose:"Disk I/O by process"},{cmd:"vm.swappiness",purpose:"Control RAM vs swap preference"},{cmd:"noatime",purpose:"Skip access time writes"},{cmd:"dd",purpose:"Low-level disk copy/benchmark"}]
      }
    ]
  },
  // ‚îÄ‚îÄ SECTION 15 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  {
    title: "¬ß15 ‚Äì Advanced Security",
    lessons: [
      {
        title: "Hardening a Server",
        concepts: [
          { heading:"The Defense-in-Depth Philosophy", body:"Security is not one thing ‚Äî it's layers. No single measure is perfect, so you layer them. Even if one layer fails, others protect you. A hardened server reduces attack surface at every layer.", analogy:"üè∞ Defense in depth=a castle with a moat, walls, guards, and inner keep. Attackers must breach every layer.", commands:[], example:"# Hardening checklist:\n# 1. Disable root SSH login\n# 2. Use SSH keys only (no passwords)\n# 3. Enable firewall\n# 4. Install fail2ban\n# 5. Keep packages updated\n# 6. Disable unused services\n# 7. Use SELinux or AppArmor", nuance:"Security is a process, not a product. Regular audits, patching, and monitoring are more important than any one-time hardening step." },
          { heading:"SSH Hardening", body:"The SSH daemon config (/etc/ssh/sshd_config) has many security-relevant settings. Disabling root login and password auth are the two highest-impact changes you can make.", analogy:"üîí SSH hardening=adding deadbolts and an alarm to your front door instead of just a handle lock.", commands:[{cmd:"sudo nano /etc/ssh/sshd_config",desc:"Edit SSH daemon config"},{cmd:"sudo systemctl restart sshd",desc:"Apply SSH config changes"},{cmd:"grep PermitRootLogin /etc/ssh/sshd_config",desc:"Check root login setting"},{cmd:"grep PasswordAuthentication /etc/ssh/sshd_config",desc:"Check password auth setting"}], example:"# /etc/ssh/sshd_config recommended settings:\nPermitRootLogin no\nPasswordAuthentication no\nPubkeyAuthentication yes\nMaxAuthTries 3\nX11Forwarding no\nAllowUsers alice bob", nuance:"Always test SSH config changes in a separate session while keeping your original session open. If the new config breaks SSH, you'll still have access." },
          { heading:"AppArmor ‚Äì Mandatory Access Control", body:"AppArmor restricts what programs can do ‚Äî even if they're compromised. It defines what files, networks, and capabilities each program is allowed to access. A confined nginx can't read /etc/shadow even if hacked.", analogy:"üîê AppArmor=a job description for programs. nginx is hired to serve web files ‚Äî it's not authorized to access the payroll database.", commands:[{cmd:"sudo apparmor_status",desc:"Show AppArmor status and profiles"},{cmd:"aa-status",desc:"Same as above, shorter command"},{cmd:"sudo aa-enforce /etc/apparmor.d/usr.sbin.nginx",desc:"Enforce nginx profile"},{cmd:"sudo aa-complain /etc/apparmor.d/usr.sbin.nginx",desc:"Log violations without blocking"}], example:"$ sudo apparmor_status\napparmor module is loaded.\n56 profiles are loaded.\n52 profiles are in enforce mode.\n4 profiles are in complain mode.", nuance:"Start with complain mode to log what a program does, then switch to enforce once you've confirmed the profile is complete. A restrictive profile that breaks the app is worse than no profile." },
          { heading:"Audit Logging with auditd", body:"auditd (the Linux Audit Daemon) logs detailed security events ‚Äî file access, permission changes, user activity, and system calls. It creates a tamper-resistant audit trail required for compliance (PCI-DSS, HIPAA, SOC2).", analogy:"üìπ auditd=a security camera system for your entire server. Every action is recorded with timestamps and who did it.", commands:[{cmd:"sudo systemctl status auditd",desc:"Check auditd status"},{cmd:"sudo ausearch -m USER_LOGIN",desc:"Search for login events"},{cmd:"sudo aureport --auth",desc:"Authentication summary report"},{cmd:"sudo auditctl -w /etc/passwd -p wa -k passwd_changes",desc:"Watch /etc/passwd for changes"}], example:"$ sudo ausearch -m USER_LOGIN -ts today\ntype=USER_LOGIN msg=audit(1704880801.234:567):\nacct=alice res=success\n# Shows alice logged in successfully", nuance:"auditd logs are stored in /var/log/audit/audit.log. Forward them to a central logging server immediately so they can't be tampered with on a compromised host." }
        ],
        matchPairs:[{cmd:"PermitRootLogin no",purpose:"Disable SSH root login"},{cmd:"PasswordAuthentication no",purpose:"Require SSH keys only"},{cmd:"apparmor_status",purpose:"Show AppArmor profiles"},{cmd:"auditd",purpose:"Security audit logging"},{cmd:"aa-enforce",purpose:"Enable AppArmor enforcement"}]
      },
      {
        title: "Incident Response",
        concepts: [
          { heading:"When You're Compromised", body:"No server is guaranteed to be secure forever. Knowing how to respond when you suspect a compromise is essential. The goal is to contain damage, gather evidence, and recover safely ‚Äî not to panic.", analogy:"üöí Incident response=a fire drill. When fire breaks out, you follow a practiced procedure ‚Äî not improvise in a panic.", commands:[], example:"# Immediate response steps:\n# 1. Don't panic\n# 2. Isolate the server (firewall rules / disconnect)\n# 3. Take memory/disk snapshot if possible\n# 4. Review logs before they're overwritten\n# 5. Determine scope ‚Äî what was accessed?\n# 6. Notify appropriate parties", nuance:"If evidence of criminal activity is found, preserve everything and consult legal counsel before making changes. Forensic evidence is fragile." },
          { heading:"Detecting Intrusions", body:"Look for signs of compromise: unexpected users, unusual network connections, modified system binaries, new cron jobs, hidden processes. These commands help identify suspicious activity.", analogy:"üïµÔ∏è Intrusion detection=a detective's walk-through after a reported break-in ‚Äî looking for evidence the criminal left behind.", commands:[{cmd:"last",desc:"Show recent login history"},{cmd:"lastb",desc:"Show failed login attempts"},{cmd:"find / -newer /tmp/reference -type f",desc:"Files changed recently (suspicious)"},{cmd:"ss -tulnp",desc:"Check for unexpected open ports"},{cmd:"crontab -l",desc:"Check for unexpected cron jobs"}], example:"$ last | head -20\nalice  pts/0  192.168.1.10  Mon Jan 10\nroot   pts/0  45.83.1.99    Mon Jan 10\n# Unexpected root login from foreign IP!", nuance:"Compare checksums of critical system binaries (/bin/ls, /usr/bin/ps) against known-good values. Rootkits often replace these with modified versions." },
          { heading:"chkrootkit & rkhunter", body:"chkrootkit and rkhunter scan for signs of rootkits ‚Äî malicious software that hides from normal tools and gives attackers persistent hidden access.", analogy:"üêõ Rootkits=a hidden bug in the walls of your house. Normal inspection misses it ‚Äî you need specialized equipment.", commands:[{cmd:"sudo apt install chkrootkit rkhunter",desc:"Install rootkit scanners"},{cmd:"sudo chkrootkit",desc:"Scan for rootkits"},{cmd:"sudo rkhunter --update",desc:"Update rkhunter database"},{cmd:"sudo rkhunter --check",desc:"Run full rootkit scan"}], example:"$ sudo chkrootkit\nChecking `ifconfig'... not infected\nChecking `ls'... not infected\nChecking `ps'... not infected\nCHECKING FOR ROOTKIT INFECTIONS...", nuance:"Install and run these BEFORE a suspected compromise to create a baseline. Running them on a potentially compromised system is less reliable ‚Äî the rootkit may hide itself from the scanner." },
          { heading:"Recovery & Post-Mortem", body:"After containing an incident, recovery means rebuilding clean systems. The post-mortem asks: how did the attacker get in, what did they do, and how do we prevent recurrence?", analogy:"üî¨ Post-mortem=an autopsy to determine cause of death ‚Äî essential for preventing the same thing from happening again.", commands:[{cmd:"md5sum /bin/ls",desc:"Check integrity of system binaries"},{cmd:"debsums -c",desc:"Verify all installed package files"},{cmd:"rpm -Va",desc:"Verify RPM package files (Red Hat)"}], example:"# Recovery checklist:\n# 1. Rebuild from trusted base image\n# 2. Restore data from pre-compromise backup\n# 3. Patch the vulnerability that was exploited\n# 4. Enable additional monitoring\n# 5. Document the incident thoroughly\n# 6. Share findings with team", nuance:"The best recovery starts before the incident ‚Äî automated builds, infrastructure-as-code, and regular tested backups make recovery fast and confident." }
        ],
        matchPairs:[{cmd:"last",purpose:"Show recent login history"},{cmd:"lastb",purpose:"Show failed login attempts"},{cmd:"rkhunter --check",purpose:"Scan for rootkits"},{cmd:"debsums -c",purpose:"Verify package file integrity"},{cmd:"chkrootkit",purpose:"Check for rootkit infection"}]
      }
    ]
  }
]; // end linuxSections
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LINUX MATCH MADNESS POOL
//  Pull 5 random matchPairs from across ALL lessons
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getLinuxMatchPool(count) {
  const allPairs = [];
  linuxSections.forEach(sec => {
    sec.lessons.forEach(les => {
      les.matchPairs.forEach(p => allPairs.push(p));
    });
  });
  shuffle(allPairs);
  return allPairs.slice(0, count);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COMPLETION TRACKING (in-memory + localStorage)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let completedLinux = JSON.parse(localStorage.getItem('completedLinux') || '{}');

function markLinuxDone(si, li) {
  const key = si + '-' + li;
  completedLinux[key] = true;
  localStorage.setItem('completedLinux', JSON.stringify(completedLinux));
}

function isLinuxDone(si, li) {
  return !!completedLinux[si + '-' + li];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let mode = "NO";
let lessons = lessonsNO;
let speechLang = "no-NO";
let xp = 0;
let streak = parseInt(localStorage.getItem("streak") || "0");
let lastVisit = localStorage.getItem("lastVisit");
let today = new Date().toDateString();
let current = null;
let selected = [];
let matchPairs = [], matchSelected = [], matchTimerInt = null;
let currentLinuxLesson = null;
let currentLinuxSI = -1, currentLinuxLI = -1;
let currentConceptIdx = 0;
let linuxMatchSelected = [];
// Linux Match Madness state
let lmmPairs = [], lmmSelected = [], lmmTimerInt = null, lmmIsTimed = false, lmmMatched = 0;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DOM REFS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const homeEl          = document.getElementById("home");
const lessonView      = document.getElementById("lessonView");
const matchView       = document.getElementById("matchView");
const linuxLessonView = document.getElementById("linuxLessonView");
const lmmView         = document.getElementById("linuxMatchMadnessView");
const lessonTitle     = document.getElementById("lessonTitle");
const exampleEl       = document.getElementById("example");
const answerLine      = document.getElementById("answerLine");
const bubblesEl       = document.getElementById("bubbles");
const feedbackEl      = document.getElementById("feedback");
const matchLeft       = document.getElementById("matchLeft");
const matchRight      = document.getElementById("matchRight");
const matchTimer      = document.getElementById("matchTimer");
const xpEl            = document.getElementById("xpEl");
const streakEl        = document.getElementById("streakEl");
const levelEl         = document.getElementById("levelEl");
const flagNO          = document.getElementById("flagNO");
const flagJP          = document.getElementById("flagJP");
const flagLinux       = document.getElementById("flagLinux");
const langSections    = document.getElementById("langSections");
const matchSections   = document.getElementById("matchSections");
const linuxMatchSects = document.getElementById("linuxMatchSections");

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUILD HOME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildAll() {
  langSections.innerHTML = "";
  if (mode === "LINUX") {
    matchSections.classList.add("hidden");
    linuxMatchSects.classList.remove("hidden");
    linuxSections.forEach((sec, si) => {
      const div = document.createElement("div");
      div.className = "section";
      const hdr = document.createElement("div");
      hdr.className = "section-header";
      hdr.textContent = sec.title;
      const grid = document.createElement("div");
      grid.className = "lesson-grid hidden";
      hdr.onclick = () => { grid.classList.toggle("hidden"); hdr.classList.toggle("open"); };
      sec.lessons.forEach((les, li) => {
        const d = document.createElement("div");
        d.className = "lesson" + (isLinuxDone(si, li) ? " done" : "");
        d.textContent = les.title;
        d.onclick = () => startLinuxLesson(si, li);
        grid.appendChild(d);
      });
      div.appendChild(hdr);
      div.appendChild(grid);
      langSections.appendChild(div);
    });
  } else {
    matchSections.classList.remove("hidden");
    linuxMatchSects.classList.add("hidden");
    const titles = ["Section 1 ‚Äì The Basics","Section 2 ‚Äì Building Confidence","Section 3 ‚Äì Everyday Fluency"];
    ["sec1","sec2","sec3"].forEach((sec, idx) => {
      const div = document.createElement("div");
      div.className = "section";
      const hdr = document.createElement("div");
      hdr.className = "section-header";
      hdr.textContent = titles[idx];
      const grid = document.createElement("div");
      grid.className = "lesson-grid hidden";
      hdr.onclick = () => { grid.classList.toggle("hidden"); hdr.classList.toggle("open"); };
      lessons[sec].forEach((l, i) => {
        const d = document.createElement("div");
        d.className = "lesson";
        d.textContent = l.title;
        d.onclick = () => startLesson(sec, i);
        grid.appendChild(d);
      });
      div.appendChild(hdr);
      div.appendChild(grid);
      langSections.appendChild(div);
    });
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LANGUAGE LESSONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function makeClickable(text) {
  return text.split(" ").map(w => `<span class="tapword" onclick="alert('Word: ${w}')">${w}</span>`).join(" ");
}

function startLesson(sec, i) {
  current = lessons[sec][i];
  selected = [];
  lessonTitle.textContent = current.title;
  feedbackEl.textContent = "";
  answerLine.textContent = "";
  if (typeof current.sentence === "object") {
    exampleEl.innerHTML = `<div>${makeClickable(current.sentence.romaji)}</div><div style="opacity:.65;font-size:20px;">${makeClickable(current.sentence.kanji)}</div>`;
  } else {
    exampleEl.innerHTML = makeClickable(current.sentence);
  }
  renderBubbles();
  homeEl.classList.add("hidden");
  lessonView.classList.remove("hidden");
}

const DISTRACTORS = ["I","you","he","she","we","they","am","are","the","a","is","not","go","do","very","always"];

function renderBubbles() {
  const words = current.translation.split(" ");
  const pool = [...words];
  const extras = DISTRACTORS.filter(w => !words.includes(w));
  shuffle(extras);
  for (let i = 0; pool.length < words.length + 4 && i < extras.length; i++) pool.push(extras[i]);
  shuffle(pool);
  bubblesEl.innerHTML = "";
  answerLine.textContent = "";
  pool.forEach(w => {
    const s = document.createElement("span");
    s.className = "bubble"; s.textContent = w;
    s.onclick = () => toggleWord(s, w);
    bubblesEl.appendChild(s);
  });
}

function toggleWord(el, w) {
  if (el.classList.contains("selected")) { el.classList.remove("selected"); selected = selected.filter(x => x !== w); }
  else { el.classList.add("selected"); selected.push(w); }
  answerLine.textContent = selected.join(" ");
  checkAnswer();
}

function checkAnswer() {
  const answer = selected.join(" ").trim().toLowerCase();
  const target  = current.translation.trim().toLowerCase();
  if (answer === target) {
    feedbackEl.textContent = "‚úÖ Correct!";
    feedbackEl.style.color = mode === "JP" ? "var(--pink)" : "var(--green)";
    xp += 10;
    if (lastVisit !== today) { streak++; lastVisit = today; localStorage.setItem("lastVisit", today); localStorage.setItem("streak", streak); }
    updateStats(); setTimeout(goHome, 800);
  } else if (selected.length >= current.translation.split(" ").length) {
    feedbackEl.textContent = "‚ùå Not quite ‚Äî try reordering!"; feedbackEl.style.color = "var(--red)";
  } else { feedbackEl.textContent = ""; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUDIO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AUDIO_BASE_NO = "https://raw.githubusercontent.com/NorskBuddy/NorskBuddy.ai/main/Norsk-Buddy-Audio/Norsk/";
const AUDIO_BASE_JP = "https://raw.githubusercontent.com/NorskBuddy/NorskBuddy.ai/main/Norsk-Buddy-Audio/Japanese/";

function playAudio() {
  const text = typeof current.sentence === "object" ? current.sentence.romaji : current.sentence;
  const fileName = text.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"").toLowerCase();
  const base = speechLang === "ja-JP" ? AUDIO_BASE_JP : AUDIO_BASE_NO;
  const audio = new Audio(base + fileName + ".mp3");
  const tts = () => { const u = new SpeechSynthesisUtterance(text); u.lang = speechLang; speechSynthesis.speak(u); };
  audio.onerror = tts;
  audio.play().catch(tts);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LANGUAGE MATCH MADNESS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startMatch(timed) {
  homeEl.classList.add("hidden"); matchView.classList.remove("hidden");
  matchSelected = []; document.getElementById("matchFeedback").textContent = "";
  const pool = lessons.sec1.slice(0, 5);
  matchPairs = pool.map(l => ({ q: typeof l.sentence === "object" ? l.sentence.romaji : l.sentence, a: l.translation }));
  buildMatch();
  if (timed) {
    let t = 90; matchTimer.textContent = "1:30"; clearInterval(matchTimerInt);
    matchTimerInt = setInterval(() => {
      t--; const m = Math.floor(t/60); const s = t%60;
      matchTimer.textContent = `${m}:${s<10?"0"+s:s}`;
      if (t <= 0) { clearInterval(matchTimerInt); alert("Time's up! XP: " + xp); exitMatch(); }
    }, 1000);
  } else { matchTimer.textContent = "Unlimited ‚ôæ"; }
}

function buildMatch() {
  matchLeft.innerHTML = ""; matchRight.innerHTML = ""; matchSelected = [];
  const leftItems  = matchPairs.map((p,i) => ({ v: p.q, pairIdx: i, side: "q" }));
  const rightItems = matchPairs.map((p,i) => ({ v: p.a, pairIdx: i, side: "a" }));
  shuffle(leftItems); shuffle(rightItems);
  leftItems.forEach(item => matchLeft.appendChild(buildMatchCard(item, selectMatch)));
  rightItems.forEach(item => matchRight.appendChild(buildMatchCard(item, selectMatch)));
}

function buildMatchCard(item, handler) {
  const d = document.createElement("div");
  d.className = "match-card"; d.textContent = item.v;
  d.dataset.pairIdx = item.pairIdx; d.dataset.side = item.side;
  d.onclick = () => handler(d, item, matchSelected, "matchFeedback", matchLeft);
  return d;
}

function selectMatch(el, item, selArr, fbId, leftCol) {
  if (el.classList.contains("matched")) return;
  if (selArr.length === 1 && selArr[0].el === el) { el.classList.remove("selected"); selArr.length = 0; return; }
  if (selArr.length === 1 && selArr[0].item.side === item.side) { selArr[0].el.classList.remove("selected"); selArr.length = 0; }
  el.classList.add("selected"); selArr.push({ el, item });
  if (selArr.length === 2) {
    const [a, b] = selArr;
    const isMatch = a.item.pairIdx === b.item.pairIdx && a.item.side !== b.item.side;
    const fb = document.getElementById(fbId);
    if (isMatch) {
      xp += 5; updateStats(); fb.textContent = "‚úÖ Match!"; fb.style.color = "var(--green)";
      setTimeout(() => {
        a.el.classList.remove("selected"); b.el.classList.remove("selected");
        a.el.classList.add("matched"); b.el.classList.add("matched");
        a.el.onclick = null; b.el.onclick = null; fb.textContent = "";
        if (leftCol.querySelectorAll(".match-card:not(.matched)").length === 0) fb.textContent = "üéâ All matched!";
      }, 300);
    } else {
      fb.textContent = "‚ùå Not a match!"; fb.style.color = "var(--red)";
      a.el.classList.add("wrong"); b.el.classList.add("wrong");
      setTimeout(() => { a.el.classList.remove("selected","wrong"); b.el.classList.remove("selected","wrong"); fb.textContent = ""; }, 600);
    }
    selArr.length = 0;
  }
}

function exitMatch() { clearInterval(matchTimerInt); matchView.classList.add("hidden"); homeEl.classList.remove("hidden"); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LINUX LESSON
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startLinuxLesson(si, li) {
  currentLinuxLesson = linuxSections[si].lessons[li];
  currentLinuxSI = si; currentLinuxLI = li;
  currentConceptIdx = 0; linuxMatchSelected = [];
  document.getElementById("linuxMatchSection").style.display = "none";
  document.getElementById("linuxMatchComplete").classList.add("hidden");
  document.getElementById("linuxLessonTitle").textContent = currentLinuxLesson.title;
  homeEl.classList.add("hidden"); linuxLessonView.classList.remove("hidden");
  document.getElementById("nextConceptBtn").style.display = "";
  document.getElementById("prevConceptBtn").style.display = "";
  renderLinuxConcept();
}

function renderLinuxConcept() {
  const concepts = currentLinuxLesson.concepts;
  const c = concepts[currentConceptIdx];
  const total = concepts.length;
  document.getElementById("conceptCounter").textContent = `${currentConceptIdx+1} / ${total}`;
  document.getElementById("linuxProgress").style.width = `${((currentConceptIdx+1)/total)*100}%`;
  document.getElementById("prevConceptBtn").style.visibility = currentConceptIdx === 0 ? "hidden" : "visible";
  document.getElementById("nextConceptBtn").textContent = currentConceptIdx === total-1 ? "Take the Quiz ‚Üí" : "Next ‚Üí";
  const area = document.getElementById("linuxConceptArea");
  area.innerHTML = `
    <div class="linux-concept">
      <h3>${c.heading}</h3>
      <p>${c.body}</p>
      ${c.analogy ? `<p class="analogy">${c.analogy}</p>` : ""}
      ${c.commands && c.commands.length > 0 ? `<div style="margin:10px 0;">${c.commands.map(cmd => `
        <div style="margin-bottom:6px;">
          <div class="cmd-block"><span class="prompt">$ </span>${escHtml(cmd.cmd)}</div>
          <div style="font-size:12px;color:#8b949e;padding:2px 4px;">${escHtml(cmd.desc)}</div>
        </div>`).join("")}</div>` : ""}
      ${c.example ? `<div class="cmd-block" style="white-space:pre;line-height:1.7;font-size:12px;">${escHtml(c.example)}</div>` : ""}
      ${c.nuance ? `<div class="nuance">${escHtml(c.nuance)}</div>` : ""}
    </div>`;
}

function escHtml(str) { return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }

function nextConcept() {
  const total = currentLinuxLesson.concepts.length;
  if (currentConceptIdx < total - 1) { currentConceptIdx++; renderLinuxConcept(); }
  else {
    document.getElementById("linuxConceptArea").innerHTML = "";
    document.getElementById("linuxMatchSection").style.display = "block";
    document.getElementById("nextConceptBtn").style.display = "none";
    document.getElementById("prevConceptBtn").style.display = "none";
    document.getElementById("conceptCounter").textContent = "";
    document.getElementById("linuxProgress").style.width = "100%";
    buildLinuxMatch();
  }
}

function prevConcept() { if (currentConceptIdx > 0) { currentConceptIdx--; renderLinuxConcept(); } }

function buildLinuxMatch() {
  const leftCol = document.getElementById("linuxMatchLeft");
  const rightCol = document.getElementById("linuxMatchRight");
  leftCol.innerHTML = ""; rightCol.innerHTML = ""; linuxMatchSelected = [];
  const pairs = currentLinuxLesson.matchPairs;
  const lefts  = pairs.map((p,i) => ({ v: p.cmd,     pairIdx: i, side: "cmd" }));
  const rights = pairs.map((p,i) => ({ v: p.purpose,  pairIdx: i, side: "pur" }));
  shuffle(lefts); shuffle(rights);
  lefts.forEach(item => { const d = buildLMCard(item); leftCol.appendChild(d); });
  rights.forEach(item => { const d = buildLMCard(item); rightCol.appendChild(d); });
}

function buildLMCard(item) {
  const d = document.createElement("div");
  d.className = "match-card"; d.textContent = item.v;
  d.dataset.pairIdx = item.pairIdx; d.dataset.side = item.side;
  d.onclick = () => selectLinuxMatch(d, item);
  return d;
}

function selectLinuxMatch(el, item) {
  if (el.classList.contains("matched")) return;
  if (linuxMatchSelected.length === 1 && linuxMatchSelected[0].el === el) { el.classList.remove("selected"); linuxMatchSelected = []; return; }
  if (linuxMatchSelected.length === 1 && linuxMatchSelected[0].item.side === item.side) { linuxMatchSelected[0].el.classList.remove("selected"); linuxMatchSelected = []; }
  el.classList.add("selected"); linuxMatchSelected.push({ el, item });
  if (linuxMatchSelected.length === 2) {
    const [a, b] = linuxMatchSelected;
    const isMatch = a.item.pairIdx === b.item.pairIdx && a.item.side !== b.item.side;
    const fb = document.getElementById("linuxMatchFeedback");
    if (isMatch) {
      fb.textContent = "‚úÖ Correct!"; fb.style.color = "var(--linux-accent)";
      xp += 3; updateStats();
      setTimeout(() => {
        a.el.classList.remove("selected"); b.el.classList.remove("selected");
        a.el.classList.add("matched"); b.el.classList.add("matched");
        a.el.onclick = null; b.el.onclick = null; fb.textContent = "";
        const leftCards = document.querySelectorAll("#linuxMatchLeft .match-card:not(.matched)");
        if (leftCards.length === 0) {
          xp += 20; updateStats();
          document.getElementById("linuxMatchComplete").classList.remove("hidden");
          markLinuxDone(currentLinuxSI, currentLinuxLI);
          buildAll(); // refresh home to show badges
        }
      }, 300);
    } else {
      fb.textContent = "‚ùå Wrong match!"; fb.style.color = "var(--red)";
      a.el.classList.add("wrong"); b.el.classList.add("wrong");
      setTimeout(() => { a.el.classList.remove("selected","wrong"); b.el.classList.remove("selected","wrong"); fb.textContent = ""; }, 600);
    }
    linuxMatchSelected = [];
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LINUX MATCH MADNESS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startLinuxMatchMadness(timed) {
  homeEl.classList.add("hidden"); lmmView.classList.remove("hidden");
  lmmSelected = []; lmmMatched = 0; lmmIsTimed = timed;
  document.getElementById("lmmFeedback").textContent = "";
  document.getElementById("lmmScoreBanner").classList.add("hidden");
  document.getElementById("lmmLeft").innerHTML = "";
  document.getElementById("lmmRight").innerHTML = "";
  // Build pool ‚Äî 8 pairs for more variety
  lmmPairs = getLinuxMatchPool(8);
  buildLMM();
  const timerEl = document.getElementById("linuxMatchMadnessTimer");
  if (timed) {
    let t = 90; timerEl.textContent = "1:30"; timerEl.classList.remove("timer-warning");
    clearInterval(lmmTimerInt);
    lmmTimerInt = setInterval(() => {
      t--;
      const m = Math.floor(t/60); const s = t%60;
      timerEl.textContent = `${m}:${s<10?"0"+s:s}`;
      if (t <= 15) timerEl.classList.add("timer-warning");
      if (t <= 0) { clearInterval(lmmTimerInt); showLMMScore(); }
    }, 1000);
  } else {
    timerEl.textContent = "Unlimited ‚ôæ";
  }
  document.getElementById("lmmPlayAgainBtn").onclick = () => {
    document.getElementById("lmmScoreBanner").classList.add("hidden");
    startLinuxMatchMadness(lmmIsTimed);
  };
}

function buildLMM() {
  const leftCol  = document.getElementById("lmmLeft");
  const rightCol = document.getElementById("lmmRight");
  leftCol.innerHTML = ""; rightCol.innerHTML = ""; lmmSelected = [];
  const lefts  = lmmPairs.map((p,i) => ({ v: p.cmd,     pairIdx: i, side: "cmd" }));
  const rights = lmmPairs.map((p,i) => ({ v: p.purpose,  pairIdx: i, side: "pur" }));
  shuffle(lefts); shuffle(rights);
  lefts.forEach(item => { const d = buildLMMCard(item); leftCol.appendChild(d); });
  rights.forEach(item => { const d = buildLMMCard(item); rightCol.appendChild(d); });
}

function buildLMMCard(item) {
  const d = document.createElement("div");
  d.className = "match-card"; d.textContent = item.v;
  d.dataset.pairIdx = item.pairIdx; d.dataset.side = item.side;
  d.onclick = () => selectLMM(d, item);
  return d;
}

function selectLMM(el, item) {
  if (el.classList.contains("matched")) return;
  if (lmmSelected.length === 1 && lmmSelected[0].el === el) { el.classList.remove("selected"); lmmSelected = []; return; }
  if (lmmSelected.length === 1 && lmmSelected[0].item.side === item.side) { lmmSelected[0].el.classList.remove("selected"); lmmSelected = []; }
  el.classList.add("selected"); lmmSelected.push({ el, item });
  if (lmmSelected.length === 2) {
    const [a, b] = lmmSelected;
    const isMatch = a.item.pairIdx === b.item.pairIdx && a.item.side !== b.item.side;
    const fb = document.getElementById("lmmFeedback");
    if (isMatch) {
      fb.textContent = "‚úÖ Matched!"; fb.style.color = "var(--linux-accent)";
      xp += 5; lmmMatched++; updateStats();
      setTimeout(() => {
        a.el.classList.remove("selected"); b.el.classList.remove("selected");
        a.el.classList.add("matched"); b.el.classList.add("matched");
        a.el.onclick = null; b.el.onclick = null; fb.textContent = "";
        const remaining = document.querySelectorAll("#lmmLeft .match-card:not(.matched)");
        if (remaining.length === 0) {
          if (!lmmIsTimed) showLMMScore();
          else {
            // All matched ‚Äî reload a fresh batch
            lmmPairs = getLinuxMatchPool(8);
            buildLMM();
          }
        }
      }, 300);
    } else {
      fb.textContent = "‚ùå Wrong ‚Äî try again!"; fb.style.color = "var(--red)";
      a.el.classList.add("wrong"); b.el.classList.add("wrong");
      setTimeout(() => { a.el.classList.remove("selected","wrong"); b.el.classList.remove("selected","wrong"); fb.textContent = ""; }, 600);
    }
    lmmSelected = [];
  }
}

function showLMMScore() {
  clearInterval(lmmTimerInt);
  document.getElementById("lmmScoreBanner").classList.remove("hidden");
  document.getElementById("lmmScoreNum").textContent = lmmMatched + " pairs";
  document.getElementById("lmmLeft").innerHTML = "";
  document.getElementById("lmmRight").innerHTML = "";
  document.getElementById("lmmFeedback").textContent = "";
  document.getElementById("linuxMatchMadnessTimer").textContent = "";
}

function exitLinuxMatchMadness() {
  clearInterval(lmmTimerInt);
  lmmView.classList.add("hidden");
  homeEl.classList.remove("hidden");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goHome() {
  homeEl.classList.remove("hidden");
  lessonView.classList.add("hidden");
  matchView.classList.add("hidden");
  linuxLessonView.classList.add("hidden");
  lmmView.classList.add("hidden");
  document.getElementById("nextConceptBtn").style.display = "";
  document.getElementById("prevConceptBtn").style.display = "";
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATS & UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateStats() {
  xpEl.textContent = xp; streakEl.textContent = streak;
  levelEl.textContent = Math.floor(xp/100)+1;
}

function shuffle(a) { for (let i=a.length-1;i>0;i--){const j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]];} }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LANGUAGE TOGGLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
flagNO.onclick = () => {
  mode="NO"; lessons=lessonsNO; speechLang="no-NO";
  document.body.className=""; document.getElementById("title").textContent="Norsk Buddy";
  flagNO.classList.add("active"); flagJP.classList.remove("active"); flagLinux.classList.remove("active");
  buildAll();
};
flagJP.onclick = () => {
  mode="JP"; lessons=lessonsJP; speechLang="ja-JP";
  document.body.className="jp"; document.getElementById("title").textContent="Êó•Êú¨Ë™û Buddy";
  flagJP.classList.add("active"); flagNO.classList.remove("active"); flagLinux.classList.remove("active");
  buildAll();
};
flagLinux.onclick = () => {
  mode="LINUX"; document.body.className="linux";
  document.getElementById("title").textContent="$ Linux Buddy";
  flagLinux.classList.add("active"); flagNO.classList.remove("active"); flagJP.classList.remove("active");
  buildAll();
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
buildAll();
updateStats();
</script>
</body>
</html>

