<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Norsk Buddy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family:system-ui,sans-serif;
  background:linear-gradient(135deg,#1cb0f6,#58cc02);
}
body.jp {
  background:linear-gradient(135deg,#f472b6,#fb7185);
}
.app {
  max-width:480px;
  margin:auto;
  background:#fff;
  min-height:100vh;
  padding:20px;
}
h1,h2 { text-align:center; }

.lang-toggle {
  display:flex;
  justify-content:center;
  gap:12px;
  margin-bottom:8px;
  font-size:28px;
  cursor:pointer;
}
.lang-toggle span { opacity:.4; }
.lang-toggle .active { opacity:1; }

.section {
  background:#f0f8ff;
  border-radius:16px;
  padding:14px;
  margin-top:16px;
}
body.jp .section { background:#fff1f5; }

.section-header {
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}
.hidden { display:none; }

.lesson-grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin-top:12px;
}
.lesson {
  background:#fff;
  border-radius:12px;
  padding:14px;
  text-align:center;
  cursor:pointer;
  box-shadow:0 2px 4px rgba(0,0,0,.1);
}

.bubbles {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:16px;
}
.bubble {
  background:#e0e0e0;
  padding:8px 12px;
  border-radius:20px;
  cursor:pointer;
}
.bubble.selected { background:#58cc02; color:#fff; }
body.jp .bubble.selected { background:#ec4899; }
.bubble.wrong { background:#ff6b6b; color:#fff; }

.answer-line {
  min-height:40px;
  border-bottom:2px solid #ccc;
  margin-top:12px;
  padding:6px;
}

.stats {
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  font-size:14px;
}
</style>
</head>

<body>
<div class="app">

<div class="lang-toggle">
  <span id="flagNO" class="active">üá≥üá¥</span>
  <span id="flagJP">üáØüáµ</span>
</div>

<h1 id="title">Norsk Buddy</h1>

<div class="stats">
  <div>üî• Streak: <span id="streak">0</span></div>
  <div>‚≠ê XP: <span id="xp">0</span> (Lv <span id="level">1</span>)</div>
</div>

<div id="home">
  <div class="section">
    <div class="section-header" onclick="toggle('sec1')">Section 1 ‚Äì The Basics</div>
    <div id="sec1" class="hidden"><div class="lesson-grid" id="sec1grid"></div></div>
  </div>

  <div class="section">
    <div class="section-header" onclick="toggle('sec2')">Section 2 ‚Äì Building Confidence</div>
    <div id="sec2" class="hidden"><div class="lesson-grid" id="sec2grid"></div></div>
  </div>

  <div class="section">
    <div class="section-header" onclick="toggle('sec3')">Section 3 ‚Äì Everyday Fluency</div>
    <div id="sec3" class="hidden"><div class="lesson-grid" id="sec3grid"></div></div>
  </div>
</div>

<div id="lessonView" class="hidden">
  <button onclick="goHome()">‚Üê Back</button>
  <h2 id="lessonTitle"></h2>
  <p id="example"></p>
  <button onclick="playAudio()">üîä Play Audio</button>
  <div class="answer-line" id="answerLine"></div>
  <div class="bubbles" id="bubbles"></div>
</div>

</div>

<script>
/* ---------------- LANGUAGE STATE ---------------- */
let lessons;
let speechLang="no-NO";

/* ---------------- LESSON DATA (RESTORED) ---------------- */

const lessonsNO = {
  sec1: [
    {title:"Who, What, Why, and Where", sentence:"Hvem er du", translation:"Who are you"},
    {title:"Colors", sentence:"Hatten hans er r√∏d", translation:"His hat is red"},
    {title:"Professions", sentence:"Hun er l√¶rer", translation:"She is a teacher"},
    {title:"Feelings", sentence:"Jeg er glad", translation:"I am happy"},
    {title:"Numbers", sentence:"Jeg har to sko", translation:"I have two shoes"},
    {title:"Their / There / They're", sentence:"De er der", translation:"They are there"},
    {title:"Me, Myself, and I", sentence:"Du og meg", translation:"You and me"},
    {title:"Things You Wear", sentence:"Skoene hennes er bl√•", translation:"Her shoes are blue"},
    {title:"Give and Take", sentence:"Gi meg den luen", translation:"Give me that beanie"},
    {title:"Lost and Found", sentence:"Den er borte", translation:"It is gone"},
    {title:"Everyday Tech", sentence:"Jeg mistet telefonen min", translation:"I lost my phone"},
    {title:"The Reading Rainbow", sentence:"Jeg leser en bok", translation:"I am reading a book"},

    {title:"Morning Routine", sentence:"Jeg drikker kaffe", translation:"I drink coffee"},
    {title:"Food Fight (Friday)", sentence:"Jeg spiser pizza", translation:"I eat pizza"},
    {title:"Getting Around", sentence:"Jeg g√•r hjem", translation:"I walk home"},
    {title:"Family Matters", sentence:"Hun er min mor", translation:"She is my mother"},
    {title:"Time After Time", sentence:"Det er kveld", translation:"It is evening"},
    {title:"Weather Report", sentence:"Det regner i dag", translation:"It is raining today"},
    {title:"At Home", sentence:"Jeg er hjemme", translation:"I am at home"},
    {title:"Office Space", sentence:"Han jobber her", translation:"He works here"},
    {title:"Weekend Vibes", sentence:"Det er l√∏rdag", translation:"It is Saturday"},
    {title:"Snack Attack", sentence:"Jeg liker sjokolade", translation:"I like chocolate"},
    {title:"On the Phone", sentence:"Jeg ringer deg", translation:"I am calling you"},
    {title:"Music & Radio", sentence:"Jeg h√∏rer p√• radio", translation:"I listen to the radio"},
    {title:"Game Night (Fortnite)", sentence:"Jeg spiller et spill", translation:"I am playing a game"},
    {title:"Simple Questions", sentence:"Hvor er du", translation:"Where are you"},
    {title:"Good Night", sentence:"God natt", translation:"Good night"}
  ],
  sec2: Array.from({length:20},(_,i)=>({
    title:`Everyday Life ${i+1}`,
    sentence:"Jeg jobber i dag",
    translation:"I am working today"
  })),
  sec3: Array.from({length:20},(_,i)=>({
    title:`Daily Stories ${i+1}`,
    sentence:"Jeg ser filmen",
    translation:"I am watching the movie"
  }))
};

const lessonsJP = {
  sec1: lessonsNO.sec1.map(l=>({
    title:l.title,
    sentence:"ÔºàÊó•Êú¨Ë™ûÊñáÔºâ",
    translation:l.translation
  })),
  sec2: lessonsNO.sec2.map(l=>({
    title:l.title,
    sentence:"ÁßÅ„ÅØ‰ªäÊó•ÂÉç„ÅÑ„Å¶„ÅÑ„Åæ„Åô",
    translation:l.translation
  })),
  sec3: lessonsNO.sec3.map(l=>({
    title:l.title,
    sentence:"ÁßÅ„ÅØÊò†Áîª„ÇíË¶ã„Å¶„ÅÑ„Åæ„Åô",
    translation:l.translation
  }))
};

lessons = lessonsNO;

/* ---------------- CORE ENGINE ---------------- */

let xp=0, streak=0, level=1;
let current=null;
let selected=[];

function buildAll(){
  ["sec1","sec2","sec3"].forEach(sec=>{
    document.getElementById(sec+"grid").innerHTML="";
    lessons[sec].forEach((l,i)=>{
      const d=document.createElement("div");
      d.className="lesson";
      d.textContent=l.title;
      d.onclick=()=>startLesson(sec,i);
      document.getElementById(sec+"grid").appendChild(d);
    });
  });
}

function startLesson(sec,i){
  current=lessons[sec][i];
  lessonTitle.textContent=current.title;
  example.textContent=current.sentence;
  selected=[];
  renderBubbles();
  home.classList.add("hidden");
  lessonView.classList.remove("hidden");
}

function renderBubbles(){
  const words=current.translation.split(" ");
  const pool=[...words];
  while(pool.length<words.length+3) pool.push(randomWord());
  shuffle(pool);

  bubbles.innerHTML="";
  answerLine.textContent="";

  pool.forEach(w=>{
    const s=document.createElement("span");
    s.className="bubble";
    s.textContent=w;
    s.onclick=()=>toggleWord(s,w);
    bubbles.appendChild(s);
  });
}

function toggleWord(el,w){
  if(el.classList.contains("selected")){
    el.classList.remove("selected","wrong");
    selected=selected.filter(x=>x!==w);
  } else {
    el.classList.add("selected");
    selected.push(w);
  }
  answerLine.textContent=selected.join(" ");
  if(selected.join(" ")===current.translation){
    xp+=10; streak++;
    updateStats();
    setTimeout(goHome,500);
  }
}

function playAudio(){
  const u=new SpeechSynthesisUtterance(current.sentence);
  u.lang=speechLang;
  speechSynthesis.speak(u);
}

function goHome(){
  home.classList.remove("hidden");
  lessonView.classList.add("hidden");
}

function toggle(id){ document.getElementById(id).classList.toggle("hidden"); }
function randomWord(){ return ["I","you","he","she","we","they","am","are"][Math.random()*8|0]; }
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]]}}
function updateStats(){
  xpEl.textContent=xp;
  streakEl.textContent=streak;
  levelEl.textContent=Math.floor(xp/100)+1;
}

/* ---------------- LANGUAGE TOGGLE ---------------- */

flagNO.onclick=()=>{
  lessons=lessonsNO;
  speechLang="no-NO";
  document.body.classList.remove("jp");
  title.textContent="Norsk Buddy";
  flagNO.classList.add("active");
  flagJP.classList.remove("active");
  buildAll();
};

flagJP.onclick=()=>{
  lessons=lessonsJP;
  speechLang="ja-JP";
  document.body.classList.add("jp");
  title.textContent="Êó•Êú¨Ë™û Buddy";
  flagJP.classList.add("active");
  flagNO.classList.remove("active");
  buildAll();
};

buildAll();
updateStats();
</script>
</body>
</html>
